<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>06_community_pattern_detection.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>06 community pattern detection</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/index-DKEudB02.js"></script>
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/index-Cx0bsY1w.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "06_community_pattern_detection.py",
            "mode": "read",
            "version": "0.16.0",
            "serverToken": "static",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "display": {"cell_output": "above", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": true}}, "package_management": {"manager": "pip"}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo\nmo.md(\n    r\"\"\"\n    # Notebook 6: Community Pattern Detection and Biological Screening\n\n    **Purpose**: Demonstrate that acoustic indices can detect community-level fish patterns and identify periods of biological interest\n\n    **Key Outputs**: Evidence that indices serve as effective biological screening tools for continuous monitoring\n\n    ---\n\n    **\ud83d\udcdd Research Timeline Note**: This notebook was originally developed to analyze fish-only community patterns. During the research process (documented in Notebook 08), we discovered that dolphin data had been flowing through the pipeline all along, but with incompatible metrics. This notebook was subsequently updated to include comparative marine community analysis (fish + dolphins) alongside the original fish-only analysis. This represents the authentic, iterative nature of the research process - showing both the original approach and how new discoveries led to enhanced methods.\n\n    **\ud83d\udd04 If you're following the research journey chronologically**: This notebook can be run independently for fish-only analysis, but the marine community features require running Notebook 08 first to generate the dolphin intensity conversion and marine community metrics.\n\n    ---\n\n    ## Overview\n\n    Moving beyond species-specific prediction, this notebook tests whether acoustic indices can serve as **biological screening tools** by detecting aggregate community-level fish activity. Rather than trying to predict individual species calling intensities, we focus on:\n\n    1. **Community-level activity detection**: Can indices detect when \"something biological is happening\" vs periods of low activity?\n    2. **Temporal pattern concordance**: Do indices capture the same diel and seasonal patterns as manual detections?\n    3. **Screening efficiency**: How much manual effort could be saved by using indices to identify high-activity periods?\n    4. **Cross-station transferability**: Do index-based patterns hold across different monitoring locations?\n\n    ## Methodological Approach\n\n    ### Community Metrics Design\n    We create several aggregate metrics that summarize biological activity across all fish species:\n\n    - **Total activity**: Sum of calling intensities across all species (captures overall biological \"energy\")\n    - **Number of active species**: Count of species calling in each period (community richness proxy)\n    - **Maximum activity**: Peak calling intensity across species (dominant biological signal)\n    - **Activity diversity**: Variation in calling patterns (community evenness proxy)\n\n    ### Binary Classification Strategy\n    Instead of predicting exact calling intensities (0-3 scale), we convert community activity into binary classification problems:\n\n    - **Any activity vs none**: Basic biological presence/absence detection\n    - **High activity (75th/90th percentile)**: Periods of exceptional biological interest\n    - **Multi-species active**: Complex community interactions vs single-species events\n\n    ### Machine Learning Models\n    We test multiple classification algorithms to find the best approach:\n\n    - **Logistic Regression**: Linear baseline, interpretable coefficients\n    - **Decision Tree**: Non-linear, rule-based, highly interpretable\n    - **Random Forest**: Ensemble method, handles feature interactions, robust to overfitting\n    - Attempted **Gradient Boosting** but it took too much time/compute for this analysis\n\n    ### Evaluation Focus\n    Rather than just accuracy, we emphasize **screening performance**:\n\n    - **Effort reduction**: How much manual work can be saved?\n    - **Detection rate**: What percentage of biological activity is captured?\n    - **Precision**: When the model flags a period, how often is it actually active?\n\n    ## Why This Matters\n\n    If acoustic indices can reliably detect periods of biological interest, they could serve as **intelligent screening tools** that guide targeted manual detection efforts. This would enable:\n\n    - **Continuous biological monitoring** at scales impossible with manual detection alone\n    - **Efficient allocation of manual effort** to periods most likely to contain biological activity\n    - **Early detection of biological events** like spawning aggregations or community shifts\n    - **Cost-effective long-term monitoring** with minimal ongoing human effort\n\n    The key question: **\"Can acoustic indices tell us when to pay attention?\"**\n    \"\"\"\n)", "code_hash": "bc3195b863ba12e0904187c120b3309e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Hbol", "name": "_"}, {"code": "import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom pathlib import Path\nimport warnings\nimport json\nimport pickle\nwarnings.filterwarnings('ignore')\n\n# Machine learning\nfrom sklearn.model_selection import train_test_split, cross_val_score, StratifiedKFold, TimeSeriesSplit\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier\nfrom sklearn.preprocessing import StandardScaler, RobustScaler\nfrom sklearn.metrics import (\n    classification_report, confusion_matrix, roc_curve, auc,\n    precision_recall_curve, accuracy_score, cohen_kappa_score,\n    f1_score, precision_score, recall_score\n)\nfrom sklearn.feature_selection import mutual_info_classif, SelectKBest\n\n# Statistical analysis\nfrom scipy import stats\nfrom scipy.stats import spearmanr, pearsonr\n\n# Set plotting style\nplt.style.use('default')\nsns.set_palette(\"husl\")\n\n# Find project root by looking for the data folder\ncurrent_dir = Path(__file__).parent if \"__file__\" in locals() else Path.cwd()\nproject_root = current_dir\nwhile not (project_root / \"data\").exists() and project_root != project_root.parent:\n    project_root = project_root.parent\n\n# Data directories\nDATA_ROOT = project_root / \"data\"\ndata_dir = DATA_ROOT / \"processed\"\nplot_dir = DATA_ROOT.parent / \"dashboard/public/views/notebooks\"\nplot_dir.mkdir(exist_ok=True, parents=True)\n\nprint(\"Libraries loaded successfully\")\nprint(f\"Data root: {DATA_ROOT}\")\nprint(f\"Plot directory: {plot_dir}\")", "code_hash": "73ab35e411e190604aca8c02cb53f403", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "MJUe", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Data Loading and Preparation\n\nLoading all processed datasets and preparing them for community-level analysis.\n\"\"\"\n)", "code_hash": "5b25543cfbf2f21182c1cb4224f30123", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "vblA", "name": "_"}, {"code": "# Load all processed datasets\nprint(\"Loading processed datasets...\")\n\n# Load reduced acoustic indices from Notebook 3\ndf_indices = pd.read_parquet(DATA_ROOT / \"processed/03_reduced_acoustic_indices.parquet\")\n\n# Load aligned detections (original fish-only data)\ndf_detections = pd.read_parquet(DATA_ROOT / \"processed/02_detections_aligned_2021.parquet\")\n\n# Load enhanced marine community data (fish + dolphins from notebook 08)\nmarine_community_file = DATA_ROOT / \"processed/02_detections_with_marine_community.parquet\"\nif marine_community_file.exists():\n    df_marine_community = pd.read_parquet(marine_community_file)\n    print(f\"\u2705 Loaded enhanced marine community data: {df_marine_community.shape}\")\nelse:\n    print(f\"\u26a0\ufe0f Marine community data not found: {marine_community_file}\")\n    print(\"Run notebook 08 first to generate marine community metrics\")\n    df_marine_community = None\n\n# Load environmental data\ndf_env = pd.read_parquet(DATA_ROOT / \"processed/02_environmental_aligned_2021.parquet\")\n\n# Load temporal features\ndf_temporal = pd.read_parquet(DATA_ROOT / \"processed/02_temporal_features_2021.parquet\")\n\n# Load detection metadata to identify fish species\ndf_det_metadata = pd.read_parquet(DATA_ROOT / \"processed/metadata/01_detection_columns.parquet\")\n\nprint(f\"Indices shape: {df_indices.shape}\")\nprint(f\"Detections shape: {df_detections.shape}\")\nprint(f\"Environmental shape: {df_env.shape}\") \nprint(f\"Temporal features shape: {df_temporal.shape}\")", "code_hash": "58b0e19cfcd1459da5ad47f61e4dea86", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bkHC", "name": "_"}, {"code": "# Get fish species columns\nfish_species = df_det_metadata[\n    (df_det_metadata['group'] == 'fish') &\n    (df_det_metadata['keep_species'] == 1)\n]['long_name'].tolist()\n\n# Get acoustic index columns (exclude metadata)\nindex_cols = [col for col in df_indices.columns\n              if col not in ['datetime', 'station', 'year']]\n\n# Merge all datasets\ndf_master = df_indices.merge(\n    df_detections[['datetime', 'station', 'year'] + fish_species],\n    on=['datetime', 'station', 'year'],\n    how='left'\n)\n\ndf_master = df_master.merge(\n    df_env[['datetime', 'station', 'year', 'Water temp (\u00b0C)', 'Water depth (m)',\n            'Broadband (1-40000 Hz)', 'Low (50-1200 Hz)', 'High (7000-40000 Hz)']],\n    on=['datetime', 'station', 'year'],\n    how='left'\n)\n\ndf_master = df_master.merge(\n    df_temporal[['datetime', 'station', 'year', 'hour', 'month', 'season', 'time_period']],\n    on=['datetime', 'station', 'year'],\n    how='left'\n)\n\n# Rename time_period to diel_period for consistency\ndf_master = df_master.rename(columns={'time_period': 'diel_period'})\n\nprint(f\"Master dataset shape: {df_master.shape}\")\nprint(f\"Fish species columns ({len(fish_species)}): {fish_species}\")\nprint(f\"Acoustic index columns ({len(index_cols)}): {index_cols[:5]}...\")", "code_hash": "ad9f6a7acd370fb70c7b9945606c4ec2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lEQa", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Community Activity Metrics Creation\n\nCreating aggregate community-level metrics that move beyond species-specific analysis.\n\n## Strategy: From Species-Specific to Community-Level Analysis\n\nInstead of trying to predict individual species calling patterns (which showed limited success in earlier analyses),\nwe aggregate across all species to ask: **\"Is there biological activity happening?\"** This approach:\n\n1. **Reduces complexity**: 7 species \u00d7 4 intensity levels = 28 possible states \u2192 4 binary questions\n2. **Increases signal**: Combines weak species-specific signals into stronger community signal\n3. **Matches practical needs**: Often we care more about \"when to listen carefully\" than \"exactly which species\"\n4. **Improves statistical power**: More balanced classes, clearer patterns\n\"\"\"\n)", "code_hash": "aa3cd67abbfcbebc3fefb38624e19e60", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "PKri", "name": "_"}, {"code": "# Create community-level activity metrics\nprint(\"Creating community activity metrics...\")\nprint(f\"Working with {len(fish_species)} fish species: {fish_species}\")\n\n# 1. Total fish activity (sum across all species)\n# This captures the overall \"biological energy\" in each 2-hour period\n# Range: 0 (no calling) to 21 (all species calling at maximum intensity)\ndf_community = df_master.copy()\ndf_community['total_fish_activity'] = df_community[fish_species].sum(axis=1)\nprint(f\"Total activity range: {df_community['total_fish_activity'].min():.0f} to {df_community['total_fish_activity'].max():.0f}\")\n\n# 2. Number of active species (how many species detected)\n# This measures community richness - are multiple species active simultaneously?\n# Range: 0 (no species) to 7 (all species calling)\ndf_community['num_active_species'] = (df_community[fish_species] > 0).sum(axis=1)\nprint(f\"Active species range: {df_community['num_active_species'].min():.0f} to {df_community['num_active_species'].max():.0f}\")\n\n# 3. Maximum species activity (highest calling intensity across species)\n# This captures the strength of the dominant biological signal\n# Range: 0 (no activity) to 3 (maximum intensity from at least one species)\ndf_community['max_species_activity'] = df_community[fish_species].max(axis=1)\nprint(f\"Maximum activity range: {df_community['max_species_activity'].min():.0f} to {df_community['max_species_activity'].max():.0f}\")\n\n# 4. Activity diversity (simplified - coefficient of variation)\n# This measures how evenly distributed calling is across species\n# High values = one species dominates, Low values = multiple species calling similarly\ndf_community['activity_diversity'] = df_community[fish_species].std(axis=1) / (df_community[fish_species].mean(axis=1) + 0.01)\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"CREATING BINARY CLASSIFICATION TARGETS\")\nprint(\"=\"*60)\nprint(\"Converting continuous community metrics into binary screening questions:\")\n\n# 5. Binary classification targets at different thresholds\n# These represent different \"screening sensitivity\" levels\n\n# High vs low total activity (75th percentile threshold)\n# Question: \"Is this a period of elevated biological activity?\"\ntotal_activity_75th = df_community['total_fish_activity'].quantile(0.75)\ndf_community['high_activity_75th'] = (df_community['total_fish_activity'] >= total_activity_75th).astype(int)\nprint(f\"High activity (75th percentile, threshold={total_activity_75th:.1f}): {df_community['high_activity_75th'].mean():.1%} of periods\")\n\n# Very high activity (90th percentile threshold)\n# Question: \"Is this a period of exceptional biological interest?\"\ntotal_activity_90th = df_community['total_fish_activity'].quantile(0.90)\ndf_community['high_activity_90th'] = (df_community['total_fish_activity'] >= total_activity_90th).astype(int)\nprint(f\"Very high activity (90th percentile, threshold={total_activity_90th:.1f}): {df_community['high_activity_90th'].mean():.1%} of periods\")\n\n# Any biological activity vs none\n# Question: \"Is there any fish calling happening at all?\"\ndf_community['any_activity'] = (df_community['total_fish_activity'] > 0).astype(int)\nprint(f\"Any activity (threshold=0): {df_community['any_activity'].mean():.1%} of periods\")\n\n# Multiple species active vs single/none\n# Question: \"Are multiple species interacting/calling together?\"\ndf_community['multi_species_active'] = (df_community['num_active_species'] >= 2).astype(int)\nprint(f\"Multi-species activity (\u22652 species): {df_community['multi_species_active'].mean():.1%} of periods\")\n\nprint(f\"Fish community metrics created. Sample statistics:\")\nprint(f\"Total activity - Mean: {df_community['total_fish_activity'].mean():.2f}, Max: {df_community['total_fish_activity'].max():.0f}\")\nprint(f\"Active species - Mean: {df_community['num_active_species'].mean():.2f}, Max: {df_community['num_active_species'].max():.0f}\")\nprint(f\"High activity (75th): {df_community['high_activity_75th'].mean():.1%}\")\nprint(f\"High activity (90th): {df_community['high_activity_90th'].mean():.1%}\")\nprint(f\"Any activity: {df_community['any_activity'].mean():.1%}\")\nprint(f\"Multi-species active: {df_community['multi_species_active'].mean():.1%}\")\n\n# ====================================================================\n# MARINE COMMUNITY METRICS (Fish + Dolphins)\n# ====================================================================\n\ndf_marine = None\nmarine_activity_75th = None\nmarine_activity_90th = None\n\nif df_marine_community is not None:\n    print(\"\\n\" + \"=\"*70)\n    print(\"CREATING MARINE COMMUNITY METRICS (FISH + DOLPHINS)\")\n    print(\"=\"*70)\n\n    # Create marine master dataset by merging with enhanced marine community data\n    # Use the marine community data which includes fish + dolphin metrics\n\n    # First, get marine species columns from marine community data\n    marine_species_cols = [col for col in df_marine_community.columns \n                         if col not in ['datetime', 'station', 'year', 'total_fish_intensity',\n                                      'num_active_fish_species', 'max_fish_intensity',\n                                      'dolphin_count', 'dolphin_intensity', 'total_marine_intensity',\n                                      'num_active_marine_species', 'max_marine_intensity']]\n\n    # Get just the fish species from the marine data (should match fish_species)\n    marine_fish_species = [col for col in marine_species_cols if col in fish_species]\n\n    print(f\"Creating marine community dataset with {len(marine_fish_species)} fish species + dolphins\")\n\n    # Create marine master dataset\n    df_marine_master = df_indices.merge(\n        df_marine_community[['datetime', 'station', 'year'] + marine_fish_species + \n                           ['dolphin_intensity', 'total_marine_intensity', \n                            'num_active_marine_species', 'max_marine_intensity']],\n        on=['datetime', 'station', 'year'],\n        how='left'\n    )\n\n    # Merge with environmental and temporal data (same as fish-only)\n    df_marine_master = df_marine_master.merge(\n        df_env[['datetime', 'station', 'year', 'Water temp (\u00b0C)', 'Water depth (m)',\n                'Broadband (1-40000 Hz)', 'Low (50-1200 Hz)', 'High (7000-40000 Hz)']],\n        on=['datetime', 'station', 'year'],\n        how='left'\n    )\n\n    df_marine_master = df_marine_master.merge(\n        df_temporal[['datetime', 'station', 'year', 'hour', 'month', 'season', 'time_period']],\n        on=['datetime', 'station', 'year'],\n        how='left'\n    )\n\n    # Rename time_period to diel_period for consistency\n    df_marine_master = df_marine_master.rename(columns={'time_period': 'diel_period'})\n\n    print(f\"Marine master dataset shape: {df_marine_master.shape}\")\n\n    # Create marine community dataset\n    df_marine = df_marine_master.copy()\n\n    # Use the pre-computed marine community metrics from notebook 08\n    print(\"Using pre-computed marine community metrics from notebook 08...\")\n\n    # Rename marine metrics to match fish naming convention for consistency\n    df_marine['total_marine_activity'] = df_marine['total_marine_intensity']\n    df_marine['num_active_marine_species'] = df_marine['num_active_marine_species']\n    df_marine['max_marine_activity'] = df_marine['max_marine_intensity']\n\n    # Add dolphin-specific metrics\n    df_marine['dolphin_activity'] = df_marine['dolphin_intensity']\n\n    # Calculate activity diversity for marine community\n    all_marine_species = marine_fish_species + ['dolphin_intensity']\n    df_marine['marine_activity_diversity'] = df_marine[all_marine_species].std(axis=1) / (df_marine[all_marine_species].mean(axis=1) + 0.01)\n\n    print(f\"Marine activity range: {df_marine['total_marine_activity'].min():.0f} to {df_marine['total_marine_activity'].max():.0f}\")\n    print(f\"Marine species range: {df_marine['num_active_marine_species'].min():.0f} to {df_marine['num_active_marine_species'].max():.0f}\")\n    print(f\"Dolphin activity range: {df_marine['dolphin_activity'].min():.0f} to {df_marine['dolphin_activity'].max():.0f}\")\n\n    # Create binary classification targets for marine community\n    print(\"\\nCreating marine community binary classification targets...\")\n\n    # High vs low marine activity (75th percentile threshold)\n    marine_activity_75th = df_marine['total_marine_activity'].quantile(0.75)\n    df_marine['high_marine_activity_75th'] = (df_marine['total_marine_activity'] >= marine_activity_75th).astype(int)\n    print(f\"High marine activity (75th percentile, threshold={marine_activity_75th:.1f}): {df_marine['high_marine_activity_75th'].mean():.1%} of periods\")\n\n    # Very high marine activity (90th percentile threshold)\n    marine_activity_90th = df_marine['total_marine_activity'].quantile(0.90)\n    df_marine['high_marine_activity_90th'] = (df_marine['total_marine_activity'] >= marine_activity_90th).astype(int)\n    print(f\"Very high marine activity (90th percentile, threshold={marine_activity_90th:.1f}): {df_marine['high_marine_activity_90th'].mean():.1%} of periods\")\n\n    # Any marine biological activity vs none\n    df_marine['any_marine_activity'] = (df_marine['total_marine_activity'] > 0).astype(int)\n    print(f\"Any marine activity (threshold=0): {df_marine['any_marine_activity'].mean():.1%} of periods\")\n\n    # Multiple marine species active vs single/none  \n    df_marine['multi_marine_species_active'] = (df_marine['num_active_marine_species'] >= 2).astype(int)\n    print(f\"Multi-species marine activity (\u22652 species): {df_marine['multi_marine_species_active'].mean():.1%} of periods\")\n\n    # Dolphin-specific targets\n    df_marine['dolphin_present'] = (df_marine['dolphin_activity'] > 0).astype(int)\n    print(f\"Dolphin presence: {df_marine['dolphin_present'].mean():.1%} of periods\")\n\n    print(f\"\\nMarine community metrics created. Sample statistics:\")\n    print(f\"Total marine activity - Mean: {df_marine['total_marine_activity'].mean():.2f}, Max: {df_marine['total_marine_activity'].max():.0f}\")\n    print(f\"Active marine species - Mean: {df_marine['num_active_marine_species'].mean():.2f}, Max: {df_marine['num_active_marine_species'].max():.0f}\")\n    print(f\"Dolphin activity - Mean: {df_marine['dolphin_activity'].mean():.2f}, Max: {df_marine['dolphin_activity'].max():.0f}\")\n    print(f\"High marine activity (75th): {df_marine['high_marine_activity_75th'].mean():.1%}\")\n    print(f\"High marine activity (90th): {df_marine['high_marine_activity_90th'].mean():.1%}\")\n\n    # Comparison between fish-only and marine community\n    print(\"\\n\" + \"=\"*50)\n    print(\"FISH vs MARINE COMMUNITY COMPARISON\")\n    print(\"=\"*50)\n\n    # Match periods between datasets for fair comparison\n    common_indices = df_community.index.intersection(df_marine.index)\n\n    if len(common_indices) > 0:\n        fish_mean = df_community.loc[common_indices, 'total_fish_activity'].mean()\n        marine_mean = df_marine.loc[common_indices, 'total_marine_activity'].mean()\n\n        print(f\"Mean activity comparison (matched periods, n={len(common_indices):,}):\")\n        print(f\"  Fish-only community: {fish_mean:.2f}\")\n        print(f\"  Marine community (fish + dolphins): {marine_mean:.2f}\")\n        print(f\"  Marine enhancement: +{((marine_mean - fish_mean) / fish_mean * 100):.1f}%\")\n\n        fish_high_75 = df_community.loc[common_indices, 'high_activity_75th'].mean()\n        marine_high_75 = df_marine.loc[common_indices, 'high_marine_activity_75th'].mean()\n\n        print(f\"High activity periods (75th percentile):\")\n        print(f\"  Fish-only: {fish_high_75:.1%}\")\n        print(f\"  Marine: {marine_high_75:.1%}\")\n\nelse:\n    print(\"\\n\u26a0\ufe0f Marine community data not available - skipping marine metrics\")\n    print(\"Run notebook 07 first to generate enhanced marine community dataset\")", "code_hash": "b875fbfc013a5332f645afec30ce07db", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Xref", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Model Development for Community Activity Detection\n\nTraining multiple classifiers to predict community-level biological activity using acoustic indices.\n\n## Machine Learning Algorithms Explained\n\nWe test four different classification algorithms, each with distinct strengths for biological screening:\n\n### 1. Logistic Regression\n- **How it works**: Linear combination of features \u2192 probability via sigmoid function\n- **Strengths**: Fast, interpretable coefficients, stable predictions\n- **Best for**: Understanding which indices have linear relationships with biology\n- **Interpretation**: Coefficient sign/magnitude shows feature importance and direction\n\n### 2. Decision Tree\n\n- **How it works**: Sequential yes/no questions creating rule-based decisions\n- **Strengths**: Highly interpretable, handles non-linear patterns, no assumptions about data distribution\n- **Best for**: Creating simple screening rules (e.g., \"if index X > threshold AND temperature > Y, then high activity\")\n- **Interpretation**: Tree branches show exact decision logic\n\n### 3. Random Forest\n\n- **How it works**: Combines predictions from 100 different decision trees\n- **Strengths**: Handles complex interactions, resistant to overfitting, robust to outliers\n- **Best for**: Maximizing predictive performance while maintaining some interpretability\n- **Interpretation**: Feature importance ranks show which indices contribute most to predictions\n\n### 4. Gradient Boosting  ** not implemented due to computational constraints\n\n- **How it works**: Sequentially builds models, each correcting previous model's mistakes\n- **Strengths**: Often highest accuracy, excellent at detecting subtle patterns\n- **Best for**: Maximum screening performance when interpretability is less critical\n- **Interpretation**: Feature importance shows cumulative contribution across all boosting iterations\n\n## Evaluation Strategy\n\nFor biological screening, we care more about **practical performance** than traditional accuracy:\n\n- **F1 Score**: Balances precision (few false alarms) with recall (catch most activity)\n- **Cross-validation**: 5-fold stratified to ensure robust performance estimates\n- **Class balance**: Account for unequal representation of active vs inactive periods\n\"\"\"\n)", "code_hash": "a72ffa063b448a1f5b29690215424b68", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SFPL", "name": "_"}, {"code": "# Prepare data for comparative community activity modeling\nprint(\"Preparing data for COMPARATIVE community activity modeling...\")\nprint(\"=\"*80)\nprint(\"Training models for both fish-only and marine (fish + dolphin) communities\")\nprint(\"=\"*80)\n\n# Feature Selection Strategy\n# Combine acoustic indices with key environmental and temporal variables\n# This tests whether indices add value beyond simple environmental predictors\nmodeling_cols = index_cols + ['Water temp (\u00b0C)', 'Water depth (m)', 'hour', 'month']\n\n# Define target sets for both community types\nfish_target_cols = ['high_activity_75th', 'high_activity_90th', 'any_activity', 'multi_species_active']\nmarine_target_cols = ['high_marine_activity_75th', 'high_marine_activity_90th', 'any_marine_activity', 'multi_marine_species_active', 'dolphin_present']\n\nprint(f\"Feature categories:\")\nprint(f\"  - Acoustic indices: {len(index_cols)} variables\")\nprint(f\"  - Environmental: 2 variables (temperature, depth)\")\nprint(f\"  - Temporal: 2 variables (hour, month)\")\nprint(f\"  - Total features: {len(modeling_cols)}\")\n\nprint(f\"\\nTarget categories:\")\nprint(f\"  - Fish-only community: {len(fish_target_cols)} targets\")\nprint(f\"  - Marine community: {len(marine_target_cols)} targets\")\n\n# Model configurations with biological screening in mind\nmodels = {\n    'Logistic Regression': LogisticRegression(max_iter=1000, random_state=42),\n    'Decision Tree': DecisionTreeClassifier(\n        max_depth=8,           # Prevent overfitting while allowing complexity\n        min_samples_leaf=10,   # Ensure robust leaf nodes\n        random_state=42\n    ),\n    'Random Forest': RandomForestClassifier(\n        n_estimators=100,      # Good balance of performance vs speed\n        max_depth=8,           # Match decision tree depth\n        min_samples_leaf=5,    # Allow slightly smaller leaves in ensemble\n        random_state=42\n    ),\n}\nprint(f\"Models configured: {list(models.keys())}\")\n\n# Initialize results storage\nall_model_results = {}\nall_modeling_datasets = {}\nall_scalers = {}\n\n# =====================================================================\n# FISH-ONLY COMMUNITY MODELING\n# =====================================================================\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"FISH-ONLY COMMUNITY MODEL TRAINING\")\nprint(\"=\"*60)\n\n# Prepare fish-only dataset\ndf_fish_modeling = df_community[modeling_cols + fish_target_cols].dropna()\nprint(f\"Fish modeling dataset: {df_fish_modeling.shape[0]:,} complete samples\")\nprint(f\"Fish data completeness: {len(df_fish_modeling)/len(df_community):.1%} of original data\")\n\n# Feature matrix preparation for fish\nX_fish_features = df_fish_modeling[modeling_cols]\n\n# Standardization for fish data\nprint(f\"\\nStandardizing fish community features...\")\nprint(f\"Before scaling - Temperature range: {X_fish_features['Water temp (\u00b0C)'].min():.1f} to {X_fish_features['Water temp (\u00b0C)'].max():.1f}\")\nif 'ACTspFract' in X_fish_features.columns:\n    print(f\"Before scaling - ACTspFract range: {X_fish_features['ACTspFract'].min():.3f} to {X_fish_features['ACTspFract'].max():.3f}\")\n\nscaler_fish = StandardScaler()\nX_fish_scaled = scaler_fish.fit_transform(X_fish_features)\nprint(f\"After scaling - All features have mean\u22480, std\u22481\")\n\n# Store fish datasets and scaler\nall_modeling_datasets['fish'] = df_fish_modeling\nall_scalers['fish'] = scaler_fish\n\n# Train fish models\nfish_model_results = {}\n\nfor target_name in fish_target_cols:\n    print(f\"\\nTraining fish models for: {target_name}\")\n    y_target = df_fish_modeling[target_name]\n\n    # Check class balance\n    class_balance = y_target.value_counts(normalize=True)\n    print(f\"Class balance: {class_balance.to_dict()}\")\n\n    if y_target.std() == 0:  # Skip if no variance\n        print(f\"Skipping {target_name} - no variance in target\")\n        continue\n\n    # Split data\n    X_train, X_test, y_train, y_test = train_test_split(\n        X_fish_scaled, y_target, test_size=0.3, random_state=42, stratify=y_target\n    )\n\n    target_results = {}\n\n    for model_name, model in models.items():\n        # Create fresh model instance\n        model_instance = type(model)(**model.get_params())\n\n        # Train model\n        model_instance.fit(X_train, y_train)\n\n        # Predictions\n        y_pred = model_instance.predict(X_test)\n        y_prob = model_instance.predict_proba(X_test)[:, 1] if hasattr(model_instance, 'predict_proba') else y_pred\n\n        # Metrics\n        accuracy = accuracy_score(y_test, y_pred)\n        precision = precision_score(y_test, y_pred, average='binary', zero_division=0)\n        recall = recall_score(y_test, y_pred, average='binary', zero_division=0)\n        f1 = f1_score(y_test, y_pred, average='binary', zero_division=0)\n        kappa = cohen_kappa_score(y_test, y_pred)\n\n        # Cross-validation\n        cv_model = type(model)(**model.get_params())\n        cv_scores = cross_val_score(cv_model, X_fish_scaled, y_target, cv=StratifiedKFold(5), scoring='f1')\n\n        target_results[model_name] = {\n            'model': model_instance,\n            'accuracy': accuracy,\n            'precision': precision,\n            'recall': recall,\n            'f1': f1,\n            'kappa': kappa,\n            'cv_f1_mean': cv_scores.mean(),\n            'cv_f1_std': cv_scores.std(),\n            'y_test': y_test,\n            'y_pred': y_pred,\n            'y_prob': y_prob,\n            'community_type': 'fish'\n        }\n\n        print(f\"  {model_name}: F1={f1:.3f}, Precision={precision:.3f}, Recall={recall:.3f}\")\n\n    fish_model_results[target_name] = target_results\n\nall_model_results['fish'] = fish_model_results\n\n# =====================================================================\n# MARINE COMMUNITY MODELING (if available)\n# =====================================================================\n\nmarine_model_results = {}\nX_marine_scaled = None\ndf_marine_modeling = None\nscaler_marine = None\n\nif df_marine is not None:\n    print(\"\\n\" + \"=\"*60)\n    print(\"MARINE COMMUNITY (FISH + DOLPHIN) MODEL TRAINING\")\n    print(\"=\"*60)\n\n    # Prepare marine dataset\n    df_marine_modeling = df_marine[modeling_cols + marine_target_cols].dropna()\n    print(f\"Marine modeling dataset: {df_marine_modeling.shape[0]:,} complete samples\")\n    print(f\"Marine data completeness: {len(df_marine_modeling)/len(df_marine):.1%} of original marine data\")\n\n    # Feature matrix preparation for marine\n    X_marine_features = df_marine_modeling[modeling_cols]\n\n    # Standardization for marine data\n    print(f\"\\nStandardizing marine community features...\")\n    print(f\"Before scaling - Temperature range: {X_marine_features['Water temp (\u00b0C)'].min():.1f} to {X_marine_features['Water temp (\u00b0C)'].max():.1f}\")\n    if 'ACTspFract' in X_marine_features.columns:\n        print(f\"Before scaling - ACTspFract range: {X_marine_features['ACTspFract'].min():.3f} to {X_marine_features['ACTspFract'].max():.3f}\")\n\n    scaler_marine = StandardScaler()\n    X_marine_scaled = scaler_marine.fit_transform(X_marine_features)\n    print(f\"After scaling - All features have mean\u22480, std\u22481\")\n\n    # Store marine datasets and scaler\n    all_modeling_datasets['marine'] = df_marine_modeling\n    all_scalers['marine'] = scaler_marine\n\n    # Train marine models\n    for target_name in marine_target_cols:\n        print(f\"\\nTraining marine models for: {target_name}\")\n        y_target = df_marine_modeling[target_name]\n\n        # Check class balance\n        class_balance = y_target.value_counts(normalize=True)\n        print(f\"Class balance: {class_balance.to_dict()}\")\n\n        if y_target.std() == 0:  # Skip if no variance\n            print(f\"Skipping {target_name} - no variance in target\")\n            continue\n\n        # Split data\n        X_train, X_test, y_train, y_test = train_test_split(\n            X_marine_scaled, y_target, test_size=0.3, random_state=42, stratify=y_target\n        )\n\n        target_results = {}\n\n        for model_name, model in models.items():\n            # Create fresh model instance\n            model_instance = type(model)(**model.get_params())\n\n            # Train model\n            model_instance.fit(X_train, y_train)\n\n            # Predictions\n            y_pred = model_instance.predict(X_test)\n            y_prob = model_instance.predict_proba(X_test)[:, 1] if hasattr(model_instance, 'predict_proba') else y_pred\n\n            # Metrics\n            accuracy = accuracy_score(y_test, y_pred)\n            precision = precision_score(y_test, y_pred, average='binary', zero_division=0)\n            recall = recall_score(y_test, y_pred, average='binary', zero_division=0)\n            f1 = f1_score(y_test, y_pred, average='binary', zero_division=0)\n            kappa = cohen_kappa_score(y_test, y_pred)\n\n            # Cross-validation\n            cv_model = type(model)(**model.get_params())\n            cv_scores = cross_val_score(cv_model, X_marine_scaled, y_target, cv=StratifiedKFold(5), scoring='f1')\n\n            target_results[model_name] = {\n                'model': model_instance,\n                'accuracy': accuracy,\n                'precision': precision,\n                'recall': recall,\n                'f1': f1,\n                'kappa': kappa,\n                'cv_f1_mean': cv_scores.mean(),\n                'cv_f1_std': cv_scores.std(),\n                'y_test': y_test,\n                'y_pred': y_pred,\n                'y_prob': y_prob,\n                'community_type': 'marine'\n            }\n\n            print(f\"  {model_name}: F1={f1:.3f}, Precision={precision:.3f}, Recall={recall:.3f}\")\n\n        marine_model_results[target_name] = target_results\n\n    all_model_results['marine'] = marine_model_results\n\nelse:\n    print(\"\\n\u26a0\ufe0f Marine community data not available - training fish-only models only\")\n\n# =====================================================================\n# COMPARATIVE SUMMARY\n# =====================================================================\n\nprint(\"\\n\" + \"=\"*80)\nprint(\"COMPARATIVE MODELING SUMMARY\")\nprint(\"=\"*80)\n\nprint(f\"Fish-only community: {len(fish_model_results)} targets trained\")\nif marine_model_results:\n    print(f\"Marine community: {len(marine_model_results)} targets trained\")\n    print(f\"Total model training runs: {(len(fish_model_results) + len(marine_model_results)) * len(models)}\")\nelse:\n    print(f\"Marine community: Not available\")\n    print(f\"Total model training runs: {len(fish_model_results) * len(models)}\")\n\nprint(f\"\\nModel training complete!\")", "code_hash": "bf9fb162b4b06123ade04dc86e0ca05d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "BYtC", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Feature Importance Analysis\n\nUnderstanding which acoustic indices and environmental variables are most important for detecting community activity.\n\"\"\"\n)", "code_hash": "1eff32d134ea64fd2f0e7c4925bf88c4", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "RGSE", "name": "_"}, {"code": "# Feature importance analysis for both community types\nprint(\"Analyzing feature importance for both community types...\")\nprint(\"=\"*70)\n\nall_feature_importance_results = {}\n\n# =====================================================================\n# FISH COMMUNITY FEATURE IMPORTANCE\n# =====================================================================\n\nprint(\"\\nFISH COMMUNITY FEATURE IMPORTANCE\")\nprint(\"=\"*50)\n\nfish_feature_importance = {}\n\nif 'fish' in all_model_results and X_fish_scaled is not None:\n    _df_fish_modeling = all_modeling_datasets['fish']\n\n    for target_name in fish_target_cols:\n        if target_name not in all_model_results['fish']:\n            continue\n\n        _y_target = _df_fish_modeling[target_name]\n\n        # Mutual information feature importance\n        mi_scores = mutual_info_classif(X_fish_scaled, _y_target, random_state=42)\n\n        # Random Forest feature importance (if available)\n        rf_model = all_model_results['fish'][target_name].get('Random Forest', {}).get('model')\n        rf_importance = rf_model.feature_importances_ if rf_model else np.zeros(len(modeling_cols))\n\n        # Create feature importance dataframe\n        importance_df = pd.DataFrame({\n            'feature': modeling_cols,\n            'mutual_info': mi_scores,\n            'rf_importance': rf_importance,\n            'community_type': 'fish',\n            'target': target_name\n        }).sort_values('mutual_info', ascending=False)\n\n        fish_feature_importance[target_name] = importance_df\n\n        print(f\"\\nTop 5 features for FISH {target_name}:\")\n        print(importance_df[['feature', 'mutual_info', 'rf_importance']].head())\n\n    all_feature_importance_results['fish'] = fish_feature_importance\n\n# =====================================================================\n# MARINE COMMUNITY FEATURE IMPORTANCE\n# =====================================================================\n\nmarine_feature_importance = {}\n\nif 'marine' in all_model_results and X_marine_scaled is not None:\n    print(\"\\nMARINE COMMUNITY FEATURE IMPORTANCE\")\n    print(\"=\"*50)\n\n    _df_marine_modeling = all_modeling_datasets['marine']\n\n    for _target_name in marine_target_cols:\n        if _target_name not in all_model_results['marine']:\n            continue\n\n        _y_target = _df_marine_modeling[_target_name]\n\n        # Mutual information feature importance\n        mi_scores = mutual_info_classif(X_marine_scaled, _y_target, random_state=42)\n\n        # Random Forest feature importance (if available)\n        rf_model = all_model_results['marine'][_target_name].get('Random Forest', {}).get('model')\n        rf_importance = rf_model.feature_importances_ if rf_model else np.zeros(len(modeling_cols))\n\n        # Create feature importance dataframe\n        importance_df = pd.DataFrame({\n            'feature': modeling_cols,\n            'mutual_info': mi_scores,\n            'rf_importance': rf_importance,\n            'community_type': 'marine', \n            'target': _target_name\n        }).sort_values('mutual_info', ascending=False)\n\n        marine_feature_importance[_target_name] = importance_df\n\n        print(f\"\\nTop 5 features for MARINE {_target_name}:\")\n        print(importance_df[['feature', 'mutual_info', 'rf_importance']].head())\n\n    all_feature_importance_results['marine'] = marine_feature_importance\n\nelse:\n    print(\"\\nMarine community feature importance not available - marine data not loaded\")\n\n# =====================================================================\n# COMPARATIVE FEATURE IMPORTANCE SUMMARY\n# =====================================================================\n\nprint(\"\\n\" + \"=\"*70)\nprint(\"COMPARATIVE FEATURE IMPORTANCE SUMMARY\")\nprint(\"=\"*70)\n\n# Find common high-importance features across both communities\nif 'fish' in all_feature_importance_results and 'marine' in all_feature_importance_results:\n    print(\"\\nComparing feature importance between fish-only and marine communities...\")\n\n    # Get top features from comparable targets\n    _fish_high_activity = fish_feature_importance.get('high_activity_75th')\n    _marine_high_activity = marine_feature_importance.get('high_marine_activity_75th')\n\n    if _fish_high_activity is not None and _marine_high_activity is not None:\n        fish_top_5 = set(_fish_high_activity.head(5)['feature'])\n        marine_top_5 = set(_marine_high_activity.head(5)['feature'])\n\n        common_features = fish_top_5.intersection(marine_top_5)\n        fish_unique = fish_top_5 - marine_top_5\n        _marine_unique = marine_top_5 - fish_top_5\n\n        print(f\"\\nFeature importance comparison (high activity targets):\")\n        print(f\"Common top-5 features: {list(common_features)}\")\n        print(f\"Fish-only top-5 unique: {list(fish_unique)}\")\n        print(f\"Marine top-5 unique: {list(_marine_unique)}\")", "code_hash": "b832674560a85b236328a20ec2401380", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Kclp", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Comparative Model Performance Analysis\n\nComparing fish-only vs. marine community model performance to understand the value of including dolphins in biological screening.\n\"\"\"\n)", "code_hash": "95b0c0b2450af48082e4453ebdb52897", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "emfo", "name": "_"}, {"code": "# Comparative model performance analysis\nprint(\"COMPARATIVE MODEL PERFORMANCE ANALYSIS\")\nprint(\"=\"*60)\n\nperformance_results = []\n\n# Collect all performance metrics\nfor community_type, community_results in all_model_results.items():\n    for _target_name_perf, _target_results in community_results.items():\n        for _model_name, _results in _target_results.items():\n            performance_results.append({\n                'community_type': community_type,\n                'target': _target_name_perf,\n                'model': _model_name,\n                'accuracy': _results['accuracy'],\n                'precision': _results['precision'],\n                'recall': _results['recall'],\n                'f1': _results['f1'],\n                'kappa': _results['kappa'],\n                'cv_f1_mean': _results['cv_f1_mean'],\n                'cv_f1_std': _results['cv_f1_std']\n            })\n\n# Convert to DataFrame for easier analysis\nperformance_df = pd.DataFrame(performance_results)\n\nif len(performance_df) > 0:\n    print(f\"\\nPerformance summary across {len(performance_df)} model runs:\")\n    print(performance_df.groupby(['community_type', 'model']).agg({\n        'f1': ['mean', 'std'],\n        'accuracy': ['mean', 'std'],\n        'precision': ['mean', 'std'],\n        'recall': ['mean', 'std']\n    }).round(3))\n\n    # Compare fish vs marine performance if both available\n    if 'fish' in all_model_results and 'marine' in all_model_results:\n        print(\"\\n\" + \"=\"*50)\n        print(\"FISH vs MARINE COMMUNITY PERFORMANCE COMPARISON\")\n        print(\"=\"*50)\n\n        # Compare equivalent targets (high activity 75th percentile)\n        fish_high_activity = performance_df[\n            (performance_df['community_type'] == 'fish') & \n            (performance_df['target'] == 'high_activity_75th')\n        ]\n\n        marine_high_activity = performance_df[\n            (performance_df['community_type'] == 'marine') & \n            (performance_df['target'] == 'high_marine_activity_75th')\n        ]\n\n        if len(fish_high_activity) > 0 and len(marine_high_activity) > 0:\n            print(\"\\nHigh Activity Detection (75th percentile threshold):\")\n            print(\"\\nFish-only community performance:\")\n            print(fish_high_activity[['model', 'f1', 'precision', 'recall']].round(3))\n\n            print(\"\\nMarine community (fish + dolphin) performance:\")\n            print(marine_high_activity[['model', 'f1', 'precision', 'recall']].round(3))\n\n            # Calculate improvement\n            fish_mean_f1 = fish_high_activity['f1'].mean()\n            marine_mean_f1 = marine_high_activity['f1'].mean()\n\n            improvement = ((marine_mean_f1 - fish_mean_f1) / fish_mean_f1) * 100\n\n            print(f\"\\nOverall F1 Score Comparison:\")\n            print(f\"Fish-only community: {fish_mean_f1:.3f}\")\n            print(f\"Marine community: {marine_mean_f1:.3f}\")\n            print(f\"Improvement with dolphins: {improvement:+.1f}%\")\n\n        # Dolphin-specific analysis\n        dolphin_results = performance_df[\n            (performance_df['community_type'] == 'marine') & \n            (performance_df['target'] == 'dolphin_present')\n        ]\n\n        if len(dolphin_results) > 0:\n            print(\"\\n\" + \"-\"*40)\n            print(\"DOLPHIN PRESENCE DETECTION PERFORMANCE\")\n            print(\"-\"*40)\n            print(dolphin_results[['model', 'f1', 'precision', 'recall']].round(3))\n\n            best_dolphin_model = dolphin_results.loc[dolphin_results['f1'].idxmax()]\n            print(f\"\\nBest model for dolphin detection: {best_dolphin_model['model']} (F1={best_dolphin_model['f1']:.3f})\")\n\nelse:\n    print(\"No performance results available for comparison\")", "code_hash": "bfab1cb33e1b46056f3cede5166a7448", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hstk", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Temporal Pattern Concordance Analysis\n\nComparing how well acoustic indices capture the same temporal patterns (diel and seasonal) as manual detections for both fish-only and marine communities.\n\"\"\"\n)", "code_hash": "6cd7c3c5c04baf4a67bebb2fe7f0f2d6", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "nWHF", "name": "_"}, {"code": "# Temporal pattern concordance analysis\nprint(\"TEMPORAL PATTERN CONCORDANCE ANALYSIS\")\nprint(\"=\"*60)\n\n# Get top 10 acoustic indices for manageable analysis\nindex_cols_subset = [col for col in modeling_cols if col not in ['Water temp (\u00b0C)', 'Water depth (m)', 'hour', 'month']][:10]\n\nall_concordance_results = {}\n\n# =====================================================================\n# FISH COMMUNITY TEMPORAL PATTERNS\n# =====================================================================\n\nprint(\"\\nFISH COMMUNITY TEMPORAL PATTERNS\")\nprint(\"=\"*40)\n\n# 1. Fish Diel Pattern Analysis\nfish_diel_patterns = df_community.groupby('hour').agg({\n    'total_fish_activity': 'mean',\n    'num_active_species': 'mean',\n    **{idx: 'mean' for idx in index_cols_subset}\n}).reset_index()\n\n# 2. Fish Seasonal Pattern Analysis  \nfish_seasonal_patterns = df_community.groupby('month').agg({\n    'total_fish_activity': 'mean',\n    'num_active_species': 'mean', \n    **{idx: 'mean' for idx in index_cols_subset}\n}).reset_index()\n\n# Calculate fish correlations\nfish_diel_correlations = {}\nfish_seasonal_correlations = {}\n\nfor idx in index_cols_subset:\n    # Diel correlations\n    diel_corr, diel_p = spearmanr(fish_diel_patterns['total_fish_activity'], fish_diel_patterns[idx])\n    fish_diel_correlations[idx] = {'correlation': diel_corr, 'p_value': diel_p}\n\n    # Seasonal correlations\n    seasonal_corr, seasonal_p = spearmanr(fish_seasonal_patterns['total_fish_activity'], fish_seasonal_patterns[idx])\n    fish_seasonal_correlations[idx] = {'correlation': seasonal_corr, 'p_value': seasonal_p}\n\n# Convert to dataframes\nfish_diel_corr_df = pd.DataFrame(fish_diel_correlations).T.sort_values('correlation', key=abs, ascending=False)\nfish_seasonal_corr_df = pd.DataFrame(fish_seasonal_correlations).T.sort_values('correlation', key=abs, ascending=False)\n\nprint(\"\\nTop 5 indices for FISH diel pattern concordance:\")\nprint(fish_diel_corr_df.head().round(3))\n\nprint(\"\\nTop 5 indices for FISH seasonal pattern concordance:\")\nprint(fish_seasonal_corr_df.head().round(3))\n\nall_concordance_results['fish'] = {\n    'diel_patterns': fish_diel_patterns,\n    'seasonal_patterns': fish_seasonal_patterns,\n    'diel_correlations': fish_diel_corr_df,\n    'seasonal_correlations': fish_seasonal_corr_df\n}\n\n# =====================================================================\n# MARINE COMMUNITY TEMPORAL PATTERNS (if available)\n# =====================================================================\n\nif df_marine is not None:\n    print(\"\\nMARINE COMMUNITY TEMPORAL PATTERNS\")\n    print(\"=\"*40)\n\n    # 1. Marine Diel Pattern Analysis\n    marine_diel_patterns = df_marine.groupby('hour').agg({\n        'total_marine_activity': 'mean',\n        'num_active_marine_species': 'mean',\n        'dolphin_activity': 'mean',\n        **{idx: 'mean' for idx in index_cols_subset}\n    }).reset_index()\n\n    # 2. Marine Seasonal Pattern Analysis\n    marine_seasonal_patterns = df_marine.groupby('month').agg({\n        'total_marine_activity': 'mean', \n        'num_active_marine_species': 'mean',\n        'dolphin_activity': 'mean',\n        **{idx: 'mean' for idx in index_cols_subset}\n    }).reset_index()\n\n    # Calculate marine correlations\n    marine_diel_correlations = {}\n    marine_seasonal_correlations = {}\n\n    for idx in index_cols_subset:\n        # Diel correlations\n        diel_corr, diel_p = spearmanr(marine_diel_patterns['total_marine_activity'], marine_diel_patterns[idx])\n        marine_diel_correlations[idx] = {'correlation': diel_corr, 'p_value': diel_p}\n\n        # Seasonal correlations\n        seasonal_corr, seasonal_p = spearmanr(marine_seasonal_patterns['total_marine_activity'], marine_seasonal_patterns[idx])\n        marine_seasonal_correlations[idx] = {'correlation': seasonal_corr, 'p_value': seasonal_p}\n\n    # Convert to dataframes\n    marine_diel_corr_df = pd.DataFrame(marine_diel_correlations).T.sort_values('correlation', key=abs, ascending=False)\n    marine_seasonal_corr_df = pd.DataFrame(marine_seasonal_correlations).T.sort_values('correlation', key=abs, ascending=False)\n\n    print(\"\\nTop 5 indices for MARINE diel pattern concordance:\")\n    print(marine_diel_corr_df.head().round(3))\n\n    print(\"\\nTop 5 indices for MARINE seasonal pattern concordance:\")\n    print(marine_seasonal_corr_df.head().round(3))\n\n    all_concordance_results['marine'] = {\n        'diel_patterns': marine_diel_patterns,\n        'seasonal_patterns': marine_seasonal_patterns,\n        'diel_correlations': marine_diel_corr_df,\n        'seasonal_correlations': marine_seasonal_corr_df\n    }\n\n    # =====================================================================\n    # COMPARATIVE CONCORDANCE ANALYSIS\n    # =====================================================================\n\n    print(\"\\n\" + \"=\"*60)\n    print(\"FISH vs MARINE TEMPORAL CONCORDANCE COMPARISON\")\n    print(\"=\"*60)\n\n    # Compare which indices are most consistent between fish and marine patterns\n    common_diel_indices = set(fish_diel_corr_df.head(5).index).intersection(set(marine_diel_corr_df.head(5).index))\n    common_seasonal_indices = set(fish_seasonal_corr_df.head(5).index).intersection(set(marine_seasonal_corr_df.head(5).index))\n\n    print(f\"\\nCommon top-5 diel pattern indices: {list(common_diel_indices)}\")\n    print(f\"Common top-5 seasonal pattern indices: {list(common_seasonal_indices)}\")\n\n    # Calculate concordance improvement with marine data\n    fish_diel_mean_concordance = abs(fish_diel_corr_df.head(5)['correlation']).mean()\n    marine_diel_mean_concordance = abs(marine_diel_corr_df.head(5)['correlation']).mean()\n\n    diel_improvement = ((marine_diel_mean_concordance - fish_diel_mean_concordance) / fish_diel_mean_concordance) * 100\n\n    print(f\"\\nDiel pattern concordance comparison:\")\n    print(f\"Fish-only mean |correlation|: {fish_diel_mean_concordance:.3f}\")\n    print(f\"Marine mean |correlation|: {marine_diel_mean_concordance:.3f}\")\n    print(f\"Improvement with dolphins: {diel_improvement:+.1f}%\")\n\nelse:\n    print(\"\\nMarine community temporal analysis not available - marine data not loaded\")", "code_hash": "0673a5d2014cc877042809ca5702aa86", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iLit", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Final Analysis Summary and Recommendations\n\nSynthesizing findings from the comparative fish-only vs. marine community analysis to provide actionable insights for biological screening and monitoring.\n\"\"\"\n)", "code_hash": "98144cdcb541e8105d1c6825d91aeccb", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ZHCJ", "name": "_"}, {"code": "# Final analysis summary and recommendations\nprint(\"FINAL ANALYSIS SUMMARY AND RECOMMENDATIONS\")\nprint(\"=\"*80)\n\nrecommendations = []\n\n# 1. Model Performance Assessment\nif len(performance_df) > 0:\n    print(\"\\n1. MODEL PERFORMANCE ASSESSMENT\")\n    print(\"=\"*40)\n\n    # Overall best performers\n    best_models = performance_df.loc[performance_df.groupby(['community_type'])['f1'].idxmax()]\n\n    for _, row in best_models.iterrows():\n        print(f\"Best {row['community_type']} model: {row['model']} for {row['target']} (F1={row['f1']:.3f})\")\n\n    # Marine vs Fish comparison\n    if 'fish' in all_model_results and 'marine' in all_model_results:\n        fish_results = performance_df[performance_df['community_type'] == 'fish']\n        marine_results = performance_df[performance_df['community_type'] == 'marine']\n\n        fish_mean_f1 = fish_results['f1'].mean()\n        marine_mean_f1 = marine_results['f1'].mean()\n\n        if marine_mean_f1 > fish_mean_f1:\n            improvement = ((marine_mean_f1 - fish_mean_f1) / fish_mean_f1) * 100\n            recommendations.append(\n                f\"\u2705 Marine community models show {improvement:.1f}% average improvement over fish-only models\"\n            )\n            recommendations.append(\n                \"Recommendation: Include dolphin data in biological screening models for enhanced performance\"\n            )\n        else:\n            decline = ((fish_mean_f1 - marine_mean_f1) / fish_mean_f1) * 100\n            recommendations.append(\n                f\"\u26a0\ufe0f Marine community models show {decline:.1f}% average decline vs fish-only models\"\n            )\n            recommendations.append(\n                \"Recommendation: Evaluate if dolphin integration method needs refinement\"\n            )\n\n# 2. Feature Importance Insights\nprint(\"\\n2. FEATURE IMPORTANCE INSIGHTS\")\nprint(\"=\"*40)\n\nif 'fish' in all_feature_importance_results and 'marine' in all_feature_importance_results:\n    # Find most stable features across both community types\n    fish_features = all_feature_importance_results['fish']\n    marine_features = all_feature_importance_results['marine']\n\n    # Get high activity features as representative\n    if 'high_activity_75th' in fish_features and 'high_marine_activity_75th' in marine_features:\n        fish_top_features = set(fish_features['high_activity_75th'].head(5)['feature'])\n        marine_top_features = set(marine_features['high_marine_activity_75th'].head(5)['feature'])\n\n        stable_features = fish_top_features.intersection(marine_top_features)\n\n        if len(stable_features) > 0:\n            print(f\"Most stable acoustic indices across both communities: {list(stable_features)}\")\n            recommendations.append(\n                f\"Recommendation: Prioritize these {len(stable_features)} acoustic indices for robust biological screening\"\n            )\n\n        marine_unique = marine_top_features - fish_top_features\n        if len(marine_unique) > 0:\n            print(f\"Indices uniquely important for marine community: {list(marine_unique)}\")\n            recommendations.append(\n                \"Recommendation: Consider marine-specific indices when dolphin activity is suspected\"\n            )\n\n# 3. Temporal Pattern Insights\nprint(\"\\n3. TEMPORAL PATTERN INSIGHTS\")\nprint(\"=\"*40)\n\nif 'fish' in all_concordance_results and 'marine' in all_concordance_results:\n    fish_concordance = all_concordance_results['fish']\n    marine_concordance = all_concordance_results['marine']\n\n    # Compare mean concordance strengths\n    fish_diel_strength = abs(fish_concordance['diel_correlations'].head(3)['correlation']).mean()\n    marine_diel_strength = abs(marine_concordance['diel_correlations'].head(3)['correlation']).mean()\n\n    print(f\"Fish community diel pattern strength: {fish_diel_strength:.3f}\")\n    print(f\"Marine community diel pattern strength: {marine_diel_strength:.3f}\")\n\n    if marine_diel_strength > fish_diel_strength:\n        recommendations.append(\n            \"\u2705 Marine community shows stronger temporal pattern concordance - dolphins enhance signal detectability\"\n        )\n\n    # Get best temporal indices\n    best_diel_index = marine_concordance['diel_correlations'].index[0]\n    best_seasonal_index = marine_concordance['seasonal_correlations'].index[0]\n\n    recommendations.append(\n        f\"Recommendation: Use {best_diel_index} for diel pattern detection and {best_seasonal_index} for seasonal monitoring\"\n    )\n\n# 4. Practical Implementation Recommendations\nprint(\"\\n4. PRACTICAL IMPLEMENTATION RECOMMENDATIONS\")\nprint(\"=\"*50)\n\nif len(recommendations) > 0:\n    for i, rec in enumerate(recommendations, 1):\n        print(f\"{i}. {rec}\")\n\n# 5. Next Steps\nprint(\"\\n5. RECOMMENDED NEXT STEPS\")\nprint(\"=\"*30)\n\nnext_steps = [\n    \"Deploy best-performing models on new acoustic data for validation\",\n    \"Implement real-time biological activity screening using identified key indices\",\n    \"Develop automated alerting system for high marine activity periods\",\n    \"Create dashboard visualization of temporal patterns for monitoring staff\",\n    \"Plan targeted manual validation during predicted high-activity periods\",\n]\n\nif 'marine' in all_model_results:\n    next_steps.append(\"Evaluate dolphin detection performance in different environmental conditions\")\n    next_steps.append(\"Investigate seasonal patterns in marine community interactions\")\n\nfor i, step in enumerate(next_steps, 1):\n    print(f\"{i}. {step}\")\n\nprint(f\"\\n\" + \"=\"*80)\nprint(\"COMPARATIVE ANALYSIS COMPLETE \u2705\")\nprint(f\"Marine community integration {'successful' if 'marine' in all_model_results else 'pending'}\")\nprint(f\"Ready for biological screening deployment\")\nprint(\"=\"*80)", "code_hash": "154df622f6ae9c8b713a8cd90822e4e0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ROlb", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Temporal Pattern Concordance Analysis\n\nComparing how well acoustic indices capture the same temporal patterns (diel and seasonal) as manual detections.\n\"\"\"\n)", "code_hash": "3ad596a8635fc485239348c3d55094ff", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "qnkX", "name": "_"}, {"code": "# Temporal pattern concordance analysis\nprint(\"Analyzing temporal pattern concordance...\")\n\n# 1. Diel Pattern Analysis\ndiel_patterns = df_community.groupby('hour').agg({\n    'total_fish_activity': 'mean',\n    'num_active_species': 'mean',\n    **{idx: 'mean' for idx in index_cols[:10]}  # Top 10 indices for manageable analysis\n}).reset_index()\n\n# 2. Seasonal Pattern Analysis\nseasonal_patterns = df_community.groupby('month').agg({\n    'total_fish_activity': 'mean',\n    'num_active_species': 'mean',\n    **{idx: 'mean' for idx in index_cols[:10]}\n}).reset_index()\n\n# 3. Calculate correlations between fish activity and indices across time\ndiel_correlations = {}\nseasonal_correlations = {}\n\n# Diel correlations\nfor idx in index_cols[:10]:\n    diel_corr, diel_p = spearmanr(diel_patterns['total_fish_activity'], diel_patterns[idx])\n    diel_correlations[idx] = {'correlation': diel_corr, 'p_value': diel_p}\n\n# Seasonal correlations\nfor idx in index_cols[:10]:\n    seasonal_corr, seasonal_p = spearmanr(seasonal_patterns['total_fish_activity'], seasonal_patterns[idx])\n    seasonal_correlations[idx] = {'correlation': seasonal_corr, 'p_value': seasonal_p}\n\n# Convert to dataframes\ndiel_corr_df = pd.DataFrame(diel_correlations).T\nseasonal_corr_df = pd.DataFrame(seasonal_correlations).T\n\n# Sort by correlation strength\ndiel_corr_df = diel_corr_df.reindex(diel_corr_df['correlation'].abs().sort_values(ascending=False).index)\nseasonal_corr_df = seasonal_corr_df.reindex(seasonal_corr_df['correlation'].abs().sort_values(ascending=False).index)\n\nprint(\"Top diel pattern correlations (indices vs fish activity):\")\nprint(diel_corr_df.head())\n\nprint(\"\\nTop seasonal pattern correlations (indices vs fish activity):\")\nprint(seasonal_corr_df.head())\n\n# 4. Cross-station pattern consistency\nstation_consistency = {}\nfor station in df_community['station'].unique():\n    station_data = df_community[df_community['station'] == station]\n\n    # Calculate hourly patterns for this station\n    station_diel = station_data.groupby('hour')['total_fish_activity'].mean()\n    station_seasonal = station_data.groupby('month')['total_fish_activity'].mean()\n\n    station_consistency[station] = {\n        'diel_pattern': station_diel,\n        'seasonal_pattern': station_seasonal\n    }\n\nprint(f\"\\nCross-station analysis complete for {len(station_consistency)} stations\")", "code_hash": "c2a06d3916d11ade8b5f65d191d00ff8", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TqIu", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Biological Screening Performance Evaluation\n\nEvaluating how effectively acoustic indices can screen for periods of biological interest.\n\n## Screening Performance Metrics Explained\n\nTraditional machine learning focuses on accuracy, but biological screening requires different metrics:\n\n### Key Metrics for Biological Applications\n\n**1. Detection Rate (Recall)**\n\n- **Definition**: Percentage of actual biological activity periods that the model correctly identifies\n- **Why it matters**: Missing biological activity = lost scientific data\n- **Target**: >80% for practical screening applications\n\n**2. Screening Precision**\n\n- **Definition**: When the model flags a period as \"high activity,\" how often is it actually active?\n- **Why it matters**: False alarms waste manual effort\n- **Target**: >70% to maintain efficiency gains\n\n**3. Effort Reduction**\n\n- **Definition**: Percentage of data that can be skipped without manual analysis\n- **Why it matters**: This is the primary value proposition - saving time and money\n- **Target**: >50% reduction to justify deployment costs\n\n**4. F1 Score**\n\n- **Definition**: Harmonic mean of precision and recall (balances both)\n- **Why it matters**: Single metric for comparing models\n- **Target**: >0.7 for good performance, >0.8 for excellent\n\n## Real-World Translation\n\nA screening system with 80% detection rate, 75% precision, and 60% effort reduction means:\n\n- Analyze only 40% of your data manually\n- Catch 80% of all biological activity\n- When you do analyze a flagged period, it's biologically interesting 75% of the time\n- Save ~60% of analysis time while maintaining most scientific value\n\"\"\"\n)", "code_hash": "65c8194f79b1157faa95a4ba2444f97e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Vxnm", "name": "_"}, {"code": "# Biological screening performance evaluation\nprint(\"Evaluating biological screening performance...\")\n\nscreening_results = {}\n\nfor target_name_screen, target_models in model_results.items():\n    print(f\"\\nScreening evaluation for: {target_name_screen}\")\n\n    # Get best performing model (highest F1 score)\n    best_model_name = max(target_models.keys(),\n                        key=lambda x: target_models[x]['f1'])\n    best_model_results = target_models[best_model_name]\n\n    print(f\"Best model: {best_model_name} (F1: {best_model_results['f1']:.3f})\")\n\n    # Screening efficiency analysis\n    y_true_screen = best_model_results['y_test']\n    y_pred_screen = best_model_results['y_pred']\n    y_prob_screen = best_model_results['y_prob']\n\n    # Calculate efficiency metrics\n    true_positives = np.sum((y_true_screen == 1) & (y_pred_screen == 1))\n    false_positives = np.sum((y_true_screen == 0) & (y_pred_screen == 1))\n    true_negatives = np.sum((y_true_screen == 0) & (y_pred_screen == 0))\n    false_negatives = np.sum((y_true_screen == 1) & (y_pred_screen == 0))\n\n    # Screening efficiency: how much effort could be saved?\n    total_periods = len(y_true_screen)\n    flagged_periods = np.sum(y_pred_screen == 1)\n    actual_active_periods = np.sum(y_true_screen == 1)\n\n    # If we only manually check flagged periods, what's the efficiency?\n    effort_reduction = (total_periods - flagged_periods) / total_periods\n    detection_rate = true_positives / actual_active_periods if actual_active_periods > 0 else 0\n\n    # Precision in screening context: of flagged periods, how many are actually active?\n    screening_precision = true_positives / flagged_periods if flagged_periods > 0 else 0\n\n    screening_results[target_name_screen] = {\n        'best_model': best_model_name,\n        'f1_score': best_model_results['f1'],\n        'precision': best_model_results['precision'],\n        'recall': best_model_results['recall'],\n        'effort_reduction': effort_reduction,\n        'detection_rate': detection_rate,\n        'screening_precision': screening_precision,\n        'total_periods': total_periods,\n        'flagged_periods': flagged_periods,\n        'actual_active_periods': actual_active_periods,\n        'true_positives': true_positives,\n        'false_positives': false_positives,\n        'false_negatives': false_negatives\n    }\n\n    print(f\"  Effort reduction: {effort_reduction:.1%}\")\n    print(f\"  Detection rate: {detection_rate:.1%}\")\n    print(f\"  Screening precision: {screening_precision:.1%}\")\n\n# Overall screening assessment\nprint(\"\\n\" + \"=\"*60)\nprint(\"BIOLOGICAL SCREENING ASSESSMENT SUMMARY\")\nprint(\"=\"*60)\n\nfor target_name_summary, results in screening_results.items():\n    print(f\"\\n{target_name_summary.upper()}:\")\n    print(f\"  Best Model: {results['best_model']}\")\n    print(f\"  F1 Score: {results['f1_score']:.3f}\")\n    print(f\"  Manual Effort Reduction: {results['effort_reduction']:.1%}\")\n    print(f\"  Biological Detection Rate: {results['detection_rate']:.1%}\")\n    print(f\"  Screening Precision: {results['screening_precision']:.1%}\")", "code_hash": "f8464dc623cf63af7dc10337888f3691", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "DnEU", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Visualization: Community Patterns and Screening Performance\n\nCreating comprehensive visualizations to show community pattern detection and screening tool performance.\n\"\"\"\n)", "code_hash": "6c6b523213fb7409bbb0ffc5b364ca57", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ulZA", "name": "_"}, {"code": "# Create comprehensive visualizations\nprint(\"Creating community pattern and screening visualizations...\")\n\n# 1. Diel Pattern Concordance\nplt.figure(figsize=(12, 8))\n\n# Main fish activity pattern\nplt.subplot(2, 2, 1)\nplt.plot(diel_patterns['hour'], diel_patterns['total_fish_activity'], 'bo-', linewidth=2, label='Fish Activity')\nplt.xlabel('Hour of Day')\nplt.ylabel('Mean Total Fish Activity')\nplt.title('Diel Pattern: Community Fish Activity')\nplt.grid(True, alpha=0.3)\nplt.xticks(range(0, 24, 4))\n\n# Top correlated index\nplt.subplot(2, 2, 2)\nif len(diel_corr_df) > 0:\n    top_index = diel_corr_df.index[0]\n    plt.plot(diel_patterns['hour'], diel_patterns[top_index], 'ro-', linewidth=2, label=f'{top_index}')\n    plt.xlabel('Hour of Day')\n    plt.ylabel(f'Mean {top_index}')\n    plt.title(f'Diel Pattern: Best Index ({top_index})\\nCorrelation: {diel_corr_df.iloc[0][\"correlation\"]:.3f}')\n    plt.grid(True, alpha=0.3)\n    plt.xticks(range(0, 24, 4))\n\n# Seasonal patterns\nplt.subplot(2, 2, 3)\nplt.plot(seasonal_patterns['month'], seasonal_patterns['total_fish_activity'], 'go-', linewidth=2)\nplt.xlabel('Month')\nplt.ylabel('Mean Total Fish Activity')\nplt.title('Seasonal Pattern: Community Fish Activity')\nplt.grid(True, alpha=0.3)\nplt.xticks(range(1, 13))\n\n# Cross-station comparison\nplt.subplot(2, 2, 4)\nfor station_viz, patterns in station_consistency.items():\n    plt.plot(patterns['diel_pattern'].index, patterns['diel_pattern'].values,\n            'o-', alpha=0.7, label=f'Station {station_viz}')\nplt.xlabel('Hour of Day')\nplt.ylabel('Mean Fish Activity')\nplt.title('Cross-Station Diel Patterns')\nplt.legend()\nplt.grid(True, alpha=0.3)\nplt.xticks(range(0, 24, 4))\n\nplt.tight_layout()\nplt.savefig(plot_dir / '06_temporal_pattern_concordance.png', dpi=150, bbox_inches='tight')\nplt.show()\n\n# 2. Feature Importance Comparison\nif len(feature_importance_results) > 0:\n    fig, axes = plt.subplots(2, 2, figsize=(14, 10))\n    axes = axes.ravel()\n\n    for i, (target_name_viz, importance_df_viz) in enumerate(feature_importance_results.items()):\n        if i >= 4:  # Max 4 subplots\n            break\n\n        ax = axes[i]\n        top_features = importance_df_viz.head(8)\n\n        y_pos = range(len(top_features))\n        ax.barh(y_pos, top_features['mutual_info'], alpha=0.7, color='steelblue')\n        ax.set_yticks(y_pos)\n        ax.set_yticklabels(top_features['feature'], fontsize=8)\n        ax.set_xlabel('Mutual Information Score')\n        ax.set_title(f'Feature Importance: {target_name_viz}')\n        ax.grid(True, alpha=0.3, axis='x')\n        ax.invert_yaxis()\n\n    plt.tight_layout()\n    plt.savefig(plot_dir / '06_feature_importance.png', dpi=150, bbox_inches='tight')\n    plt.show()\n\n# 3. Screening Performance Summary\nplt.figure(figsize=(12, 6))\n\n# Performance metrics\nplt.subplot(1, 2, 1)\nmetrics = ['f1_score', 'precision', 'recall']\ntarget_names = list(screening_results.keys())\n\nx_pos = np.arange(len(target_names))\nwidth = 0.25\n\nfor i, metric in enumerate(metrics):\n    values = [screening_results[target][metric] for target in target_names]\n    plt.bar(x_pos + i*width, values, width, alpha=0.7, label=metric.replace('_', ' ').title())\n\nplt.xlabel('Target Classification')\nplt.ylabel('Score')\nplt.title('Model Performance by Target')\nplt.xticks(x_pos + width, [name.replace('_', ' ').title() for name in target_names], rotation=45, ha='right')\nplt.legend()\nplt.grid(True, alpha=0.3, axis='y')\nplt.ylim(0, 1)\n\n# Efficiency metrics\nplt.subplot(1, 2, 2)\nefficiency_metrics = ['effort_reduction', 'detection_rate', 'screening_precision']\n\nfor i, metric in enumerate(efficiency_metrics):\n    values = [screening_results[target][metric] for target in target_names]\n    plt.bar(x_pos + i*width, values, width, alpha=0.7, label=metric.replace('_', ' ').title())\n\nplt.xlabel('Target Classification')\nplt.ylabel('Rate')\nplt.title('Screening Efficiency by Target')\nplt.xticks(x_pos + width, [name.replace('_', ' ').title() for name in target_names], rotation=45, ha='right')\nplt.legend()\nplt.grid(True, alpha=0.3, axis='y')\nplt.ylim(0, 1)\n\nplt.tight_layout()\nplt.savefig(plot_dir / '06_screening_performance.png', dpi=150, bbox_inches='tight')\nplt.show()\n\nprint(f\"Community pattern visualizations saved to {plot_dir}\")", "code_hash": "21060abcc1b414a4ede090810aba09d5", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ecfG", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Results Summary and Interpretation\n\nSynthesizing findings on community pattern detection and biological screening effectiveness.\n\"\"\"\n)", "code_hash": "90db1ebf0d4461c803810e85435fcb44", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Pvdt", "name": "_"}, {"code": "# Progress tracking cell", "code_hash": "c8da4effb01e3aca787b441406226c84", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZBYS", "name": "_"}, {"code": "# Save all results and create comprehensive summary\nprint(\"Saving results and creating comprehensive summary...\")\n\n# Save processed data\ndf_community.to_parquet(DATA_ROOT / \"processed/06_community_activity_data.parquet\")\n\n# Save model results\nwith open(DATA_ROOT / \"processed/06_community_models.pkl\", 'wb') as f:\n    pickle.dump(model_results, f)\n\n# Save feature importance\nfor target_name_save, importance_df_save in feature_importance_results.items():\n    filename = f\"06_feature_importance_{target_name_save}.parquet\"\n    importance_df_save.to_parquet(DATA_ROOT / \"processed\" / filename)\n\n# Save temporal concordance results\ndiel_corr_df.to_parquet(DATA_ROOT / \"processed/06_diel_correlations.parquet\")\nseasonal_corr_df.to_parquet(DATA_ROOT / \"processed/06_seasonal_correlations.parquet\")\n\n# Create comprehensive summary\nsummary_results = {\n    'community_metrics': {\n        'total_samples': len(df_community),\n        'mean_total_activity': float(df_community['total_fish_activity'].mean()),\n        'mean_active_species': float(df_community['num_active_species'].mean()),\n        'any_activity_rate': float(df_community['any_activity'].mean()),\n        'high_activity_75th_rate': float(df_community['high_activity_75th'].mean()),\n        'high_activity_90th_rate': float(df_community['high_activity_90th'].mean())\n    },\n    'model_performance': {\n        target: {\n            'best_model': results['best_model'],\n            'f1_score': float(results['f1_score']),\n            'precision': float(results['precision']),\n            'recall': float(results['recall'])\n        }\n        for target, results in screening_results.items()\n    },\n    'screening_efficiency': {\n        target: {\n            'effort_reduction': float(results['effort_reduction']),\n            'detection_rate': float(results['detection_rate']),\n            'screening_precision': float(results['screening_precision'])\n        }\n        for target, results in screening_results.items()\n    },\n    'temporal_concordance': {\n        'best_diel_correlation': {\n            'index': diel_corr_df.index[0] if len(diel_corr_df) > 0 else None,\n            'correlation': float(diel_corr_df.iloc[0]['correlation']) if len(diel_corr_df) > 0 else None\n        },\n        'best_seasonal_correlation': {\n            'index': seasonal_corr_df.index[0] if len(seasonal_corr_df) > 0 else None,\n            'correlation': float(seasonal_corr_df.iloc[0]['correlation']) if len(seasonal_corr_df) > 0 else None\n        }\n    }\n}\n\n# Save summary\nwith open(DATA_ROOT / \"processed/06_community_analysis_summary.json\", 'w') as f:\n    json.dump(summary_results, f, indent=2)\n\nprint(\"=\"*70)\nprint(\"COMMUNITY PATTERN DETECTION AND BIOLOGICAL SCREENING SUMMARY\")\nprint(\"=\"*70)\n\nprint(f\"\\nDATASET OVERVIEW:\")\nprint(f\"  - Total samples analyzed: {summary_results['community_metrics']['total_samples']:,}\")\nprint(f\"  - Mean total fish activity: {summary_results['community_metrics']['mean_total_activity']:.2f}\")\nprint(f\"  - Mean active species per period: {summary_results['community_metrics']['mean_active_species']:.2f}\")\nprint(f\"  - Periods with any activity: {summary_results['community_metrics']['any_activity_rate']:.1%}\")\n\nprint(f\"\\nMODEL PERFORMANCE (COMMUNITY ACTIVITY DETECTION):\")\nfor target, performance in summary_results['model_performance'].items():\n    print(f\"  {target.replace('_', ' ').title()}:\")\n    print(f\"    - Best Model: {performance['best_model']}\")\n    print(f\"    - F1 Score: {performance['f1_score']:.3f}\")\n    print(f\"    - Precision: {performance['precision']:.3f}\")\n    print(f\"    - Recall: {performance['recall']:.3f}\")\n\nprint(f\"\\nBIOLOGICAL SCREENING EFFICIENCY:\")\nfor target, efficiency in summary_results['screening_efficiency'].items():\n    print(f\"  {target.replace('_', ' ').title()}:\")\n    print(f\"    - Manual Effort Reduction: {efficiency['effort_reduction']:.1%}\")\n    print(f\"    - Biological Detection Rate: {efficiency['detection_rate']:.1%}\")\n    print(f\"    - Screening Precision: {efficiency['screening_precision']:.1%}\")\n\nprint(f\"\\nTEMPORAL PATTERN CONCORDANCE:\")\nif summary_results['temporal_concordance']['best_diel_correlation']['index']:\n    print(f\"  - Best Diel Pattern Match: {summary_results['temporal_concordance']['best_diel_correlation']['index']}\")\n    print(f\"    Correlation: {summary_results['temporal_concordance']['best_diel_correlation']['correlation']:.3f}\")\nif summary_results['temporal_concordance']['best_seasonal_correlation']['index']:\n    print(f\"  - Best Seasonal Pattern Match: {summary_results['temporal_concordance']['best_seasonal_correlation']['index']}\")\n    print(f\"    Correlation: {summary_results['temporal_concordance']['best_seasonal_correlation']['correlation']:.3f}\")\n\nprint(\"\\n\" + \"=\"*70)\nprint(\"COMPREHENSIVE SCIENTIFIC INTERPRETATION\")\nprint(\"=\"*70)\n\n# Determine key findings based on results\nbest_screening_target = max(summary_results['screening_efficiency'].items(),\n                          key=lambda x: x[1]['detection_rate'])\n\nbest_f1_target = max(summary_results['model_performance'].items(),\n                    key=lambda x: x[1]['f1_score'])\n\nprint(f\"\"\"\n## 1. COMMUNITY ACTIVITY DETECTION PERFORMANCE\n\n**Primary Finding**: Within this study system, acoustic indices show promising ability to detect community-level biological activity\n\n**Best Overall Performance**: {best_f1_target[0].replace('_', ' ').title()}\n- F1 Score: {best_f1_target[1]['f1_score']:.3f} (Good performance - above 0.8 indicates strong model performance)\n- Precision: {best_f1_target[1]['precision']:.3f} (When model predicts activity, it's correct {best_f1_target[1]['precision']:.1%} of the time)\n- Recall: {best_f1_target[1]['recall']:.3f} (Detects {best_f1_target[1]['recall']:.1%} of actual biological activity periods)\n\n**Biological Interpretation**: In this dataset, the model shows ability to distinguish between periods when fish are\ncalling vs when they are not. This suggests potential for acoustic monitoring applications, though validation across\ndifferent systems and environments is needed.\n\n## 2. BIOLOGICAL SCREENING TOOL POTENTIAL\n\n**Primary Finding**: Results suggest indices may serve as screening tools for manual effort guidance in this study system\n\n**Best Screening Performance**: {best_screening_target[0].replace('_', ' ').title()}\n- Detection Rate: {best_screening_target[1]['detection_rate']:.1%} (Detects most biological activity in this dataset)\n- Screening Precision: {best_screening_target[1]['screening_precision']:.1%} (Relatively low false alarm rate)\n- Effort Reduction: {best_screening_target[1]['effort_reduction']:.1%} (Potential workload savings)\n\n**Potential Application**: Based on these results, a researcher might:\n1. Run acoustic indices on 100 hours of recordings from similar environments\n2. Model flags ~{100 - best_screening_target[1]['effort_reduction']*100:.0f} hours as \"high interest\"\n3. Manual analysis of only those {100 - best_screening_target[1]['effort_reduction']*100:.0f} hours could potentially catch {best_screening_target[1]['detection_rate']:.0f}% of biological activity\n4. This approach could save {best_screening_target[1]['effort_reduction']:.0f}% of manual effort while missing {100-best_screening_target[1]['detection_rate']:.0f}% of activity\n\n**Important caveat**: These projections are based on one study system and require validation across different\nenvironments, acoustic setups, and fish communities before operational deployment.\n\n## 3. TEMPORAL PATTERN CONCORDANCE ANALYSIS\n\n**Diel Pattern Matching**: {summary_results['temporal_concordance']['best_diel_correlation']['index']}\n- Correlation: {summary_results['temporal_concordance']['best_diel_correlation']['correlation']:.3f}\n- Interpretation: {\"Strong negative correlation - index decreases when fish activity increases during day\" if summary_results['temporal_concordance']['best_diel_correlation']['correlation'] < -0.7 else \"Strong positive correlation - index tracks fish activity patterns\"}\n\n**Seasonal Pattern Matching**: {summary_results['temporal_concordance']['best_seasonal_correlation']['index']}\n- Correlation: {summary_results['temporal_concordance']['best_seasonal_correlation']['correlation']:.3f}\n- Interpretation: {\"Very strong negative correlation - index shows opposite seasonal pattern to fish\" if summary_results['temporal_concordance']['best_seasonal_correlation']['correlation'] < -0.8 else \"Strong correlation with fish seasonal patterns\"}\n\n**Biological Significance**: Some acoustic indices show correlations with fish calling temporal patterns in this dataset.\nThis suggests they may be capturing biological phenomena rather than just acoustic noise, though this relationship\nrequires validation across different systems and temporal scales.\n\n## 4. FEATURE IMPORTANCE INSIGHTS\n\n**Most Important Predictors** (across all models):\n1. Month (seasonal patterns) - Captures spawning cycles and temperature-driven behavior\n2. Water temperature - Direct physiological driver of fish activity\n3. Acoustic indices (ENRf, VARf, NBPEAKS) - Capture acoustic characteristics of biological sounds\n\n**Scientific Interpretation**: The models rely on biologically sensible variables in this study system. The combination of\nseasonal timing, environmental conditions, and acoustic features shows predictive potential, though the generalizability\nof these relationships across different marine environments remains to be tested.\n\n## 5. COMPARISON TO SPECIES-SPECIFIC APPROACHES\n\n**Why Community-Level May Work Better (in this system)**:\n- Individual species showed weak, irregular calling patterns in this dataset\n- Aggregating across species appears to amplify consistent biological signal\n- May reduce noise from species-specific behavioral variation\n- Could match practical monitoring needs (detect biological activity, then investigate specifics)\n\n**Working hypothesis**: Like using a motion detector vs identifying specific animals - the former may be\nmore reliable for knowing \"when something biological is happening\" in marine acoustic monitoring\n\n## 6. PRACTICAL IMPLEMENTATION RECOMMENDATIONS\n\n**Potential Applications (requiring further validation)**:\n1. **Smart Sampling Protocols**: Indices might help identify optimal times for manual analysis\n2. **Background Monitoring**: Could enable more continuous biological activity tracking\n3. **Site Assessment**: May help characterize biological activity patterns at new locations\n4. **Quality Control**: Could flag unusual periods in long-term datasets for examination\n\n**Suggested Development Strategy**:\n- Test Random Forest or similar ensemble methods for performance\n- Focus initial validation on \"any activity\" detection for general screening\n- Evaluate \"high activity\" thresholds for identifying exceptional biological events\n- Calibrate thresholds based on acceptable false positive/negative rates for specific applications\n- Validate approach across different study systems before operational deployment\n\n## 7. STUDY SIGNIFICANCE AND LIMITATIONS\n\n**Study Contribution**: This analysis demonstrates that acoustic indices show potential for community-level\nbiological activity detection in this marine environment, suggesting possible applications as screening tools.\n\n**Potential Impact**: If validated across different systems, this approach might enable more efficient\nacoustic monitoring by reducing manual analysis bottlenecks. However, broader application requires\nextensive testing across different marine environments, fish communities, and acoustic setups.\n\n**Study Scope**: Results based on {summary_results['community_metrics']['total_samples']:,} samples from\none study system across a full annual cycle with multiple stations. While this provides a solid foundation,\ngeneralizability to other marine environments requires further investigation.\n\n**Next Steps for Validation**:\n- Literature review of existing acoustic monitoring approaches\n- Cross-site validation with independent datasets\n- Comparison with other automated detection methods\n- Testing across different fish communities and acoustic environments\n\"\"\")\n\nprint(f\"\\nAnalysis complete! All results saved to {DATA_ROOT}/processed/\")", "code_hash": "5ba2a4673993a01c55aa28f17452b2a9", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "aLJB", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Conclusions and Recommendations\n\n### What We Learned\n\n**Community-Level Detection Shows Promise**: In this study system, acoustic indices showed better success at detecting aggregate biological activity rather than species-specific patterns. This suggests their potential value may lie in **biological screening** rather than detailed species identification, though this requires validation across different environments.\n\n**Temporal Patterns Show Some Concordance**: Some indices capture diel and seasonal patterns that correlate with fish community activity, though not with the precision of manual detections. The correlation strengths vary by index and temporal scale, and the generalizability of these patterns is unknown.\n\n**Screening Tool Potential**: The most promising application appears to be using indices as **screening tools** that flag periods likely to contain biological activity for targeted manual analysis. This could potentially reduce manual effort while maintaining detection rates, but operational effectiveness requires validation in real-world deployment scenarios.\n\n### Potential Applications (Requiring Validation)\n\n1. **Smart Sampling Protocols**: Indices might help identify optimal times for detailed manual analysis\n2. **Background Monitoring**: Could enable more continuous monitoring with periodic manual validation\n3. **Effort Optimization**: May help focus limited manual resources on periods flagged by models\n4. **Pattern Detection**: Could help detect unusual biological activity patterns warranting investigation\n\n### Next Steps for Notebook 7\n\nThe validation analysis should focus on:\n\n- **Temporal transferability**: Do these patterns hold across different time periods?\n- **Cross-site validation**: How well do models trained at one site perform at others?\n- **Continuous monitoring simulation**: What would real-world deployment look like?\n- **Cost-benefit quantification**: Actual effort savings vs information loss\n\n### The Bottom Line\n\nIn this study system, acoustic indices show **promising potential** as biological screening tools. While they cannot replace manual detection, they may be able to **help guide when and where to apply manual effort**. However, this potential must be validated across different marine environments, fish communities, and operational contexts before concluding that they can improve the efficiency of acoustic monitoring programs more broadly.\n\n**Critical next steps**: Cross-system validation, comparison with existing methods, and operational testing are essential before broader implementation.\n\"\"\"\n)", "code_hash": "5084f826887fb4e2c34a26c635f871bc", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "nHfw", "name": "_"}], "metadata": {"marimo_version": "0.16.0"}, "version": "1"},
            "session": {"cells": [{"code_hash": "bc3195b863ba12e0904187c120b3309e", "console": [], "id": "Hbol", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h1 id=\"notebook-6-community-pattern-detection-and-biological-screening\">Notebook 6: Community Pattern Detection and Biological Screening</h1>\n<span class=\"paragraph\"><strong>Purpose</strong>: Demonstrate that acoustic indices can detect community-level fish patterns and identify periods of biological interest</span>\n<span class=\"paragraph\"><strong>Key Outputs</strong>: Evidence that indices serve as effective biological screening tools for continuous monitoring</span>\n<hr />\n<span class=\"paragraph\"><strong>\ud83d\udcdd Research Timeline Note</strong>: This notebook was originally developed to analyze fish-only community patterns. During the research process (documented in Notebook 08), we discovered that dolphin data had been flowing through the pipeline all along, but with incompatible metrics. This notebook was subsequently updated to include comparative marine community analysis (fish + dolphins) alongside the original fish-only analysis. This represents the authentic, iterative nature of the research process - showing both the original approach and how new discoveries led to enhanced methods.</span>\n<span class=\"paragraph\"><strong>\ud83d\udd04 If you're following the research journey chronologically</strong>: This notebook can be run independently for fish-only analysis, but the marine community features require running Notebook 08 first to generate the dolphin intensity conversion and marine community metrics.</span>\n<hr />\n<h2 id=\"overview\">Overview</h2>\n<span class=\"paragraph\">Moving beyond species-specific prediction, this notebook tests whether acoustic indices can serve as <strong>biological screening tools</strong> by detecting aggregate community-level fish activity. Rather than trying to predict individual species calling intensities, we focus on:</span>\n<ol>\n<li><strong>Community-level activity detection</strong>: Can indices detect when \"something biological is happening\" vs periods of low activity?</li>\n<li><strong>Temporal pattern concordance</strong>: Do indices capture the same diel and seasonal patterns as manual detections?</li>\n<li><strong>Screening efficiency</strong>: How much manual effort could be saved by using indices to identify high-activity periods?</li>\n<li><strong>Cross-station transferability</strong>: Do index-based patterns hold across different monitoring locations?</li>\n</ol>\n<h2 id=\"methodological-approach\">Methodological Approach</h2>\n<h3 id=\"community-metrics-design\">Community Metrics Design</h3>\n<span class=\"paragraph\">We create several aggregate metrics that summarize biological activity across all fish species:</span>\n<ul>\n<li><strong>Total activity</strong>: Sum of calling intensities across all species (captures overall biological \"energy\")</li>\n<li><strong>Number of active species</strong>: Count of species calling in each period (community richness proxy)</li>\n<li><strong>Maximum activity</strong>: Peak calling intensity across species (dominant biological signal)</li>\n<li><strong>Activity diversity</strong>: Variation in calling patterns (community evenness proxy)</li>\n</ul>\n<h3 id=\"binary-classification-strategy\">Binary Classification Strategy</h3>\n<span class=\"paragraph\">Instead of predicting exact calling intensities (0-3 scale), we convert community activity into binary classification problems:</span>\n<ul>\n<li><strong>Any activity vs none</strong>: Basic biological presence/absence detection</li>\n<li><strong>High activity (75th/90th percentile)</strong>: Periods of exceptional biological interest</li>\n<li><strong>Multi-species active</strong>: Complex community interactions vs single-species events</li>\n</ul>\n<h3 id=\"machine-learning-models\">Machine Learning Models</h3>\n<span class=\"paragraph\">We test multiple classification algorithms to find the best approach:</span>\n<ul>\n<li><strong>Logistic Regression</strong>: Linear baseline, interpretable coefficients</li>\n<li><strong>Decision Tree</strong>: Non-linear, rule-based, highly interpretable</li>\n<li><strong>Random Forest</strong>: Ensemble method, handles feature interactions, robust to overfitting</li>\n<li>Attempted <strong>Gradient Boosting</strong> but it took too much time/compute for this analysis</li>\n</ul>\n<h3 id=\"evaluation-focus\">Evaluation Focus</h3>\n<span class=\"paragraph\">Rather than just accuracy, we emphasize <strong>screening performance</strong>:</span>\n<ul>\n<li><strong>Effort reduction</strong>: How much manual work can be saved?</li>\n<li><strong>Detection rate</strong>: What percentage of biological activity is captured?</li>\n<li><strong>Precision</strong>: When the model flags a period, how often is it actually active?</li>\n</ul>\n<h2 id=\"why-this-matters\">Why This Matters</h2>\n<span class=\"paragraph\">If acoustic indices can reliably detect periods of biological interest, they could serve as <strong>intelligent screening tools</strong> that guide targeted manual detection efforts. This would enable:</span>\n<ul>\n<li><strong>Continuous biological monitoring</strong> at scales impossible with manual detection alone</li>\n<li><strong>Efficient allocation of manual effort</strong> to periods most likely to contain biological activity</li>\n<li><strong>Early detection of biological events</strong> like spawning aggregations or community shifts</li>\n<li><strong>Cost-effective long-term monitoring</strong> with minimal ongoing human effort</li>\n</ul>\n<span class=\"paragraph\">The key question: <strong>\"Can acoustic indices tell us when to pay attention?\"</strong></span></span>"}, "type": "data"}]}, {"code_hash": "73ab35e411e190604aca8c02cb53f403", "console": [{"name": "stdout", "text": "Libraries loaded successfully\nData root: /Users/michelleweirathmueller/Documents/WORKSPACE/MBON-USC-2025/mbon-dash-2025/data\nPlot directory: /Users/michelleweirathmueller/Documents/WORKSPACE/MBON-USC-2025/mbon-dash-2025/dashboard/public/views/notebooks\n", "type": "stream"}], "id": "MJUe", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "5b25543cfbf2f21182c1cb4224f30123", "console": [], "id": "vblA", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"data-loading-and-preparation\">Data Loading and Preparation</h2>\n<span class=\"paragraph\">Loading all processed datasets and preparing them for community-level analysis.</span></span>"}, "type": "data"}]}, {"code_hash": "58b0e19cfcd1459da5ad47f61e4dea86", "console": [{"name": "stdout", "text": "Loading processed datasets...\n", "type": "stream"}, {"name": "stdout", "text": "\u2705 Loaded enhanced marine community data: (13140, 20)\nIndices shape: (13100, 21)\nDetections shape: (13140, 14)\nEnvironmental shape: (13140, 26)\nTemporal features shape: (13140, 14)\n", "type": "stream"}], "id": "bkHC", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "ad9f6a7acd370fb70c7b9945606c4ec2", "console": [{"name": "stdout", "text": "Master dataset shape: (13100, 37)\nFish species columns (7): ['Silver perch', 'Oyster toadfish boat whistle', 'Oyster toadfish grunt', 'Black drum', 'Spotted seatrout', 'Red drum', 'Atlantic croaker']\nAcoustic index columns (18): ['ACTspFract', 'EPS_KURT', 'ECU', 'NBPEAKS', 'TFSD']...\n", "type": "stream"}], "id": "lEQa", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "aa3cd67abbfcbebc3fefb38624e19e60", "console": [], "id": "PKri", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"community-activity-metrics-creation\">Community Activity Metrics Creation</h2>\n<span class=\"paragraph\">Creating aggregate community-level metrics that move beyond species-specific analysis.</span>\n<h2 id=\"strategy-from-species-specific-to-community-level-analysis\">Strategy: From Species-Specific to Community-Level Analysis</h2>\n<span class=\"paragraph\">Instead of trying to predict individual species calling patterns (which showed limited success in earlier analyses),\nwe aggregate across all species to ask: <strong>\"Is there biological activity happening?\"</strong> This approach:</span>\n<ol>\n<li><strong>Reduces complexity</strong>: 7 species \u00d7 4 intensity levels = 28 possible states \u2192 4 binary questions</li>\n<li><strong>Increases signal</strong>: Combines weak species-specific signals into stronger community signal</li>\n<li><strong>Matches practical needs</strong>: Often we care more about \"when to listen carefully\" than \"exactly which species\"</li>\n<li><strong>Improves statistical power</strong>: More balanced classes, clearer patterns</li>\n</ol></span>"}, "type": "data"}]}, {"code_hash": "b875fbfc013a5332f645afec30ce07db", "console": [{"name": "stdout", "text": "Creating community activity metrics...\nWorking with 7 fish species: ['Silver perch', 'Oyster toadfish boat whistle', 'Oyster toadfish grunt', 'Black drum', 'Spotted seatrout', 'Red drum', 'Atlantic croaker']\nTotal activity range: 0 to 9\nActive species range: 0 to 5\nMaximum activity range: 0 to 3\n", "type": "stream"}, {"name": "stdout", "text": "\n============================================================\nCREATING BINARY CLASSIFICATION TARGETS\n============================================================\nConverting continuous community metrics into binary screening questions:\nHigh activity (75th percentile, threshold=3.0): 25.5% of periods\nVery high activity (90th percentile, threshold=4.0): 16.2% of periods\nAny activity (threshold=0): 53.9% of periods\nMulti-species activity (\u22652 species): 17.3% of periods\nFish community metrics created. Sample statistics:\nTotal activity - Mean: 1.58, Max: 9\nActive species - Mean: 0.75, Max: 5\nHigh activity (75th): 25.5%\nHigh activity (90th): 16.2%\nAny activity: 53.9%\nMulti-species active: 17.3%\n\n======================================================================\nCREATING MARINE COMMUNITY METRICS (FISH + DOLPHINS)\n======================================================================\nCreating marine community dataset with 7 fish species + dolphins\n", "type": "stream"}, {"name": "stderr", "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/Users/michelleweirathmueller/Documents/WORKSPACE/MBON-USC-2025/mbon-dash-2025/python/.venv/lib/python3.12/site-packages/marimo/_runtime/executor.py&quot;</span>, line <span class=\"m\">138</span>, in <span class=\"n\">execute_cell</span>\n<span class=\"w\">    </span><span class=\"n\">exec</span><span class=\"p\">(</span><span class=\"n\">cell</span><span class=\"o\">.</span><span class=\"n\">body</span><span class=\"p\">,</span> <span class=\"n\">glbls</span><span class=\"p\">)</span>\n  File <span class=\"nb\">&quot;/var/folders/7g/l4jzm4ln40v_5j9zwsmkfrhc0000gn/T/marimo_13214/__marimo__cell_Xref_.py&quot;</span>, line <span class=\"m\">97</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">df_marine_community</span><span class=\"p\">[[</span><span class=\"s1\">&#39;datetime&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;station&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;year&#39;</span><span class=\"p\">]</span> <span class=\"o\">+</span> <span class=\"n\">marine_fish_species</span> <span class=\"o\">+</span>\n  File <span class=\"nb\">&quot;/Users/michelleweirathmueller/Documents/WORKSPACE/MBON-USC-2025/mbon-dash-2025/python/.venv/lib/python3.12/site-packages/pandas/core/frame.py&quot;</span>, line <span class=\"m\">4113</span>, in <span class=\"n\">__getitem__</span>\n<span class=\"w\">    </span><span class=\"n\">indexer</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">columns</span><span class=\"o\">.</span><span class=\"n\">_get_indexer_strict</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"s2\">&quot;columns&quot;</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n<span class=\"w\">              </span><span class=\"pm\">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>\n  File <span class=\"nb\">&quot;/Users/michelleweirathmueller/Documents/WORKSPACE/MBON-USC-2025/mbon-dash-2025/python/.venv/lib/python3.12/site-packages/pandas/core/indexes/base.py&quot;</span>, line <span class=\"m\">6212</span>, in <span class=\"n\">_get_indexer_strict</span>\n<span class=\"w\">    </span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_raise_if_missing</span><span class=\"p\">(</span><span class=\"n\">keyarr</span><span class=\"p\">,</span> <span class=\"n\">indexer</span><span class=\"p\">,</span> <span class=\"n\">axis_name</span><span class=\"p\">)</span>\n  File <span class=\"nb\">&quot;/Users/michelleweirathmueller/Documents/WORKSPACE/MBON-USC-2025/mbon-dash-2025/python/.venv/lib/python3.12/site-packages/pandas/core/indexes/base.py&quot;</span>, line <span class=\"m\">6264</span>, in <span class=\"n\">_raise_if_missing</span>\n<span class=\"w\">    </span><span class=\"k\">raise</span> <span class=\"ne\">KeyError</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">not_found</span><span class=\"si\">}</span><span class=\"s2\"> not in index&quot;</span><span class=\"p\">)</span>\n<span class=\"gr\">KeyError</span>: <span class=\"n\">&quot;[&#39;year&#39;] not in index&quot;</span>\n</pre></div>\n</span>", "type": "stream"}], "id": "Xref", "outputs": [{"ename": "exception", "evalue": "\"['year'] not in index\"", "traceback": [], "type": "error"}]}, {"code_hash": "a72ffa063b448a1f5b29690215424b68", "console": [], "id": "SFPL", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"model-development-for-community-activity-detection\">Model Development for Community Activity Detection</h2>\n<span class=\"paragraph\">Training multiple classifiers to predict community-level biological activity using acoustic indices.</span>\n<h2 id=\"machine-learning-algorithms-explained\">Machine Learning Algorithms Explained</h2>\n<span class=\"paragraph\">We test four different classification algorithms, each with distinct strengths for biological screening:</span>\n<h3 id=\"1-logistic-regression\">1. Logistic Regression</h3>\n<ul>\n<li><strong>How it works</strong>: Linear combination of features \u2192 probability via sigmoid function</li>\n<li><strong>Strengths</strong>: Fast, interpretable coefficients, stable predictions</li>\n<li><strong>Best for</strong>: Understanding which indices have linear relationships with biology</li>\n<li><strong>Interpretation</strong>: Coefficient sign/magnitude shows feature importance and direction</li>\n</ul>\n<h3 id=\"2-decision-tree\">2. Decision Tree</h3>\n<ul>\n<li><strong>How it works</strong>: Sequential yes/no questions creating rule-based decisions</li>\n<li><strong>Strengths</strong>: Highly interpretable, handles non-linear patterns, no assumptions about data distribution</li>\n<li><strong>Best for</strong>: Creating simple screening rules (e.g., \"if index X &gt; threshold AND temperature &gt; Y, then high activity\")</li>\n<li><strong>Interpretation</strong>: Tree branches show exact decision logic</li>\n</ul>\n<h3 id=\"3-random-forest\">3. Random Forest</h3>\n<ul>\n<li><strong>How it works</strong>: Combines predictions from 100 different decision trees</li>\n<li><strong>Strengths</strong>: Handles complex interactions, resistant to overfitting, robust to outliers</li>\n<li><strong>Best for</strong>: Maximizing predictive performance while maintaining some interpretability</li>\n<li><strong>Interpretation</strong>: Feature importance ranks show which indices contribute most to predictions</li>\n</ul>\n<h3 id=\"4-gradient-boosting-not-implemented-due-to-computational-constraints\">4. Gradient Boosting  ** not implemented due to computational constraints</h3>\n<ul>\n<li><strong>How it works</strong>: Sequentially builds models, each correcting previous model's mistakes</li>\n<li><strong>Strengths</strong>: Often highest accuracy, excellent at detecting subtle patterns</li>\n<li><strong>Best for</strong>: Maximum screening performance when interpretability is less critical</li>\n<li><strong>Interpretation</strong>: Feature importance shows cumulative contribution across all boosting iterations</li>\n</ul>\n<h2 id=\"evaluation-strategy\">Evaluation Strategy</h2>\n<span class=\"paragraph\">For biological screening, we care more about <strong>practical performance</strong> than traditional accuracy:</span>\n<ul>\n<li><strong>F1 Score</strong>: Balances precision (few false alarms) with recall (catch most activity)</li>\n<li><strong>Cross-validation</strong>: 5-fold stratified to ensure robust performance estimates</li>\n<li><strong>Class balance</strong>: Account for unequal representation of active vs inactive periods</li>\n</ul></span>"}, "type": "data"}]}, {"code_hash": "bf9fb162b4b06123ade04dc86e0ca05d", "console": [], "id": "BYtC", "outputs": [{"ename": "multiple-defs", "evalue": "The variable 'target_name' was defined by another cell", "traceback": [], "type": "error"}]}, {"code_hash": "1eff32d134ea64fd2f0e7c4925bf88c4", "console": [], "id": "RGSE", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"feature-importance-analysis\">Feature Importance Analysis</h2>\n<span class=\"paragraph\">Understanding which acoustic indices and environmental variables are most important for detecting community activity.</span></span>"}, "type": "data"}]}, {"code_hash": "b832674560a85b236328a20ec2401380", "console": [], "id": "Kclp", "outputs": [{"ename": "multiple-defs", "evalue": "The variable 'target_name' was defined by another cell", "traceback": [], "type": "error"}]}, {"code_hash": "95b0c0b2450af48082e4453ebdb52897", "console": [], "id": "emfo", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"comparative-model-performance-analysis\">Comparative Model Performance Analysis</h2>\n<span class=\"paragraph\">Comparing fish-only vs. marine community model performance to understand the value of including dolphins in biological screening.</span></span>"}, "type": "data"}]}, {"code_hash": "bfab1cb33e1b46056f3cede5166a7448", "console": [], "id": "Hstk", "outputs": [{"ename": "multiple-defs", "evalue": "The variable 'fish_mean_f1' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'improvement' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'marine_mean_f1' was defined by another cell", "traceback": [], "type": "error"}]}, {"code_hash": "6cd7c3c5c04baf4a67bebb2fe7f0f2d6", "console": [], "id": "nWHF", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"temporal-pattern-concordance-analysis\">Temporal Pattern Concordance Analysis</h2>\n<span class=\"paragraph\">Comparing how well acoustic indices capture the same temporal patterns (diel and seasonal) as manual detections for both fish-only and marine communities.</span></span>"}, "type": "data"}]}, {"code_hash": "0673a5d2014cc877042809ca5702aa86", "console": [], "id": "iLit", "outputs": [{"ename": "multiple-defs", "evalue": "The variable 'diel_corr' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'diel_p' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'idx' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'seasonal_corr' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'seasonal_p' was defined by another cell", "traceback": [], "type": "error"}]}, {"code_hash": "98144cdcb541e8105d1c6825d91aeccb", "console": [], "id": "ZHCJ", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"final-analysis-summary-and-recommendations\">Final Analysis Summary and Recommendations</h2>\n<span class=\"paragraph\">Synthesizing findings from the comparative fish-only vs. marine community analysis to provide actionable insights for biological screening and monitoring.</span></span>"}, "type": "data"}]}, {"code_hash": "154df622f6ae9c8b713a8cd90822e4e0", "console": [], "id": "ROlb", "outputs": [{"ename": "multiple-defs", "evalue": "The variable 'fish_mean_f1' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'i' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'improvement' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'marine_mean_f1' was defined by another cell", "traceback": [], "type": "error"}]}, {"code_hash": "3ad596a8635fc485239348c3d55094ff", "console": [], "id": "qnkX", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"temporal-pattern-concordance-analysis\">Temporal Pattern Concordance Analysis</h2>\n<span class=\"paragraph\">Comparing how well acoustic indices capture the same temporal patterns (diel and seasonal) as manual detections.</span></span>"}, "type": "data"}]}, {"code_hash": "c2a06d3916d11ade8b5f65d191d00ff8", "console": [], "id": "TqIu", "outputs": [{"ename": "multiple-defs", "evalue": "The variable 'diel_corr' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'diel_p' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'idx' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'seasonal_corr' was defined by another cell", "traceback": [], "type": "error"}, {"ename": "multiple-defs", "evalue": "The variable 'seasonal_p' was defined by another cell", "traceback": [], "type": "error"}]}, {"code_hash": "65c8194f79b1157faa95a4ba2444f97e", "console": [], "id": "Vxnm", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"biological-screening-performance-evaluation\">Biological Screening Performance Evaluation</h2>\n<span class=\"paragraph\">Evaluating how effectively acoustic indices can screen for periods of biological interest.</span>\n<h2 id=\"screening-performance-metrics-explained\">Screening Performance Metrics Explained</h2>\n<span class=\"paragraph\">Traditional machine learning focuses on accuracy, but biological screening requires different metrics:</span>\n<h3 id=\"key-metrics-for-biological-applications\">Key Metrics for Biological Applications</h3>\n<span class=\"paragraph\"><strong>1. Detection Rate (Recall)</strong></span>\n<ul>\n<li><strong>Definition</strong>: Percentage of actual biological activity periods that the model correctly identifies</li>\n<li><strong>Why it matters</strong>: Missing biological activity = lost scientific data</li>\n<li><strong>Target</strong>: &gt;80% for practical screening applications</li>\n</ul>\n<span class=\"paragraph\"><strong>2. Screening Precision</strong></span>\n<ul>\n<li><strong>Definition</strong>: When the model flags a period as \"high activity,\" how often is it actually active?</li>\n<li><strong>Why it matters</strong>: False alarms waste manual effort</li>\n<li><strong>Target</strong>: &gt;70% to maintain efficiency gains</li>\n</ul>\n<span class=\"paragraph\"><strong>3. Effort Reduction</strong></span>\n<ul>\n<li><strong>Definition</strong>: Percentage of data that can be skipped without manual analysis</li>\n<li><strong>Why it matters</strong>: This is the primary value proposition - saving time and money</li>\n<li><strong>Target</strong>: &gt;50% reduction to justify deployment costs</li>\n</ul>\n<span class=\"paragraph\"><strong>4. F1 Score</strong></span>\n<ul>\n<li><strong>Definition</strong>: Harmonic mean of precision and recall (balances both)</li>\n<li><strong>Why it matters</strong>: Single metric for comparing models</li>\n<li><strong>Target</strong>: &gt;0.7 for good performance, &gt;0.8 for excellent</li>\n</ul>\n<h2 id=\"real-world-translation\">Real-World Translation</h2>\n<span class=\"paragraph\">A screening system with 80% detection rate, 75% precision, and 60% effort reduction means:</span>\n<ul>\n<li>Analyze only 40% of your data manually</li>\n<li>Catch 80% of all biological activity</li>\n<li>When you do analyze a flagged period, it's biologically interesting 75% of the time</li>\n<li>Save ~60% of analysis time while maintaining most scientific value</li>\n</ul></span>"}, "type": "data"}]}, {"code_hash": "f8464dc623cf63af7dc10337888f3691", "console": [{"name": "stdout", "text": "Evaluating biological screening performance...\n", "type": "stream"}, {"name": "stderr", "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/Users/michelleweirathmueller/Documents/WORKSPACE/MBON-USC-2025/mbon-dash-2025/python/.venv/lib/python3.12/site-packages/marimo/_runtime/executor.py&quot;</span>, line <span class=\"m\">138</span>, in <span class=\"n\">execute_cell</span>\n<span class=\"w\">    </span><span class=\"n\">exec</span><span class=\"p\">(</span><span class=\"n\">cell</span><span class=\"o\">.</span><span class=\"n\">body</span><span class=\"p\">,</span> <span class=\"n\">glbls</span><span class=\"p\">)</span>\n  File <span class=\"nb\">&quot;/var/folders/7g/l4jzm4ln40v_5j9zwsmkfrhc0000gn/T/marimo_13214/__marimo__cell_DnEU_.py&quot;</span>, line <span class=\"m\">6</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">for</span> <span class=\"n\">target_name_screen</span><span class=\"p\">,</span> <span class=\"n\">target_models</span> <span class=\"ow\">in</span> <span class=\"n\">model_results</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n<span class=\"w\">                                             </span><span class=\"pm\">^^^^^^^^^^^^^</span>\n<span class=\"gr\">NameError</span>: <span class=\"n\">name &#39;model_results&#39; is not defined</span>\n</pre></div>\n</span>", "type": "stream"}], "id": "DnEU", "outputs": [{"ename": "exception", "evalue": "name 'model_results' is not defined", "traceback": [], "type": "error"}]}, {"code_hash": "6c6b523213fb7409bbb0ffc5b364ca57", "console": [], "id": "ulZA", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"visualization-community-patterns-and-screening-performance\">Visualization: Community Patterns and Screening Performance</h2>\n<span class=\"paragraph\">Creating comprehensive visualizations to show community pattern detection and screening tool performance.</span></span>"}, "type": "data"}]}, {"code_hash": "21060abcc1b414a4ede090810aba09d5", "console": [], "id": "ecfG", "outputs": [{"ename": "multiple-defs", "evalue": "The variable 'i' was defined by another cell", "traceback": [], "type": "error"}]}, {"code_hash": "90db1ebf0d4461c803810e85435fcb44", "console": [], "id": "Pvdt", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"results-summary-and-interpretation\">Results Summary and Interpretation</h2>\n<span class=\"paragraph\">Synthesizing findings on community pattern detection and biological screening effectiveness.</span></span>"}, "type": "data"}]}, {"code_hash": "c8da4effb01e3aca787b441406226c84", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "5ba2a4673993a01c55aa28f17452b2a9", "console": [], "id": "aLJB", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (NameError): ", "traceback": [], "type": "error"}]}, {"code_hash": "5084f826887fb4e2c34a26c635f871bc", "console": [], "id": "nHfw", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"conclusions-and-recommendations\">Conclusions and Recommendations</h2>\n<h3 id=\"what-we-learned\">What We Learned</h3>\n<span class=\"paragraph\"><strong>Community-Level Detection Shows Promise</strong>: In this study system, acoustic indices showed better success at detecting aggregate biological activity rather than species-specific patterns. This suggests their potential value may lie in <strong>biological screening</strong> rather than detailed species identification, though this requires validation across different environments.</span>\n<span class=\"paragraph\"><strong>Temporal Patterns Show Some Concordance</strong>: Some indices capture diel and seasonal patterns that correlate with fish community activity, though not with the precision of manual detections. The correlation strengths vary by index and temporal scale, and the generalizability of these patterns is unknown.</span>\n<span class=\"paragraph\"><strong>Screening Tool Potential</strong>: The most promising application appears to be using indices as <strong>screening tools</strong> that flag periods likely to contain biological activity for targeted manual analysis. This could potentially reduce manual effort while maintaining detection rates, but operational effectiveness requires validation in real-world deployment scenarios.</span>\n<h3 id=\"potential-applications-requiring-validation\">Potential Applications (Requiring Validation)</h3>\n<ol>\n<li><strong>Smart Sampling Protocols</strong>: Indices might help identify optimal times for detailed manual analysis</li>\n<li><strong>Background Monitoring</strong>: Could enable more continuous monitoring with periodic manual validation</li>\n<li><strong>Effort Optimization</strong>: May help focus limited manual resources on periods flagged by models</li>\n<li><strong>Pattern Detection</strong>: Could help detect unusual biological activity patterns warranting investigation</li>\n</ol>\n<h3 id=\"next-steps-for-notebook-7\">Next Steps for Notebook 7</h3>\n<span class=\"paragraph\">The validation analysis should focus on:</span>\n<ul>\n<li><strong>Temporal transferability</strong>: Do these patterns hold across different time periods?</li>\n<li><strong>Cross-site validation</strong>: How well do models trained at one site perform at others?</li>\n<li><strong>Continuous monitoring simulation</strong>: What would real-world deployment look like?</li>\n<li><strong>Cost-benefit quantification</strong>: Actual effort savings vs information loss</li>\n</ul>\n<h3 id=\"the-bottom-line\">The Bottom Line</h3>\n<span class=\"paragraph\">In this study system, acoustic indices show <strong>promising potential</strong> as biological screening tools. While they cannot replace manual detection, they may be able to <strong>help guide when and where to apply manual effort</strong>. However, this potential must be validated across different marine environments, fish communities, and operational contexts before concluding that they can improve the efficiency of acoustic monitoring programs more broadly.</span>\n<span class=\"paragraph\"><strong>Critical next steps</strong>: Cross-system validation, comparison with existing methods, and operational testing are essential before broader implementation.</span></span>"}, "type": "data"}]}], "metadata": {"marimo_version": "0.16.0"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.16.0%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%20Notebook%206%3A%20Community%20Pattern%20Detection%20and%20Biological%20Screening%0A%0A%20%20%20%20%20%20%20%20**Purpose**%3A%20Demonstrate%20that%20acoustic%20indices%20can%20detect%20community-level%20fish%20patterns%20and%20identify%20periods%20of%20biological%20interest%0A%0A%20%20%20%20%20%20%20%20**Key%20Outputs**%3A%20Evidence%20that%20indices%20serve%20as%20effective%20biological%20screening%20tools%20for%20continuous%20monitoring%0A%0A%20%20%20%20%20%20%20%20---%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%93%9D%20Research%20Timeline%20Note**%3A%20This%20notebook%20was%20originally%20developed%20to%20analyze%20fish-only%20community%20patterns.%20During%20the%20research%20process%20(documented%20in%20Notebook%2008)%2C%20we%20discovered%20that%20dolphin%20data%20had%20been%20flowing%20through%20the%20pipeline%20all%20along%2C%20but%20with%20incompatible%20metrics.%20This%20notebook%20was%20subsequently%20updated%20to%20include%20comparative%20marine%20community%20analysis%20(fish%20%2B%20dolphins)%20alongside%20the%20original%20fish-only%20analysis.%20This%20represents%20the%20authentic%2C%20iterative%20nature%20of%20the%20research%20process%20-%20showing%20both%20the%20original%20approach%20and%20how%20new%20discoveries%20led%20to%20enhanced%20methods.%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%94%84%20If%20you're%20following%20the%20research%20journey%20chronologically**%3A%20This%20notebook%20can%20be%20run%20independently%20for%20fish-only%20analysis%2C%20but%20the%20marine%20community%20features%20require%20running%20Notebook%2008%20first%20to%20generate%20the%20dolphin%20intensity%20conversion%20and%20marine%20community%20metrics.%0A%0A%20%20%20%20%20%20%20%20---%0A%0A%20%20%20%20%20%20%20%20%23%23%20Overview%0A%0A%20%20%20%20%20%20%20%20Moving%20beyond%20species-specific%20prediction%2C%20this%20notebook%20tests%20whether%20acoustic%20indices%20can%20serve%20as%20**biological%20screening%20tools**%20by%20detecting%20aggregate%20community-level%20fish%20activity.%20Rather%20than%20trying%20to%20predict%20individual%20species%20calling%20intensities%2C%20we%20focus%20on%3A%0A%0A%20%20%20%20%20%20%20%201.%20**Community-level%20activity%20detection**%3A%20Can%20indices%20detect%20when%20%22something%20biological%20is%20happening%22%20vs%20periods%20of%20low%20activity%3F%0A%20%20%20%20%20%20%20%202.%20**Temporal%20pattern%20concordance**%3A%20Do%20indices%20capture%20the%20same%20diel%20and%20seasonal%20patterns%20as%20manual%20detections%3F%0A%20%20%20%20%20%20%20%203.%20**Screening%20efficiency**%3A%20How%20much%20manual%20effort%20could%20be%20saved%20by%20using%20indices%20to%20identify%20high-activity%20periods%3F%0A%20%20%20%20%20%20%20%204.%20**Cross-station%20transferability**%3A%20Do%20index-based%20patterns%20hold%20across%20different%20monitoring%20locations%3F%0A%0A%20%20%20%20%20%20%20%20%23%23%20Methodological%20Approach%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Community%20Metrics%20Design%0A%20%20%20%20%20%20%20%20We%20create%20several%20aggregate%20metrics%20that%20summarize%20biological%20activity%20across%20all%20fish%20species%3A%0A%0A%20%20%20%20%20%20%20%20-%20**Total%20activity**%3A%20Sum%20of%20calling%20intensities%20across%20all%20species%20(captures%20overall%20biological%20%22energy%22)%0A%20%20%20%20%20%20%20%20-%20**Number%20of%20active%20species**%3A%20Count%20of%20species%20calling%20in%20each%20period%20(community%20richness%20proxy)%0A%20%20%20%20%20%20%20%20-%20**Maximum%20activity**%3A%20Peak%20calling%20intensity%20across%20species%20(dominant%20biological%20signal)%0A%20%20%20%20%20%20%20%20-%20**Activity%20diversity**%3A%20Variation%20in%20calling%20patterns%20(community%20evenness%20proxy)%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Binary%20Classification%20Strategy%0A%20%20%20%20%20%20%20%20Instead%20of%20predicting%20exact%20calling%20intensities%20(0-3%20scale)%2C%20we%20convert%20community%20activity%20into%20binary%20classification%20problems%3A%0A%0A%20%20%20%20%20%20%20%20-%20**Any%20activity%20vs%20none**%3A%20Basic%20biological%20presence%2Fabsence%20detection%0A%20%20%20%20%20%20%20%20-%20**High%20activity%20(75th%2F90th%20percentile)**%3A%20Periods%20of%20exceptional%20biological%20interest%0A%20%20%20%20%20%20%20%20-%20**Multi-species%20active**%3A%20Complex%20community%20interactions%20vs%20single-species%20events%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Machine%20Learning%20Models%0A%20%20%20%20%20%20%20%20We%20test%20multiple%20classification%20algorithms%20to%20find%20the%20best%20approach%3A%0A%0A%20%20%20%20%20%20%20%20-%20**Logistic%20Regression**%3A%20Linear%20baseline%2C%20interpretable%20coefficients%0A%20%20%20%20%20%20%20%20-%20**Decision%20Tree**%3A%20Non-linear%2C%20rule-based%2C%20highly%20interpretable%0A%20%20%20%20%20%20%20%20-%20**Random%20Forest**%3A%20Ensemble%20method%2C%20handles%20feature%20interactions%2C%20robust%20to%20overfitting%0A%20%20%20%20%20%20%20%20-%20Attempted%20**Gradient%20Boosting**%20but%20it%20took%20too%20much%20time%2Fcompute%20for%20this%20analysis%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Evaluation%20Focus%0A%20%20%20%20%20%20%20%20Rather%20than%20just%20accuracy%2C%20we%20emphasize%20**screening%20performance**%3A%0A%0A%20%20%20%20%20%20%20%20-%20**Effort%20reduction**%3A%20How%20much%20manual%20work%20can%20be%20saved%3F%0A%20%20%20%20%20%20%20%20-%20**Detection%20rate**%3A%20What%20percentage%20of%20biological%20activity%20is%20captured%3F%0A%20%20%20%20%20%20%20%20-%20**Precision**%3A%20When%20the%20model%20flags%20a%20period%2C%20how%20often%20is%20it%20actually%20active%3F%0A%0A%20%20%20%20%20%20%20%20%23%23%20Why%20This%20Matters%0A%0A%20%20%20%20%20%20%20%20If%20acoustic%20indices%20can%20reliably%20detect%20periods%20of%20biological%20interest%2C%20they%20could%20serve%20as%20**intelligent%20screening%20tools**%20that%20guide%20targeted%20manual%20detection%20efforts.%20This%20would%20enable%3A%0A%0A%20%20%20%20%20%20%20%20-%20**Continuous%20biological%20monitoring**%20at%20scales%20impossible%20with%20manual%20detection%20alone%0A%20%20%20%20%20%20%20%20-%20**Efficient%20allocation%20of%20manual%20effort**%20to%20periods%20most%20likely%20to%20contain%20biological%20activity%0A%20%20%20%20%20%20%20%20-%20**Early%20detection%20of%20biological%20events**%20like%20spawning%20aggregations%20or%20community%20shifts%0A%20%20%20%20%20%20%20%20-%20**Cost-effective%20long-term%20monitoring**%20with%20minimal%20ongoing%20human%20effort%0A%0A%20%20%20%20%20%20%20%20The%20key%20question%3A%20**%22Can%20acoustic%20indices%20tell%20us%20when%20to%20pay%20attention%3F%22**%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%20%20%20%20import%20seaborn%20as%20sns%0A%20%20%20%20from%20pathlib%20import%20Path%0A%20%20%20%20import%20warnings%0A%20%20%20%20import%20json%0A%20%20%20%20import%20pickle%0A%20%20%20%20warnings.filterwarnings('ignore')%0A%0A%20%20%20%20%23%20Machine%20learning%0A%20%20%20%20from%20sklearn.model_selection%20import%20train_test_split%2C%20cross_val_score%2C%20StratifiedKFold%2C%20TimeSeriesSplit%0A%20%20%20%20from%20sklearn.linear_model%20import%20LogisticRegression%0A%20%20%20%20from%20sklearn.tree%20import%20DecisionTreeClassifier%0A%20%20%20%20from%20sklearn.ensemble%20import%20RandomForestClassifier%2C%20GradientBoostingClassifier%0A%20%20%20%20from%20sklearn.preprocessing%20import%20StandardScaler%2C%20RobustScaler%0A%20%20%20%20from%20sklearn.metrics%20import%20(%0A%20%20%20%20%20%20%20%20classification_report%2C%20confusion_matrix%2C%20roc_curve%2C%20auc%2C%0A%20%20%20%20%20%20%20%20precision_recall_curve%2C%20accuracy_score%2C%20cohen_kappa_score%2C%0A%20%20%20%20%20%20%20%20f1_score%2C%20precision_score%2C%20recall_score%0A%20%20%20%20)%0A%20%20%20%20from%20sklearn.feature_selection%20import%20mutual_info_classif%2C%20SelectKBest%0A%0A%20%20%20%20%23%20Statistical%20analysis%0A%20%20%20%20from%20scipy%20import%20stats%0A%20%20%20%20from%20scipy.stats%20import%20spearmanr%2C%20pearsonr%0A%0A%20%20%20%20%23%20Set%20plotting%20style%0A%20%20%20%20plt.style.use('default')%0A%20%20%20%20sns.set_palette(%22husl%22)%0A%0A%20%20%20%20%23%20Find%20project%20root%20by%20looking%20for%20the%20data%20folder%0A%20%20%20%20current_dir%20%3D%20Path(__file__).parent%20if%20%22__file__%22%20in%20locals()%20else%20Path.cwd()%0A%20%20%20%20project_root%20%3D%20current_dir%0A%20%20%20%20while%20not%20(project_root%20%2F%20%22data%22).exists()%20and%20project_root%20!%3D%20project_root.parent%3A%0A%20%20%20%20%20%20%20%20project_root%20%3D%20project_root.parent%0A%0A%20%20%20%20%23%20Data%20directories%0A%20%20%20%20DATA_ROOT%20%3D%20project_root%20%2F%20%22data%22%0A%20%20%20%20data_dir%20%3D%20DATA_ROOT%20%2F%20%22processed%22%0A%20%20%20%20plot_dir%20%3D%20DATA_ROOT.parent%20%2F%20%22dashboard%2Fpublic%2Fviews%2Fnotebooks%22%0A%20%20%20%20plot_dir.mkdir(exist_ok%3DTrue%2C%20parents%3DTrue)%0A%0A%20%20%20%20print(%22Libraries%20loaded%20successfully%22)%0A%20%20%20%20print(f%22Data%20root%3A%20%7BDATA_ROOT%7D%22)%0A%20%20%20%20print(f%22Plot%20directory%3A%20%7Bplot_dir%7D%22)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20DATA_ROOT%2C%0A%20%20%20%20%20%20%20%20DecisionTreeClassifier%2C%0A%20%20%20%20%20%20%20%20LogisticRegression%2C%0A%20%20%20%20%20%20%20%20RandomForestClassifier%2C%0A%20%20%20%20%20%20%20%20StandardScaler%2C%0A%20%20%20%20%20%20%20%20StratifiedKFold%2C%0A%20%20%20%20%20%20%20%20accuracy_score%2C%0A%20%20%20%20%20%20%20%20cohen_kappa_score%2C%0A%20%20%20%20%20%20%20%20cross_val_score%2C%0A%20%20%20%20%20%20%20%20f1_score%2C%0A%20%20%20%20%20%20%20%20json%2C%0A%20%20%20%20%20%20%20%20mutual_info_classif%2C%0A%20%20%20%20%20%20%20%20np%2C%0A%20%20%20%20%20%20%20%20pd%2C%0A%20%20%20%20%20%20%20%20pickle%2C%0A%20%20%20%20%20%20%20%20plot_dir%2C%0A%20%20%20%20%20%20%20%20plt%2C%0A%20%20%20%20%20%20%20%20precision_score%2C%0A%20%20%20%20%20%20%20%20recall_score%2C%0A%20%20%20%20%20%20%20%20spearmanr%2C%0A%20%20%20%20%20%20%20%20train_test_split%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Data%20Loading%20and%20Preparation%0A%0A%20%20%20%20Loading%20all%20processed%20datasets%20and%20preparing%20them%20for%20community-level%20analysis.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(DATA_ROOT%2C%20pd)%3A%0A%20%20%20%20%23%20Load%20all%20processed%20datasets%0A%20%20%20%20print(%22Loading%20processed%20datasets...%22)%0A%0A%20%20%20%20%23%20Load%20reduced%20acoustic%20indices%20from%20Notebook%203%0A%20%20%20%20df_indices%20%3D%20pd.read_parquet(DATA_ROOT%20%2F%20%22processed%2F03_reduced_acoustic_indices.parquet%22)%0A%0A%20%20%20%20%23%20Load%20aligned%20detections%20(original%20fish-only%20data)%0A%20%20%20%20df_detections%20%3D%20pd.read_parquet(DATA_ROOT%20%2F%20%22processed%2F02_detections_aligned_2021.parquet%22)%0A%0A%20%20%20%20%23%20Load%20enhanced%20marine%20community%20data%20(fish%20%2B%20dolphins%20from%20notebook%2008)%0A%20%20%20%20marine_community_file%20%3D%20DATA_ROOT%20%2F%20%22processed%2F02_detections_with_marine_community.parquet%22%0A%20%20%20%20if%20marine_community_file.exists()%3A%0A%20%20%20%20%20%20%20%20df_marine_community%20%3D%20pd.read_parquet(marine_community_file)%0A%20%20%20%20%20%20%20%20print(f%22%E2%9C%85%20Loaded%20enhanced%20marine%20community%20data%3A%20%7Bdf_marine_community.shape%7D%22)%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print(f%22%E2%9A%A0%EF%B8%8F%20Marine%20community%20data%20not%20found%3A%20%7Bmarine_community_file%7D%22)%0A%20%20%20%20%20%20%20%20print(%22Run%20notebook%2008%20first%20to%20generate%20marine%20community%20metrics%22)%0A%20%20%20%20%20%20%20%20df_marine_community%20%3D%20None%0A%0A%20%20%20%20%23%20Load%20environmental%20data%0A%20%20%20%20df_env%20%3D%20pd.read_parquet(DATA_ROOT%20%2F%20%22processed%2F02_environmental_aligned_2021.parquet%22)%0A%0A%20%20%20%20%23%20Load%20temporal%20features%0A%20%20%20%20df_temporal%20%3D%20pd.read_parquet(DATA_ROOT%20%2F%20%22processed%2F02_temporal_features_2021.parquet%22)%0A%0A%20%20%20%20%23%20Load%20detection%20metadata%20to%20identify%20fish%20species%0A%20%20%20%20df_det_metadata%20%3D%20pd.read_parquet(DATA_ROOT%20%2F%20%22processed%2Fmetadata%2F01_detection_columns.parquet%22)%0A%0A%20%20%20%20print(f%22Indices%20shape%3A%20%7Bdf_indices.shape%7D%22)%0A%20%20%20%20print(f%22Detections%20shape%3A%20%7Bdf_detections.shape%7D%22)%0A%20%20%20%20print(f%22Environmental%20shape%3A%20%7Bdf_env.shape%7D%22)%20%0A%20%20%20%20print(f%22Temporal%20features%20shape%3A%20%7Bdf_temporal.shape%7D%22)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20df_det_metadata%2C%0A%20%20%20%20%20%20%20%20df_detections%2C%0A%20%20%20%20%20%20%20%20df_env%2C%0A%20%20%20%20%20%20%20%20df_indices%2C%0A%20%20%20%20%20%20%20%20df_marine_community%2C%0A%20%20%20%20%20%20%20%20df_temporal%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_(df_det_metadata%2C%20df_detections%2C%20df_env%2C%20df_indices%2C%20df_temporal)%3A%0A%20%20%20%20%23%20Get%20fish%20species%20columns%0A%20%20%20%20fish_species%20%3D%20df_det_metadata%5B%0A%20%20%20%20%20%20%20%20(df_det_metadata%5B'group'%5D%20%3D%3D%20'fish')%20%26%0A%20%20%20%20%20%20%20%20(df_det_metadata%5B'keep_species'%5D%20%3D%3D%201)%0A%20%20%20%20%5D%5B'long_name'%5D.tolist()%0A%0A%20%20%20%20%23%20Get%20acoustic%20index%20columns%20(exclude%20metadata)%0A%20%20%20%20index_cols%20%3D%20%5Bcol%20for%20col%20in%20df_indices.columns%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20col%20not%20in%20%5B'datetime'%2C%20'station'%2C%20'year'%5D%5D%0A%0A%20%20%20%20%23%20Merge%20all%20datasets%0A%20%20%20%20df_master%20%3D%20df_indices.merge(%0A%20%20%20%20%20%20%20%20df_detections%5B%5B'datetime'%2C%20'station'%2C%20'year'%5D%20%2B%20fish_species%5D%2C%0A%20%20%20%20%20%20%20%20on%3D%5B'datetime'%2C%20'station'%2C%20'year'%5D%2C%0A%20%20%20%20%20%20%20%20how%3D'left'%0A%20%20%20%20)%0A%0A%20%20%20%20df_master%20%3D%20df_master.merge(%0A%20%20%20%20%20%20%20%20df_env%5B%5B'datetime'%2C%20'station'%2C%20'year'%2C%20'Water%20temp%20(%C2%B0C)'%2C%20'Water%20depth%20(m)'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Broadband%20(1-40000%20Hz)'%2C%20'Low%20(50-1200%20Hz)'%2C%20'High%20(7000-40000%20Hz)'%5D%5D%2C%0A%20%20%20%20%20%20%20%20on%3D%5B'datetime'%2C%20'station'%2C%20'year'%5D%2C%0A%20%20%20%20%20%20%20%20how%3D'left'%0A%20%20%20%20)%0A%0A%20%20%20%20df_master%20%3D%20df_master.merge(%0A%20%20%20%20%20%20%20%20df_temporal%5B%5B'datetime'%2C%20'station'%2C%20'year'%2C%20'hour'%2C%20'month'%2C%20'season'%2C%20'time_period'%5D%5D%2C%0A%20%20%20%20%20%20%20%20on%3D%5B'datetime'%2C%20'station'%2C%20'year'%5D%2C%0A%20%20%20%20%20%20%20%20how%3D'left'%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Rename%20time_period%20to%20diel_period%20for%20consistency%0A%20%20%20%20df_master%20%3D%20df_master.rename(columns%3D%7B'time_period'%3A%20'diel_period'%7D)%0A%0A%20%20%20%20print(f%22Master%20dataset%20shape%3A%20%7Bdf_master.shape%7D%22)%0A%20%20%20%20print(f%22Fish%20species%20columns%20(%7Blen(fish_species)%7D)%3A%20%7Bfish_species%7D%22)%0A%20%20%20%20print(f%22Acoustic%20index%20columns%20(%7Blen(index_cols)%7D)%3A%20%7Bindex_cols%5B%3A5%5D%7D...%22)%0A%20%20%20%20return%20df_master%2C%20fish_species%2C%20index_cols%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Community%20Activity%20Metrics%20Creation%0A%0A%20%20%20%20Creating%20aggregate%20community-level%20metrics%20that%20move%20beyond%20species-specific%20analysis.%0A%0A%20%20%20%20%23%23%20Strategy%3A%20From%20Species-Specific%20to%20Community-Level%20Analysis%0A%0A%20%20%20%20Instead%20of%20trying%20to%20predict%20individual%20species%20calling%20patterns%20(which%20showed%20limited%20success%20in%20earlier%20analyses)%2C%0A%20%20%20%20we%20aggregate%20across%20all%20species%20to%20ask%3A%20**%22Is%20there%20biological%20activity%20happening%3F%22**%20This%20approach%3A%0A%0A%20%20%20%201.%20**Reduces%20complexity**%3A%207%20species%20%C3%97%204%20intensity%20levels%20%3D%2028%20possible%20states%20%E2%86%92%204%20binary%20questions%0A%20%20%20%202.%20**Increases%20signal**%3A%20Combines%20weak%20species-specific%20signals%20into%20stronger%20community%20signal%0A%20%20%20%203.%20**Matches%20practical%20needs**%3A%20Often%20we%20care%20more%20about%20%22when%20to%20listen%20carefully%22%20than%20%22exactly%20which%20species%22%0A%20%20%20%204.%20**Improves%20statistical%20power**%3A%20More%20balanced%20classes%2C%20clearer%20patterns%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20df_env%2C%0A%20%20%20%20df_indices%2C%0A%20%20%20%20df_marine_community%2C%0A%20%20%20%20df_master%2C%0A%20%20%20%20df_temporal%2C%0A%20%20%20%20fish_species%2C%0A)%3A%0A%20%20%20%20%23%20Create%20community-level%20activity%20metrics%0A%20%20%20%20print(%22Creating%20community%20activity%20metrics...%22)%0A%20%20%20%20print(f%22Working%20with%20%7Blen(fish_species)%7D%20fish%20species%3A%20%7Bfish_species%7D%22)%0A%0A%20%20%20%20%23%201.%20Total%20fish%20activity%20(sum%20across%20all%20species)%0A%20%20%20%20%23%20This%20captures%20the%20overall%20%22biological%20energy%22%20in%20each%202-hour%20period%0A%20%20%20%20%23%20Range%3A%200%20(no%20calling)%20to%2021%20(all%20species%20calling%20at%20maximum%20intensity)%0A%20%20%20%20df_community%20%3D%20df_master.copy()%0A%20%20%20%20df_community%5B'total_fish_activity'%5D%20%3D%20df_community%5Bfish_species%5D.sum(axis%3D1)%0A%20%20%20%20print(f%22Total%20activity%20range%3A%20%7Bdf_community%5B'total_fish_activity'%5D.min()%3A.0f%7D%20to%20%7Bdf_community%5B'total_fish_activity'%5D.max()%3A.0f%7D%22)%0A%0A%20%20%20%20%23%202.%20Number%20of%20active%20species%20(how%20many%20species%20detected)%0A%20%20%20%20%23%20This%20measures%20community%20richness%20-%20are%20multiple%20species%20active%20simultaneously%3F%0A%20%20%20%20%23%20Range%3A%200%20(no%20species)%20to%207%20(all%20species%20calling)%0A%20%20%20%20df_community%5B'num_active_species'%5D%20%3D%20(df_community%5Bfish_species%5D%20%3E%200).sum(axis%3D1)%0A%20%20%20%20print(f%22Active%20species%20range%3A%20%7Bdf_community%5B'num_active_species'%5D.min()%3A.0f%7D%20to%20%7Bdf_community%5B'num_active_species'%5D.max()%3A.0f%7D%22)%0A%0A%20%20%20%20%23%203.%20Maximum%20species%20activity%20(highest%20calling%20intensity%20across%20species)%0A%20%20%20%20%23%20This%20captures%20the%20strength%20of%20the%20dominant%20biological%20signal%0A%20%20%20%20%23%20Range%3A%200%20(no%20activity)%20to%203%20(maximum%20intensity%20from%20at%20least%20one%20species)%0A%20%20%20%20df_community%5B'max_species_activity'%5D%20%3D%20df_community%5Bfish_species%5D.max(axis%3D1)%0A%20%20%20%20print(f%22Maximum%20activity%20range%3A%20%7Bdf_community%5B'max_species_activity'%5D.min()%3A.0f%7D%20to%20%7Bdf_community%5B'max_species_activity'%5D.max()%3A.0f%7D%22)%0A%0A%20%20%20%20%23%204.%20Activity%20diversity%20(simplified%20-%20coefficient%20of%20variation)%0A%20%20%20%20%23%20This%20measures%20how%20evenly%20distributed%20calling%20is%20across%20species%0A%20%20%20%20%23%20High%20values%20%3D%20one%20species%20dominates%2C%20Low%20values%20%3D%20multiple%20species%20calling%20similarly%0A%20%20%20%20df_community%5B'activity_diversity'%5D%20%3D%20df_community%5Bfish_species%5D.std(axis%3D1)%20%2F%20(df_community%5Bfish_species%5D.mean(axis%3D1)%20%2B%200.01)%0A%0A%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*60)%0A%20%20%20%20print(%22CREATING%20BINARY%20CLASSIFICATION%20TARGETS%22)%0A%20%20%20%20print(%22%3D%22*60)%0A%20%20%20%20print(%22Converting%20continuous%20community%20metrics%20into%20binary%20screening%20questions%3A%22)%0A%0A%20%20%20%20%23%205.%20Binary%20classification%20targets%20at%20different%20thresholds%0A%20%20%20%20%23%20These%20represent%20different%20%22screening%20sensitivity%22%20levels%0A%0A%20%20%20%20%23%20High%20vs%20low%20total%20activity%20(75th%20percentile%20threshold)%0A%20%20%20%20%23%20Question%3A%20%22Is%20this%20a%20period%20of%20elevated%20biological%20activity%3F%22%0A%20%20%20%20total_activity_75th%20%3D%20df_community%5B'total_fish_activity'%5D.quantile(0.75)%0A%20%20%20%20df_community%5B'high_activity_75th'%5D%20%3D%20(df_community%5B'total_fish_activity'%5D%20%3E%3D%20total_activity_75th).astype(int)%0A%20%20%20%20print(f%22High%20activity%20(75th%20percentile%2C%20threshold%3D%7Btotal_activity_75th%3A.1f%7D)%3A%20%7Bdf_community%5B'high_activity_75th'%5D.mean()%3A.1%25%7D%20of%20periods%22)%0A%0A%20%20%20%20%23%20Very%20high%20activity%20(90th%20percentile%20threshold)%0A%20%20%20%20%23%20Question%3A%20%22Is%20this%20a%20period%20of%20exceptional%20biological%20interest%3F%22%0A%20%20%20%20total_activity_90th%20%3D%20df_community%5B'total_fish_activity'%5D.quantile(0.90)%0A%20%20%20%20df_community%5B'high_activity_90th'%5D%20%3D%20(df_community%5B'total_fish_activity'%5D%20%3E%3D%20total_activity_90th).astype(int)%0A%20%20%20%20print(f%22Very%20high%20activity%20(90th%20percentile%2C%20threshold%3D%7Btotal_activity_90th%3A.1f%7D)%3A%20%7Bdf_community%5B'high_activity_90th'%5D.mean()%3A.1%25%7D%20of%20periods%22)%0A%0A%20%20%20%20%23%20Any%20biological%20activity%20vs%20none%0A%20%20%20%20%23%20Question%3A%20%22Is%20there%20any%20fish%20calling%20happening%20at%20all%3F%22%0A%20%20%20%20df_community%5B'any_activity'%5D%20%3D%20(df_community%5B'total_fish_activity'%5D%20%3E%200).astype(int)%0A%20%20%20%20print(f%22Any%20activity%20(threshold%3D0)%3A%20%7Bdf_community%5B'any_activity'%5D.mean()%3A.1%25%7D%20of%20periods%22)%0A%0A%20%20%20%20%23%20Multiple%20species%20active%20vs%20single%2Fnone%0A%20%20%20%20%23%20Question%3A%20%22Are%20multiple%20species%20interacting%2Fcalling%20together%3F%22%0A%20%20%20%20df_community%5B'multi_species_active'%5D%20%3D%20(df_community%5B'num_active_species'%5D%20%3E%3D%202).astype(int)%0A%20%20%20%20print(f%22Multi-species%20activity%20(%E2%89%A52%20species)%3A%20%7Bdf_community%5B'multi_species_active'%5D.mean()%3A.1%25%7D%20of%20periods%22)%0A%0A%20%20%20%20print(f%22Fish%20community%20metrics%20created.%20Sample%20statistics%3A%22)%0A%20%20%20%20print(f%22Total%20activity%20-%20Mean%3A%20%7Bdf_community%5B'total_fish_activity'%5D.mean()%3A.2f%7D%2C%20Max%3A%20%7Bdf_community%5B'total_fish_activity'%5D.max()%3A.0f%7D%22)%0A%20%20%20%20print(f%22Active%20species%20-%20Mean%3A%20%7Bdf_community%5B'num_active_species'%5D.mean()%3A.2f%7D%2C%20Max%3A%20%7Bdf_community%5B'num_active_species'%5D.max()%3A.0f%7D%22)%0A%20%20%20%20print(f%22High%20activity%20(75th)%3A%20%7Bdf_community%5B'high_activity_75th'%5D.mean()%3A.1%25%7D%22)%0A%20%20%20%20print(f%22High%20activity%20(90th)%3A%20%7Bdf_community%5B'high_activity_90th'%5D.mean()%3A.1%25%7D%22)%0A%20%20%20%20print(f%22Any%20activity%3A%20%7Bdf_community%5B'any_activity'%5D.mean()%3A.1%25%7D%22)%0A%20%20%20%20print(f%22Multi-species%20active%3A%20%7Bdf_community%5B'multi_species_active'%5D.mean()%3A.1%25%7D%22)%0A%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%23%20MARINE%20COMMUNITY%20METRICS%20(Fish%20%2B%20Dolphins)%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20df_marine%20%3D%20None%0A%20%20%20%20marine_activity_75th%20%3D%20None%0A%20%20%20%20marine_activity_90th%20%3D%20None%0A%0A%20%20%20%20if%20df_marine_community%20is%20not%20None%3A%0A%20%20%20%20%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*70)%0A%20%20%20%20%20%20%20%20print(%22CREATING%20MARINE%20COMMUNITY%20METRICS%20(FISH%20%2B%20DOLPHINS)%22)%0A%20%20%20%20%20%20%20%20print(%22%3D%22*70)%0A%0A%20%20%20%20%20%20%20%20%23%20Create%20marine%20master%20dataset%20by%20merging%20with%20enhanced%20marine%20community%20data%0A%20%20%20%20%20%20%20%20%23%20Use%20the%20marine%20community%20data%20which%20includes%20fish%20%2B%20dolphin%20metrics%0A%0A%20%20%20%20%20%20%20%20%23%20First%2C%20get%20marine%20species%20columns%20from%20marine%20community%20data%0A%20%20%20%20%20%20%20%20marine_species_cols%20%3D%20%5Bcol%20for%20col%20in%20df_marine_community.columns%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20col%20not%20in%20%5B'datetime'%2C%20'station'%2C%20'year'%2C%20'total_fish_intensity'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'num_active_fish_species'%2C%20'max_fish_intensity'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'dolphin_count'%2C%20'dolphin_intensity'%2C%20'total_marine_intensity'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'num_active_marine_species'%2C%20'max_marine_intensity'%5D%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Get%20just%20the%20fish%20species%20from%20the%20marine%20data%20(should%20match%20fish_species)%0A%20%20%20%20%20%20%20%20marine_fish_species%20%3D%20%5Bcol%20for%20col%20in%20marine_species_cols%20if%20col%20in%20fish_species%5D%0A%0A%20%20%20%20%20%20%20%20print(f%22Creating%20marine%20community%20dataset%20with%20%7Blen(marine_fish_species)%7D%20fish%20species%20%2B%20dolphins%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Create%20marine%20master%20dataset%0A%20%20%20%20%20%20%20%20df_marine_master%20%3D%20df_indices.merge(%0A%20%20%20%20%20%20%20%20%20%20%20%20df_marine_community%5B%5B'datetime'%2C%20'station'%2C%20'year'%5D%20%2B%20marine_fish_species%20%2B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B'dolphin_intensity'%2C%20'total_marine_intensity'%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'num_active_marine_species'%2C%20'max_marine_intensity'%5D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20on%3D%5B'datetime'%2C%20'station'%2C%20'year'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20how%3D'left'%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%20Merge%20with%20environmental%20and%20temporal%20data%20(same%20as%20fish-only)%0A%20%20%20%20%20%20%20%20df_marine_master%20%3D%20df_marine_master.merge(%0A%20%20%20%20%20%20%20%20%20%20%20%20df_env%5B%5B'datetime'%2C%20'station'%2C%20'year'%2C%20'Water%20temp%20(%C2%B0C)'%2C%20'Water%20depth%20(m)'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Broadband%20(1-40000%20Hz)'%2C%20'Low%20(50-1200%20Hz)'%2C%20'High%20(7000-40000%20Hz)'%5D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20on%3D%5B'datetime'%2C%20'station'%2C%20'year'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20how%3D'left'%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20df_marine_master%20%3D%20df_marine_master.merge(%0A%20%20%20%20%20%20%20%20%20%20%20%20df_temporal%5B%5B'datetime'%2C%20'station'%2C%20'year'%2C%20'hour'%2C%20'month'%2C%20'season'%2C%20'time_period'%5D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20on%3D%5B'datetime'%2C%20'station'%2C%20'year'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20how%3D'left'%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%20Rename%20time_period%20to%20diel_period%20for%20consistency%0A%20%20%20%20%20%20%20%20df_marine_master%20%3D%20df_marine_master.rename(columns%3D%7B'time_period'%3A%20'diel_period'%7D)%0A%0A%20%20%20%20%20%20%20%20print(f%22Marine%20master%20dataset%20shape%3A%20%7Bdf_marine_master.shape%7D%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Create%20marine%20community%20dataset%0A%20%20%20%20%20%20%20%20df_marine%20%3D%20df_marine_master.copy()%0A%0A%20%20%20%20%20%20%20%20%23%20Use%20the%20pre-computed%20marine%20community%20metrics%20from%20notebook%2008%0A%20%20%20%20%20%20%20%20print(%22Using%20pre-computed%20marine%20community%20metrics%20from%20notebook%2008...%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Rename%20marine%20metrics%20to%20match%20fish%20naming%20convention%20for%20consistency%0A%20%20%20%20%20%20%20%20df_marine%5B'total_marine_activity'%5D%20%3D%20df_marine%5B'total_marine_intensity'%5D%0A%20%20%20%20%20%20%20%20df_marine%5B'num_active_marine_species'%5D%20%3D%20df_marine%5B'num_active_marine_species'%5D%0A%20%20%20%20%20%20%20%20df_marine%5B'max_marine_activity'%5D%20%3D%20df_marine%5B'max_marine_intensity'%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Add%20dolphin-specific%20metrics%0A%20%20%20%20%20%20%20%20df_marine%5B'dolphin_activity'%5D%20%3D%20df_marine%5B'dolphin_intensity'%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20activity%20diversity%20for%20marine%20community%0A%20%20%20%20%20%20%20%20all_marine_species%20%3D%20marine_fish_species%20%2B%20%5B'dolphin_intensity'%5D%0A%20%20%20%20%20%20%20%20df_marine%5B'marine_activity_diversity'%5D%20%3D%20df_marine%5Ball_marine_species%5D.std(axis%3D1)%20%2F%20(df_marine%5Ball_marine_species%5D.mean(axis%3D1)%20%2B%200.01)%0A%0A%20%20%20%20%20%20%20%20print(f%22Marine%20activity%20range%3A%20%7Bdf_marine%5B'total_marine_activity'%5D.min()%3A.0f%7D%20to%20%7Bdf_marine%5B'total_marine_activity'%5D.max()%3A.0f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22Marine%20species%20range%3A%20%7Bdf_marine%5B'num_active_marine_species'%5D.min()%3A.0f%7D%20to%20%7Bdf_marine%5B'num_active_marine_species'%5D.max()%3A.0f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22Dolphin%20activity%20range%3A%20%7Bdf_marine%5B'dolphin_activity'%5D.min()%3A.0f%7D%20to%20%7Bdf_marine%5B'dolphin_activity'%5D.max()%3A.0f%7D%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Create%20binary%20classification%20targets%20for%20marine%20community%0A%20%20%20%20%20%20%20%20print(%22%5CnCreating%20marine%20community%20binary%20classification%20targets...%22)%0A%0A%20%20%20%20%20%20%20%20%23%20High%20vs%20low%20marine%20activity%20(75th%20percentile%20threshold)%0A%20%20%20%20%20%20%20%20marine_activity_75th%20%3D%20df_marine%5B'total_marine_activity'%5D.quantile(0.75)%0A%20%20%20%20%20%20%20%20df_marine%5B'high_marine_activity_75th'%5D%20%3D%20(df_marine%5B'total_marine_activity'%5D%20%3E%3D%20marine_activity_75th).astype(int)%0A%20%20%20%20%20%20%20%20print(f%22High%20marine%20activity%20(75th%20percentile%2C%20threshold%3D%7Bmarine_activity_75th%3A.1f%7D)%3A%20%7Bdf_marine%5B'high_marine_activity_75th'%5D.mean()%3A.1%25%7D%20of%20periods%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Very%20high%20marine%20activity%20(90th%20percentile%20threshold)%0A%20%20%20%20%20%20%20%20marine_activity_90th%20%3D%20df_marine%5B'total_marine_activity'%5D.quantile(0.90)%0A%20%20%20%20%20%20%20%20df_marine%5B'high_marine_activity_90th'%5D%20%3D%20(df_marine%5B'total_marine_activity'%5D%20%3E%3D%20marine_activity_90th).astype(int)%0A%20%20%20%20%20%20%20%20print(f%22Very%20high%20marine%20activity%20(90th%20percentile%2C%20threshold%3D%7Bmarine_activity_90th%3A.1f%7D)%3A%20%7Bdf_marine%5B'high_marine_activity_90th'%5D.mean()%3A.1%25%7D%20of%20periods%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Any%20marine%20biological%20activity%20vs%20none%0A%20%20%20%20%20%20%20%20df_marine%5B'any_marine_activity'%5D%20%3D%20(df_marine%5B'total_marine_activity'%5D%20%3E%200).astype(int)%0A%20%20%20%20%20%20%20%20print(f%22Any%20marine%20activity%20(threshold%3D0)%3A%20%7Bdf_marine%5B'any_marine_activity'%5D.mean()%3A.1%25%7D%20of%20periods%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Multiple%20marine%20species%20active%20vs%20single%2Fnone%20%20%0A%20%20%20%20%20%20%20%20df_marine%5B'multi_marine_species_active'%5D%20%3D%20(df_marine%5B'num_active_marine_species'%5D%20%3E%3D%202).astype(int)%0A%20%20%20%20%20%20%20%20print(f%22Multi-species%20marine%20activity%20(%E2%89%A52%20species)%3A%20%7Bdf_marine%5B'multi_marine_species_active'%5D.mean()%3A.1%25%7D%20of%20periods%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Dolphin-specific%20targets%0A%20%20%20%20%20%20%20%20df_marine%5B'dolphin_present'%5D%20%3D%20(df_marine%5B'dolphin_activity'%5D%20%3E%200).astype(int)%0A%20%20%20%20%20%20%20%20print(f%22Dolphin%20presence%3A%20%7Bdf_marine%5B'dolphin_present'%5D.mean()%3A.1%25%7D%20of%20periods%22)%0A%0A%20%20%20%20%20%20%20%20print(f%22%5CnMarine%20community%20metrics%20created.%20Sample%20statistics%3A%22)%0A%20%20%20%20%20%20%20%20print(f%22Total%20marine%20activity%20-%20Mean%3A%20%7Bdf_marine%5B'total_marine_activity'%5D.mean()%3A.2f%7D%2C%20Max%3A%20%7Bdf_marine%5B'total_marine_activity'%5D.max()%3A.0f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22Active%20marine%20species%20-%20Mean%3A%20%7Bdf_marine%5B'num_active_marine_species'%5D.mean()%3A.2f%7D%2C%20Max%3A%20%7Bdf_marine%5B'num_active_marine_species'%5D.max()%3A.0f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22Dolphin%20activity%20-%20Mean%3A%20%7Bdf_marine%5B'dolphin_activity'%5D.mean()%3A.2f%7D%2C%20Max%3A%20%7Bdf_marine%5B'dolphin_activity'%5D.max()%3A.0f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22High%20marine%20activity%20(75th)%3A%20%7Bdf_marine%5B'high_marine_activity_75th'%5D.mean()%3A.1%25%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22High%20marine%20activity%20(90th)%3A%20%7Bdf_marine%5B'high_marine_activity_90th'%5D.mean()%3A.1%25%7D%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Comparison%20between%20fish-only%20and%20marine%20community%0A%20%20%20%20%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*50)%0A%20%20%20%20%20%20%20%20print(%22FISH%20vs%20MARINE%20COMMUNITY%20COMPARISON%22)%0A%20%20%20%20%20%20%20%20print(%22%3D%22*50)%0A%0A%20%20%20%20%20%20%20%20%23%20Match%20periods%20between%20datasets%20for%20fair%20comparison%0A%20%20%20%20%20%20%20%20common_indices%20%3D%20df_community.index.intersection(df_marine.index)%0A%0A%20%20%20%20%20%20%20%20if%20len(common_indices)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20fish_mean%20%3D%20df_community.loc%5Bcommon_indices%2C%20'total_fish_activity'%5D.mean()%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_mean%20%3D%20df_marine.loc%5Bcommon_indices%2C%20'total_marine_activity'%5D.mean()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Mean%20activity%20comparison%20(matched%20periods%2C%20n%3D%7Blen(common_indices)%3A%2C%7D)%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20Fish-only%20community%3A%20%7Bfish_mean%3A.2f%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20Marine%20community%20(fish%20%2B%20dolphins)%3A%20%7Bmarine_mean%3A.2f%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20Marine%20enhancement%3A%20%2B%7B((marine_mean%20-%20fish_mean)%20%2F%20fish_mean%20*%20100)%3A.1f%7D%25%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20fish_high_75%20%3D%20df_community.loc%5Bcommon_indices%2C%20'high_activity_75th'%5D.mean()%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_high_75%20%3D%20df_marine.loc%5Bcommon_indices%2C%20'high_marine_activity_75th'%5D.mean()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22High%20activity%20periods%20(75th%20percentile)%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20Fish-only%3A%20%7Bfish_high_75%3A.1%25%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20Marine%3A%20%7Bmarine_high_75%3A.1%25%7D%22)%0A%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print(%22%5Cn%E2%9A%A0%EF%B8%8F%20Marine%20community%20data%20not%20available%20-%20skipping%20marine%20metrics%22)%0A%20%20%20%20%20%20%20%20print(%22Run%20notebook%2007%20first%20to%20generate%20enhanced%20marine%20community%20dataset%22)%0A%20%20%20%20return%20df_community%2C%20df_marine%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Model%20Development%20for%20Community%20Activity%20Detection%0A%0A%20%20%20%20Training%20multiple%20classifiers%20to%20predict%20community-level%20biological%20activity%20using%20acoustic%20indices.%0A%0A%20%20%20%20%23%23%20Machine%20Learning%20Algorithms%20Explained%0A%0A%20%20%20%20We%20test%20four%20different%20classification%20algorithms%2C%20each%20with%20distinct%20strengths%20for%20biological%20screening%3A%0A%0A%20%20%20%20%23%23%23%201.%20Logistic%20Regression%0A%20%20%20%20-%20**How%20it%20works**%3A%20Linear%20combination%20of%20features%20%E2%86%92%20probability%20via%20sigmoid%20function%0A%20%20%20%20-%20**Strengths**%3A%20Fast%2C%20interpretable%20coefficients%2C%20stable%20predictions%0A%20%20%20%20-%20**Best%20for**%3A%20Understanding%20which%20indices%20have%20linear%20relationships%20with%20biology%0A%20%20%20%20-%20**Interpretation**%3A%20Coefficient%20sign%2Fmagnitude%20shows%20feature%20importance%20and%20direction%0A%0A%20%20%20%20%23%23%23%202.%20Decision%20Tree%0A%0A%20%20%20%20-%20**How%20it%20works**%3A%20Sequential%20yes%2Fno%20questions%20creating%20rule-based%20decisions%0A%20%20%20%20-%20**Strengths**%3A%20Highly%20interpretable%2C%20handles%20non-linear%20patterns%2C%20no%20assumptions%20about%20data%20distribution%0A%20%20%20%20-%20**Best%20for**%3A%20Creating%20simple%20screening%20rules%20(e.g.%2C%20%22if%20index%20X%20%3E%20threshold%20AND%20temperature%20%3E%20Y%2C%20then%20high%20activity%22)%0A%20%20%20%20-%20**Interpretation**%3A%20Tree%20branches%20show%20exact%20decision%20logic%0A%0A%20%20%20%20%23%23%23%203.%20Random%20Forest%0A%0A%20%20%20%20-%20**How%20it%20works**%3A%20Combines%20predictions%20from%20100%20different%20decision%20trees%0A%20%20%20%20-%20**Strengths**%3A%20Handles%20complex%20interactions%2C%20resistant%20to%20overfitting%2C%20robust%20to%20outliers%0A%20%20%20%20-%20**Best%20for**%3A%20Maximizing%20predictive%20performance%20while%20maintaining%20some%20interpretability%0A%20%20%20%20-%20**Interpretation**%3A%20Feature%20importance%20ranks%20show%20which%20indices%20contribute%20most%20to%20predictions%0A%0A%20%20%20%20%23%23%23%204.%20Gradient%20Boosting%20%20**%20not%20implemented%20due%20to%20computational%20constraints%0A%0A%20%20%20%20-%20**How%20it%20works**%3A%20Sequentially%20builds%20models%2C%20each%20correcting%20previous%20model's%20mistakes%0A%20%20%20%20-%20**Strengths**%3A%20Often%20highest%20accuracy%2C%20excellent%20at%20detecting%20subtle%20patterns%0A%20%20%20%20-%20**Best%20for**%3A%20Maximum%20screening%20performance%20when%20interpretability%20is%20less%20critical%0A%20%20%20%20-%20**Interpretation**%3A%20Feature%20importance%20shows%20cumulative%20contribution%20across%20all%20boosting%20iterations%0A%0A%20%20%20%20%23%23%20Evaluation%20Strategy%0A%0A%20%20%20%20For%20biological%20screening%2C%20we%20care%20more%20about%20**practical%20performance**%20than%20traditional%20accuracy%3A%0A%0A%20%20%20%20-%20**F1%20Score**%3A%20Balances%20precision%20(few%20false%20alarms)%20with%20recall%20(catch%20most%20activity)%0A%20%20%20%20-%20**Cross-validation**%3A%205-fold%20stratified%20to%20ensure%20robust%20performance%20estimates%0A%20%20%20%20-%20**Class%20balance**%3A%20Account%20for%20unequal%20representation%20of%20active%20vs%20inactive%20periods%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20DecisionTreeClassifier%2C%0A%20%20%20%20LogisticRegression%2C%0A%20%20%20%20RandomForestClassifier%2C%0A%20%20%20%20StandardScaler%2C%0A%20%20%20%20StratifiedKFold%2C%0A%20%20%20%20accuracy_score%2C%0A%20%20%20%20cohen_kappa_score%2C%0A%20%20%20%20cross_val_score%2C%0A%20%20%20%20df_community%2C%0A%20%20%20%20df_marine%2C%0A%20%20%20%20f1_score%2C%0A%20%20%20%20index_cols%2C%0A%20%20%20%20precision_score%2C%0A%20%20%20%20recall_score%2C%0A%20%20%20%20train_test_split%2C%0A)%3A%0A%20%20%20%20%23%20Prepare%20data%20for%20comparative%20community%20activity%20modeling%0A%20%20%20%20print(%22Preparing%20data%20for%20COMPARATIVE%20community%20activity%20modeling...%22)%0A%20%20%20%20print(%22%3D%22*80)%0A%20%20%20%20print(%22Training%20models%20for%20both%20fish-only%20and%20marine%20(fish%20%2B%20dolphin)%20communities%22)%0A%20%20%20%20print(%22%3D%22*80)%0A%0A%20%20%20%20%23%20Feature%20Selection%20Strategy%0A%20%20%20%20%23%20Combine%20acoustic%20indices%20with%20key%20environmental%20and%20temporal%20variables%0A%20%20%20%20%23%20This%20tests%20whether%20indices%20add%20value%20beyond%20simple%20environmental%20predictors%0A%20%20%20%20modeling_cols%20%3D%20index_cols%20%2B%20%5B'Water%20temp%20(%C2%B0C)'%2C%20'Water%20depth%20(m)'%2C%20'hour'%2C%20'month'%5D%0A%0A%20%20%20%20%23%20Define%20target%20sets%20for%20both%20community%20types%0A%20%20%20%20fish_target_cols%20%3D%20%5B'high_activity_75th'%2C%20'high_activity_90th'%2C%20'any_activity'%2C%20'multi_species_active'%5D%0A%20%20%20%20marine_target_cols%20%3D%20%5B'high_marine_activity_75th'%2C%20'high_marine_activity_90th'%2C%20'any_marine_activity'%2C%20'multi_marine_species_active'%2C%20'dolphin_present'%5D%0A%0A%20%20%20%20print(f%22Feature%20categories%3A%22)%0A%20%20%20%20print(f%22%20%20-%20Acoustic%20indices%3A%20%7Blen(index_cols)%7D%20variables%22)%0A%20%20%20%20print(f%22%20%20-%20Environmental%3A%202%20variables%20(temperature%2C%20depth)%22)%0A%20%20%20%20print(f%22%20%20-%20Temporal%3A%202%20variables%20(hour%2C%20month)%22)%0A%20%20%20%20print(f%22%20%20-%20Total%20features%3A%20%7Blen(modeling_cols)%7D%22)%0A%0A%20%20%20%20print(f%22%5CnTarget%20categories%3A%22)%0A%20%20%20%20print(f%22%20%20-%20Fish-only%20community%3A%20%7Blen(fish_target_cols)%7D%20targets%22)%0A%20%20%20%20print(f%22%20%20-%20Marine%20community%3A%20%7Blen(marine_target_cols)%7D%20targets%22)%0A%0A%20%20%20%20%23%20Model%20configurations%20with%20biological%20screening%20in%20mind%0A%20%20%20%20models%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'Logistic%20Regression'%3A%20LogisticRegression(max_iter%3D1000%2C%20random_state%3D42)%2C%0A%20%20%20%20%20%20%20%20'Decision%20Tree'%3A%20DecisionTreeClassifier(%0A%20%20%20%20%20%20%20%20%20%20%20%20max_depth%3D8%2C%20%20%20%20%20%20%20%20%20%20%20%23%20Prevent%20overfitting%20while%20allowing%20complexity%0A%20%20%20%20%20%20%20%20%20%20%20%20min_samples_leaf%3D10%2C%20%20%20%23%20Ensure%20robust%20leaf%20nodes%0A%20%20%20%20%20%20%20%20%20%20%20%20random_state%3D42%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20'Random%20Forest'%3A%20RandomForestClassifier(%0A%20%20%20%20%20%20%20%20%20%20%20%20n_estimators%3D100%2C%20%20%20%20%20%20%23%20Good%20balance%20of%20performance%20vs%20speed%0A%20%20%20%20%20%20%20%20%20%20%20%20max_depth%3D8%2C%20%20%20%20%20%20%20%20%20%20%20%23%20Match%20decision%20tree%20depth%0A%20%20%20%20%20%20%20%20%20%20%20%20min_samples_leaf%3D5%2C%20%20%20%20%23%20Allow%20slightly%20smaller%20leaves%20in%20ensemble%0A%20%20%20%20%20%20%20%20%20%20%20%20random_state%3D42%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%7D%0A%20%20%20%20print(f%22Models%20configured%3A%20%7Blist(models.keys())%7D%22)%0A%0A%20%20%20%20%23%20Initialize%20results%20storage%0A%20%20%20%20all_model_results%20%3D%20%7B%7D%0A%20%20%20%20all_modeling_datasets%20%3D%20%7B%7D%0A%20%20%20%20all_scalers%20%3D%20%7B%7D%0A%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%23%20FISH-ONLY%20COMMUNITY%20MODELING%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*60)%0A%20%20%20%20print(%22FISH-ONLY%20COMMUNITY%20MODEL%20TRAINING%22)%0A%20%20%20%20print(%22%3D%22*60)%0A%0A%20%20%20%20%23%20Prepare%20fish-only%20dataset%0A%20%20%20%20df_fish_modeling%20%3D%20df_community%5Bmodeling_cols%20%2B%20fish_target_cols%5D.dropna()%0A%20%20%20%20print(f%22Fish%20modeling%20dataset%3A%20%7Bdf_fish_modeling.shape%5B0%5D%3A%2C%7D%20complete%20samples%22)%0A%20%20%20%20print(f%22Fish%20data%20completeness%3A%20%7Blen(df_fish_modeling)%2Flen(df_community)%3A.1%25%7D%20of%20original%20data%22)%0A%0A%20%20%20%20%23%20Feature%20matrix%20preparation%20for%20fish%0A%20%20%20%20X_fish_features%20%3D%20df_fish_modeling%5Bmodeling_cols%5D%0A%0A%20%20%20%20%23%20Standardization%20for%20fish%20data%0A%20%20%20%20print(f%22%5CnStandardizing%20fish%20community%20features...%22)%0A%20%20%20%20print(f%22Before%20scaling%20-%20Temperature%20range%3A%20%7BX_fish_features%5B'Water%20temp%20(%C2%B0C)'%5D.min()%3A.1f%7D%20to%20%7BX_fish_features%5B'Water%20temp%20(%C2%B0C)'%5D.max()%3A.1f%7D%22)%0A%20%20%20%20if%20'ACTspFract'%20in%20X_fish_features.columns%3A%0A%20%20%20%20%20%20%20%20print(f%22Before%20scaling%20-%20ACTspFract%20range%3A%20%7BX_fish_features%5B'ACTspFract'%5D.min()%3A.3f%7D%20to%20%7BX_fish_features%5B'ACTspFract'%5D.max()%3A.3f%7D%22)%0A%0A%20%20%20%20scaler_fish%20%3D%20StandardScaler()%0A%20%20%20%20X_fish_scaled%20%3D%20scaler_fish.fit_transform(X_fish_features)%0A%20%20%20%20print(f%22After%20scaling%20-%20All%20features%20have%20mean%E2%89%880%2C%20std%E2%89%881%22)%0A%0A%20%20%20%20%23%20Store%20fish%20datasets%20and%20scaler%0A%20%20%20%20all_modeling_datasets%5B'fish'%5D%20%3D%20df_fish_modeling%0A%20%20%20%20all_scalers%5B'fish'%5D%20%3D%20scaler_fish%0A%0A%20%20%20%20%23%20Train%20fish%20models%0A%20%20%20%20fish_model_results%20%3D%20%7B%7D%0A%0A%20%20%20%20for%20target_name%20in%20fish_target_cols%3A%0A%20%20%20%20%20%20%20%20print(f%22%5CnTraining%20fish%20models%20for%3A%20%7Btarget_name%7D%22)%0A%20%20%20%20%20%20%20%20y_target%20%3D%20df_fish_modeling%5Btarget_name%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Check%20class%20balance%0A%20%20%20%20%20%20%20%20class_balance%20%3D%20y_target.value_counts(normalize%3DTrue)%0A%20%20%20%20%20%20%20%20print(f%22Class%20balance%3A%20%7Bclass_balance.to_dict()%7D%22)%0A%0A%20%20%20%20%20%20%20%20if%20y_target.std()%20%3D%3D%200%3A%20%20%23%20Skip%20if%20no%20variance%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Skipping%20%7Btarget_name%7D%20-%20no%20variance%20in%20target%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%0A%20%20%20%20%20%20%20%20%23%20Split%20data%0A%20%20%20%20%20%20%20%20X_train%2C%20X_test%2C%20y_train%2C%20y_test%20%3D%20train_test_split(%0A%20%20%20%20%20%20%20%20%20%20%20%20X_fish_scaled%2C%20y_target%2C%20test_size%3D0.3%2C%20random_state%3D42%2C%20stratify%3Dy_target%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20target_results%20%3D%20%7B%7D%0A%0A%20%20%20%20%20%20%20%20for%20model_name%2C%20model%20in%20models.items()%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Create%20fresh%20model%20instance%0A%20%20%20%20%20%20%20%20%20%20%20%20model_instance%20%3D%20type(model)(**model.get_params())%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Train%20model%0A%20%20%20%20%20%20%20%20%20%20%20%20model_instance.fit(X_train%2C%20y_train)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Predictions%0A%20%20%20%20%20%20%20%20%20%20%20%20y_pred%20%3D%20model_instance.predict(X_test)%0A%20%20%20%20%20%20%20%20%20%20%20%20y_prob%20%3D%20model_instance.predict_proba(X_test)%5B%3A%2C%201%5D%20if%20hasattr(model_instance%2C%20'predict_proba')%20else%20y_pred%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Metrics%0A%20%20%20%20%20%20%20%20%20%20%20%20accuracy%20%3D%20accuracy_score(y_test%2C%20y_pred)%0A%20%20%20%20%20%20%20%20%20%20%20%20precision%20%3D%20precision_score(y_test%2C%20y_pred%2C%20average%3D'binary'%2C%20zero_division%3D0)%0A%20%20%20%20%20%20%20%20%20%20%20%20recall%20%3D%20recall_score(y_test%2C%20y_pred%2C%20average%3D'binary'%2C%20zero_division%3D0)%0A%20%20%20%20%20%20%20%20%20%20%20%20f1%20%3D%20f1_score(y_test%2C%20y_pred%2C%20average%3D'binary'%2C%20zero_division%3D0)%0A%20%20%20%20%20%20%20%20%20%20%20%20kappa%20%3D%20cohen_kappa_score(y_test%2C%20y_pred)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Cross-validation%0A%20%20%20%20%20%20%20%20%20%20%20%20cv_model%20%3D%20type(model)(**model.get_params())%0A%20%20%20%20%20%20%20%20%20%20%20%20cv_scores%20%3D%20cross_val_score(cv_model%2C%20X_fish_scaled%2C%20y_target%2C%20cv%3DStratifiedKFold(5)%2C%20scoring%3D'f1')%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20target_results%5Bmodel_name%5D%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'model'%3A%20model_instance%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'accuracy'%3A%20accuracy%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'precision'%3A%20precision%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'recall'%3A%20recall%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'f1'%3A%20f1%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'kappa'%3A%20kappa%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'cv_f1_mean'%3A%20cv_scores.mean()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'cv_f1_std'%3A%20cv_scores.std()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'y_test'%3A%20y_test%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'y_pred'%3A%20y_pred%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'y_prob'%3A%20y_prob%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'community_type'%3A%20'fish'%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20%7Bmodel_name%7D%3A%20F1%3D%7Bf1%3A.3f%7D%2C%20Precision%3D%7Bprecision%3A.3f%7D%2C%20Recall%3D%7Brecall%3A.3f%7D%22)%0A%0A%20%20%20%20%20%20%20%20fish_model_results%5Btarget_name%5D%20%3D%20target_results%0A%0A%20%20%20%20all_model_results%5B'fish'%5D%20%3D%20fish_model_results%0A%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%23%20MARINE%20COMMUNITY%20MODELING%20(if%20available)%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20marine_model_results%20%3D%20%7B%7D%0A%20%20%20%20X_marine_scaled%20%3D%20None%0A%20%20%20%20df_marine_modeling%20%3D%20None%0A%20%20%20%20scaler_marine%20%3D%20None%0A%0A%20%20%20%20if%20df_marine%20is%20not%20None%3A%0A%20%20%20%20%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*60)%0A%20%20%20%20%20%20%20%20print(%22MARINE%20COMMUNITY%20(FISH%20%2B%20DOLPHIN)%20MODEL%20TRAINING%22)%0A%20%20%20%20%20%20%20%20print(%22%3D%22*60)%0A%0A%20%20%20%20%20%20%20%20%23%20Prepare%20marine%20dataset%0A%20%20%20%20%20%20%20%20df_marine_modeling%20%3D%20df_marine%5Bmodeling_cols%20%2B%20marine_target_cols%5D.dropna()%0A%20%20%20%20%20%20%20%20print(f%22Marine%20modeling%20dataset%3A%20%7Bdf_marine_modeling.shape%5B0%5D%3A%2C%7D%20complete%20samples%22)%0A%20%20%20%20%20%20%20%20print(f%22Marine%20data%20completeness%3A%20%7Blen(df_marine_modeling)%2Flen(df_marine)%3A.1%25%7D%20of%20original%20marine%20data%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Feature%20matrix%20preparation%20for%20marine%0A%20%20%20%20%20%20%20%20X_marine_features%20%3D%20df_marine_modeling%5Bmodeling_cols%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Standardization%20for%20marine%20data%0A%20%20%20%20%20%20%20%20print(f%22%5CnStandardizing%20marine%20community%20features...%22)%0A%20%20%20%20%20%20%20%20print(f%22Before%20scaling%20-%20Temperature%20range%3A%20%7BX_marine_features%5B'Water%20temp%20(%C2%B0C)'%5D.min()%3A.1f%7D%20to%20%7BX_marine_features%5B'Water%20temp%20(%C2%B0C)'%5D.max()%3A.1f%7D%22)%0A%20%20%20%20%20%20%20%20if%20'ACTspFract'%20in%20X_marine_features.columns%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Before%20scaling%20-%20ACTspFract%20range%3A%20%7BX_marine_features%5B'ACTspFract'%5D.min()%3A.3f%7D%20to%20%7BX_marine_features%5B'ACTspFract'%5D.max()%3A.3f%7D%22)%0A%0A%20%20%20%20%20%20%20%20scaler_marine%20%3D%20StandardScaler()%0A%20%20%20%20%20%20%20%20X_marine_scaled%20%3D%20scaler_marine.fit_transform(X_marine_features)%0A%20%20%20%20%20%20%20%20print(f%22After%20scaling%20-%20All%20features%20have%20mean%E2%89%880%2C%20std%E2%89%881%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Store%20marine%20datasets%20and%20scaler%0A%20%20%20%20%20%20%20%20all_modeling_datasets%5B'marine'%5D%20%3D%20df_marine_modeling%0A%20%20%20%20%20%20%20%20all_scalers%5B'marine'%5D%20%3D%20scaler_marine%0A%0A%20%20%20%20%20%20%20%20%23%20Train%20marine%20models%0A%20%20%20%20%20%20%20%20for%20target_name%20in%20marine_target_cols%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5CnTraining%20marine%20models%20for%3A%20%7Btarget_name%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20y_target%20%3D%20df_marine_modeling%5Btarget_name%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Check%20class%20balance%0A%20%20%20%20%20%20%20%20%20%20%20%20class_balance%20%3D%20y_target.value_counts(normalize%3DTrue)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Class%20balance%3A%20%7Bclass_balance.to_dict()%7D%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20y_target.std()%20%3D%3D%200%3A%20%20%23%20Skip%20if%20no%20variance%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Skipping%20%7Btarget_name%7D%20-%20no%20variance%20in%20target%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Split%20data%0A%20%20%20%20%20%20%20%20%20%20%20%20X_train%2C%20X_test%2C%20y_train%2C%20y_test%20%3D%20train_test_split(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20X_marine_scaled%2C%20y_target%2C%20test_size%3D0.3%2C%20random_state%3D42%2C%20stratify%3Dy_target%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20target_results%20%3D%20%7B%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20model_name%2C%20model%20in%20models.items()%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Create%20fresh%20model%20instance%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model_instance%20%3D%20type(model)(**model.get_params())%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Train%20model%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model_instance.fit(X_train%2C%20y_train)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Predictions%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y_pred%20%3D%20model_instance.predict(X_test)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y_prob%20%3D%20model_instance.predict_proba(X_test)%5B%3A%2C%201%5D%20if%20hasattr(model_instance%2C%20'predict_proba')%20else%20y_pred%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Metrics%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20accuracy%20%3D%20accuracy_score(y_test%2C%20y_pred)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20precision%20%3D%20precision_score(y_test%2C%20y_pred%2C%20average%3D'binary'%2C%20zero_division%3D0)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recall%20%3D%20recall_score(y_test%2C%20y_pred%2C%20average%3D'binary'%2C%20zero_division%3D0)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f1%20%3D%20f1_score(y_test%2C%20y_pred%2C%20average%3D'binary'%2C%20zero_division%3D0)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kappa%20%3D%20cohen_kappa_score(y_test%2C%20y_pred)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Cross-validation%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cv_model%20%3D%20type(model)(**model.get_params())%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cv_scores%20%3D%20cross_val_score(cv_model%2C%20X_marine_scaled%2C%20y_target%2C%20cv%3DStratifiedKFold(5)%2C%20scoring%3D'f1')%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20target_results%5Bmodel_name%5D%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'model'%3A%20model_instance%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'accuracy'%3A%20accuracy%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'precision'%3A%20precision%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'recall'%3A%20recall%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'f1'%3A%20f1%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'kappa'%3A%20kappa%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'cv_f1_mean'%3A%20cv_scores.mean()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'cv_f1_std'%3A%20cv_scores.std()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'y_test'%3A%20y_test%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'y_pred'%3A%20y_pred%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'y_prob'%3A%20y_prob%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'community_type'%3A%20'marine'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20%7Bmodel_name%7D%3A%20F1%3D%7Bf1%3A.3f%7D%2C%20Precision%3D%7Bprecision%3A.3f%7D%2C%20Recall%3D%7Brecall%3A.3f%7D%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_model_results%5Btarget_name%5D%20%3D%20target_results%0A%0A%20%20%20%20%20%20%20%20all_model_results%5B'marine'%5D%20%3D%20marine_model_results%0A%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print(%22%5Cn%E2%9A%A0%EF%B8%8F%20Marine%20community%20data%20not%20available%20-%20training%20fish-only%20models%20only%22)%0A%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%23%20COMPARATIVE%20SUMMARY%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*80)%0A%20%20%20%20print(%22COMPARATIVE%20MODELING%20SUMMARY%22)%0A%20%20%20%20print(%22%3D%22*80)%0A%0A%20%20%20%20print(f%22Fish-only%20community%3A%20%7Blen(fish_model_results)%7D%20targets%20trained%22)%0A%20%20%20%20if%20marine_model_results%3A%0A%20%20%20%20%20%20%20%20print(f%22Marine%20community%3A%20%7Blen(marine_model_results)%7D%20targets%20trained%22)%0A%20%20%20%20%20%20%20%20print(f%22Total%20model%20training%20runs%3A%20%7B(len(fish_model_results)%20%2B%20len(marine_model_results))%20*%20len(models)%7D%22)%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print(f%22Marine%20community%3A%20Not%20available%22)%0A%20%20%20%20%20%20%20%20print(f%22Total%20model%20training%20runs%3A%20%7Blen(fish_model_results)%20*%20len(models)%7D%22)%0A%0A%20%20%20%20print(f%22%5CnModel%20training%20complete!%22)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20X_fish_scaled%2C%0A%20%20%20%20%20%20%20%20X_marine_scaled%2C%0A%20%20%20%20%20%20%20%20all_model_results%2C%0A%20%20%20%20%20%20%20%20all_modeling_datasets%2C%0A%20%20%20%20%20%20%20%20fish_target_cols%2C%0A%20%20%20%20%20%20%20%20marine_target_cols%2C%0A%20%20%20%20%20%20%20%20modeling_cols%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Feature%20Importance%20Analysis%0A%0A%20%20%20%20Understanding%20which%20acoustic%20indices%20and%20environmental%20variables%20are%20most%20important%20for%20detecting%20community%20activity.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20X_fish_scaled%2C%0A%20%20%20%20X_marine_scaled%2C%0A%20%20%20%20all_model_results%2C%0A%20%20%20%20all_modeling_datasets%2C%0A%20%20%20%20fish_target_cols%2C%0A%20%20%20%20marine_target_cols%2C%0A%20%20%20%20modeling_cols%2C%0A%20%20%20%20mutual_info_classif%2C%0A%20%20%20%20np%2C%0A%20%20%20%20pd%2C%0A)%3A%0A%20%20%20%20%23%20Feature%20importance%20analysis%20for%20both%20community%20types%0A%20%20%20%20print(%22Analyzing%20feature%20importance%20for%20both%20community%20types...%22)%0A%20%20%20%20print(%22%3D%22*70)%0A%0A%20%20%20%20all_feature_importance_results%20%3D%20%7B%7D%0A%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%23%20FISH%20COMMUNITY%20FEATURE%20IMPORTANCE%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20print(%22%5CnFISH%20COMMUNITY%20FEATURE%20IMPORTANCE%22)%0A%20%20%20%20print(%22%3D%22*50)%0A%0A%20%20%20%20fish_feature_importance%20%3D%20%7B%7D%0A%0A%20%20%20%20if%20'fish'%20in%20all_model_results%20and%20X_fish_scaled%20is%20not%20None%3A%0A%20%20%20%20%20%20%20%20_df_fish_modeling%20%3D%20all_modeling_datasets%5B'fish'%5D%0A%0A%20%20%20%20%20%20%20%20for%20target_name%20in%20fish_target_cols%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20target_name%20not%20in%20all_model_results%5B'fish'%5D%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20_y_target%20%3D%20_df_fish_modeling%5Btarget_name%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Mutual%20information%20feature%20importance%0A%20%20%20%20%20%20%20%20%20%20%20%20mi_scores%20%3D%20mutual_info_classif(X_fish_scaled%2C%20_y_target%2C%20random_state%3D42)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Random%20Forest%20feature%20importance%20(if%20available)%0A%20%20%20%20%20%20%20%20%20%20%20%20rf_model%20%3D%20all_model_results%5B'fish'%5D%5Btarget_name%5D.get('Random%20Forest'%2C%20%7B%7D).get('model')%0A%20%20%20%20%20%20%20%20%20%20%20%20rf_importance%20%3D%20rf_model.feature_importances_%20if%20rf_model%20else%20np.zeros(len(modeling_cols))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Create%20feature%20importance%20dataframe%0A%20%20%20%20%20%20%20%20%20%20%20%20importance_df%20%3D%20pd.DataFrame(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'feature'%3A%20modeling_cols%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'mutual_info'%3A%20mi_scores%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'rf_importance'%3A%20rf_importance%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'community_type'%3A%20'fish'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'target'%3A%20target_name%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D).sort_values('mutual_info'%2C%20ascending%3DFalse)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20fish_feature_importance%5Btarget_name%5D%20%3D%20importance_df%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5CnTop%205%20features%20for%20FISH%20%7Btarget_name%7D%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(importance_df%5B%5B'feature'%2C%20'mutual_info'%2C%20'rf_importance'%5D%5D.head())%0A%0A%20%20%20%20%20%20%20%20all_feature_importance_results%5B'fish'%5D%20%3D%20fish_feature_importance%0A%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%23%20MARINE%20COMMUNITY%20FEATURE%20IMPORTANCE%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20marine_feature_importance%20%3D%20%7B%7D%0A%0A%20%20%20%20if%20'marine'%20in%20all_model_results%20and%20X_marine_scaled%20is%20not%20None%3A%0A%20%20%20%20%20%20%20%20print(%22%5CnMARINE%20COMMUNITY%20FEATURE%20IMPORTANCE%22)%0A%20%20%20%20%20%20%20%20print(%22%3D%22*50)%0A%0A%20%20%20%20%20%20%20%20_df_marine_modeling%20%3D%20all_modeling_datasets%5B'marine'%5D%0A%0A%20%20%20%20%20%20%20%20for%20_target_name%20in%20marine_target_cols%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20_target_name%20not%20in%20all_model_results%5B'marine'%5D%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20_y_target%20%3D%20_df_marine_modeling%5B_target_name%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Mutual%20information%20feature%20importance%0A%20%20%20%20%20%20%20%20%20%20%20%20mi_scores%20%3D%20mutual_info_classif(X_marine_scaled%2C%20_y_target%2C%20random_state%3D42)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Random%20Forest%20feature%20importance%20(if%20available)%0A%20%20%20%20%20%20%20%20%20%20%20%20rf_model%20%3D%20all_model_results%5B'marine'%5D%5B_target_name%5D.get('Random%20Forest'%2C%20%7B%7D).get('model')%0A%20%20%20%20%20%20%20%20%20%20%20%20rf_importance%20%3D%20rf_model.feature_importances_%20if%20rf_model%20else%20np.zeros(len(modeling_cols))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Create%20feature%20importance%20dataframe%0A%20%20%20%20%20%20%20%20%20%20%20%20importance_df%20%3D%20pd.DataFrame(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'feature'%3A%20modeling_cols%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'mutual_info'%3A%20mi_scores%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'rf_importance'%3A%20rf_importance%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'community_type'%3A%20'marine'%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'target'%3A%20_target_name%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D).sort_values('mutual_info'%2C%20ascending%3DFalse)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_feature_importance%5B_target_name%5D%20%3D%20importance_df%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5CnTop%205%20features%20for%20MARINE%20%7B_target_name%7D%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(importance_df%5B%5B'feature'%2C%20'mutual_info'%2C%20'rf_importance'%5D%5D.head())%0A%0A%20%20%20%20%20%20%20%20all_feature_importance_results%5B'marine'%5D%20%3D%20marine_feature_importance%0A%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print(%22%5CnMarine%20community%20feature%20importance%20not%20available%20-%20marine%20data%20not%20loaded%22)%0A%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%23%20COMPARATIVE%20FEATURE%20IMPORTANCE%20SUMMARY%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*70)%0A%20%20%20%20print(%22COMPARATIVE%20FEATURE%20IMPORTANCE%20SUMMARY%22)%0A%20%20%20%20print(%22%3D%22*70)%0A%0A%20%20%20%20%23%20Find%20common%20high-importance%20features%20across%20both%20communities%0A%20%20%20%20if%20'fish'%20in%20all_feature_importance_results%20and%20'marine'%20in%20all_feature_importance_results%3A%0A%20%20%20%20%20%20%20%20print(%22%5CnComparing%20feature%20importance%20between%20fish-only%20and%20marine%20communities...%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Get%20top%20features%20from%20comparable%20targets%0A%20%20%20%20%20%20%20%20_fish_high_activity%20%3D%20fish_feature_importance.get('high_activity_75th')%0A%20%20%20%20%20%20%20%20_marine_high_activity%20%3D%20marine_feature_importance.get('high_marine_activity_75th')%0A%0A%20%20%20%20%20%20%20%20if%20_fish_high_activity%20is%20not%20None%20and%20_marine_high_activity%20is%20not%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20fish_top_5%20%3D%20set(_fish_high_activity.head(5)%5B'feature'%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_top_5%20%3D%20set(_marine_high_activity.head(5)%5B'feature'%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20common_features%20%3D%20fish_top_5.intersection(marine_top_5)%0A%20%20%20%20%20%20%20%20%20%20%20%20fish_unique%20%3D%20fish_top_5%20-%20marine_top_5%0A%20%20%20%20%20%20%20%20%20%20%20%20_marine_unique%20%3D%20marine_top_5%20-%20fish_top_5%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5CnFeature%20importance%20comparison%20(high%20activity%20targets)%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Common%20top-5%20features%3A%20%7Blist(common_features)%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Fish-only%20top-5%20unique%3A%20%7Blist(fish_unique)%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Marine%20top-5%20unique%3A%20%7Blist(_marine_unique)%7D%22)%0A%20%20%20%20return%20(all_feature_importance_results%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Comparative%20Model%20Performance%20Analysis%0A%0A%20%20%20%20Comparing%20fish-only%20vs.%20marine%20community%20model%20performance%20to%20understand%20the%20value%20of%20including%20dolphins%20in%20biological%20screening.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(all_model_results%2C%20pd)%3A%0A%20%20%20%20%23%20Comparative%20model%20performance%20analysis%0A%20%20%20%20print(%22COMPARATIVE%20MODEL%20PERFORMANCE%20ANALYSIS%22)%0A%20%20%20%20print(%22%3D%22*60)%0A%0A%20%20%20%20performance_results%20%3D%20%5B%5D%0A%0A%20%20%20%20%23%20Collect%20all%20performance%20metrics%0A%20%20%20%20for%20community_type%2C%20community_results%20in%20all_model_results.items()%3A%0A%20%20%20%20%20%20%20%20for%20_target_name_perf%2C%20_target_results%20in%20community_results.items()%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20_model_name%2C%20_results%20in%20_target_results.items()%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20performance_results.append(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'community_type'%3A%20community_type%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'target'%3A%20_target_name_perf%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'model'%3A%20_model_name%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'accuracy'%3A%20_results%5B'accuracy'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'precision'%3A%20_results%5B'precision'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'recall'%3A%20_results%5B'recall'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'f1'%3A%20_results%5B'f1'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'kappa'%3A%20_results%5B'kappa'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'cv_f1_mean'%3A%20_results%5B'cv_f1_mean'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'cv_f1_std'%3A%20_results%5B'cv_f1_std'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%0A%20%20%20%20%23%20Convert%20to%20DataFrame%20for%20easier%20analysis%0A%20%20%20%20performance_df%20%3D%20pd.DataFrame(performance_results)%0A%0A%20%20%20%20if%20len(performance_df)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20print(f%22%5CnPerformance%20summary%20across%20%7Blen(performance_df)%7D%20model%20runs%3A%22)%0A%20%20%20%20%20%20%20%20print(performance_df.groupby(%5B'community_type'%2C%20'model'%5D).agg(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'f1'%3A%20%5B'mean'%2C%20'std'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'accuracy'%3A%20%5B'mean'%2C%20'std'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'precision'%3A%20%5B'mean'%2C%20'std'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'recall'%3A%20%5B'mean'%2C%20'std'%5D%0A%20%20%20%20%20%20%20%20%7D).round(3))%0A%0A%20%20%20%20%20%20%20%20%23%20Compare%20fish%20vs%20marine%20performance%20if%20both%20available%0A%20%20%20%20%20%20%20%20if%20'fish'%20in%20all_model_results%20and%20'marine'%20in%20all_model_results%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*50)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(%22FISH%20vs%20MARINE%20COMMUNITY%20PERFORMANCE%20COMPARISON%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(%22%3D%22*50)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Compare%20equivalent%20targets%20(high%20activity%2075th%20percentile)%0A%20%20%20%20%20%20%20%20%20%20%20%20fish_high_activity%20%3D%20performance_df%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(performance_df%5B'community_type'%5D%20%3D%3D%20'fish')%20%26%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(performance_df%5B'target'%5D%20%3D%3D%20'high_activity_75th')%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_high_activity%20%3D%20performance_df%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(performance_df%5B'community_type'%5D%20%3D%3D%20'marine')%20%26%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(performance_df%5B'target'%5D%20%3D%3D%20'high_marine_activity_75th')%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20len(fish_high_activity)%20%3E%200%20and%20len(marine_high_activity)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(%22%5CnHigh%20Activity%20Detection%20(75th%20percentile%20threshold)%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(%22%5CnFish-only%20community%20performance%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(fish_high_activity%5B%5B'model'%2C%20'f1'%2C%20'precision'%2C%20'recall'%5D%5D.round(3))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(%22%5CnMarine%20community%20(fish%20%2B%20dolphin)%20performance%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(marine_high_activity%5B%5B'model'%2C%20'f1'%2C%20'precision'%2C%20'recall'%5D%5D.round(3))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Calculate%20improvement%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fish_mean_f1%20%3D%20fish_high_activity%5B'f1'%5D.mean()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20marine_mean_f1%20%3D%20marine_high_activity%5B'f1'%5D.mean()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20improvement%20%3D%20((marine_mean_f1%20-%20fish_mean_f1)%20%2F%20fish_mean_f1)%20*%20100%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5CnOverall%20F1%20Score%20Comparison%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Fish-only%20community%3A%20%7Bfish_mean_f1%3A.3f%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Marine%20community%3A%20%7Bmarine_mean_f1%3A.3f%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Improvement%20with%20dolphins%3A%20%7Bimprovement%3A%2B.1f%7D%25%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Dolphin-specific%20analysis%0A%20%20%20%20%20%20%20%20%20%20%20%20dolphin_results%20%3D%20performance_df%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(performance_df%5B'community_type'%5D%20%3D%3D%20'marine')%20%26%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(performance_df%5B'target'%5D%20%3D%3D%20'dolphin_present')%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20len(dolphin_results)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(%22%5Cn%22%20%2B%20%22-%22*40)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(%22DOLPHIN%20PRESENCE%20DETECTION%20PERFORMANCE%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(%22-%22*40)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(dolphin_results%5B%5B'model'%2C%20'f1'%2C%20'precision'%2C%20'recall'%5D%5D.round(3))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20best_dolphin_model%20%3D%20dolphin_results.loc%5Bdolphin_results%5B'f1'%5D.idxmax()%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5CnBest%20model%20for%20dolphin%20detection%3A%20%7Bbest_dolphin_model%5B'model'%5D%7D%20(F1%3D%7Bbest_dolphin_model%5B'f1'%5D%3A.3f%7D)%22)%0A%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print(%22No%20performance%20results%20available%20for%20comparison%22)%0A%20%20%20%20return%20(performance_df%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Temporal%20Pattern%20Concordance%20Analysis%0A%0A%20%20%20%20Comparing%20how%20well%20acoustic%20indices%20capture%20the%20same%20temporal%20patterns%20(diel%20and%20seasonal)%20as%20manual%20detections%20for%20both%20fish-only%20and%20marine%20communities.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(df_community%2C%20df_marine%2C%20modeling_cols%2C%20pd%2C%20spearmanr)%3A%0A%20%20%20%20%23%20Temporal%20pattern%20concordance%20analysis%0A%20%20%20%20print(%22TEMPORAL%20PATTERN%20CONCORDANCE%20ANALYSIS%22)%0A%20%20%20%20print(%22%3D%22*60)%0A%0A%20%20%20%20%23%20Get%20top%2010%20acoustic%20indices%20for%20manageable%20analysis%0A%20%20%20%20index_cols_subset%20%3D%20%5Bcol%20for%20col%20in%20modeling_cols%20if%20col%20not%20in%20%5B'Water%20temp%20(%C2%B0C)'%2C%20'Water%20depth%20(m)'%2C%20'hour'%2C%20'month'%5D%5D%5B%3A10%5D%0A%0A%20%20%20%20all_concordance_results%20%3D%20%7B%7D%0A%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%23%20FISH%20COMMUNITY%20TEMPORAL%20PATTERNS%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20print(%22%5CnFISH%20COMMUNITY%20TEMPORAL%20PATTERNS%22)%0A%20%20%20%20print(%22%3D%22*40)%0A%0A%20%20%20%20%23%201.%20Fish%20Diel%20Pattern%20Analysis%0A%20%20%20%20fish_diel_patterns%20%3D%20df_community.groupby('hour').agg(%7B%0A%20%20%20%20%20%20%20%20'total_fish_activity'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20'num_active_species'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20**%7Bidx%3A%20'mean'%20for%20idx%20in%20index_cols_subset%7D%0A%20%20%20%20%7D).reset_index()%0A%0A%20%20%20%20%23%202.%20Fish%20Seasonal%20Pattern%20Analysis%20%20%0A%20%20%20%20fish_seasonal_patterns%20%3D%20df_community.groupby('month').agg(%7B%0A%20%20%20%20%20%20%20%20'total_fish_activity'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20'num_active_species'%3A%20'mean'%2C%20%0A%20%20%20%20%20%20%20%20**%7Bidx%3A%20'mean'%20for%20idx%20in%20index_cols_subset%7D%0A%20%20%20%20%7D).reset_index()%0A%0A%20%20%20%20%23%20Calculate%20fish%20correlations%0A%20%20%20%20fish_diel_correlations%20%3D%20%7B%7D%0A%20%20%20%20fish_seasonal_correlations%20%3D%20%7B%7D%0A%0A%20%20%20%20for%20idx%20in%20index_cols_subset%3A%0A%20%20%20%20%20%20%20%20%23%20Diel%20correlations%0A%20%20%20%20%20%20%20%20diel_corr%2C%20diel_p%20%3D%20spearmanr(fish_diel_patterns%5B'total_fish_activity'%5D%2C%20fish_diel_patterns%5Bidx%5D)%0A%20%20%20%20%20%20%20%20fish_diel_correlations%5Bidx%5D%20%3D%20%7B'correlation'%3A%20diel_corr%2C%20'p_value'%3A%20diel_p%7D%0A%0A%20%20%20%20%20%20%20%20%23%20Seasonal%20correlations%0A%20%20%20%20%20%20%20%20seasonal_corr%2C%20seasonal_p%20%3D%20spearmanr(fish_seasonal_patterns%5B'total_fish_activity'%5D%2C%20fish_seasonal_patterns%5Bidx%5D)%0A%20%20%20%20%20%20%20%20fish_seasonal_correlations%5Bidx%5D%20%3D%20%7B'correlation'%3A%20seasonal_corr%2C%20'p_value'%3A%20seasonal_p%7D%0A%0A%20%20%20%20%23%20Convert%20to%20dataframes%0A%20%20%20%20fish_diel_corr_df%20%3D%20pd.DataFrame(fish_diel_correlations).T.sort_values('correlation'%2C%20key%3Dabs%2C%20ascending%3DFalse)%0A%20%20%20%20fish_seasonal_corr_df%20%3D%20pd.DataFrame(fish_seasonal_correlations).T.sort_values('correlation'%2C%20key%3Dabs%2C%20ascending%3DFalse)%0A%0A%20%20%20%20print(%22%5CnTop%205%20indices%20for%20FISH%20diel%20pattern%20concordance%3A%22)%0A%20%20%20%20print(fish_diel_corr_df.head().round(3))%0A%0A%20%20%20%20print(%22%5CnTop%205%20indices%20for%20FISH%20seasonal%20pattern%20concordance%3A%22)%0A%20%20%20%20print(fish_seasonal_corr_df.head().round(3))%0A%0A%20%20%20%20all_concordance_results%5B'fish'%5D%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'diel_patterns'%3A%20fish_diel_patterns%2C%0A%20%20%20%20%20%20%20%20'seasonal_patterns'%3A%20fish_seasonal_patterns%2C%0A%20%20%20%20%20%20%20%20'diel_correlations'%3A%20fish_diel_corr_df%2C%0A%20%20%20%20%20%20%20%20'seasonal_correlations'%3A%20fish_seasonal_corr_df%0A%20%20%20%20%7D%0A%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%23%20MARINE%20COMMUNITY%20TEMPORAL%20PATTERNS%20(if%20available)%0A%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20if%20df_marine%20is%20not%20None%3A%0A%20%20%20%20%20%20%20%20print(%22%5CnMARINE%20COMMUNITY%20TEMPORAL%20PATTERNS%22)%0A%20%20%20%20%20%20%20%20print(%22%3D%22*40)%0A%0A%20%20%20%20%20%20%20%20%23%201.%20Marine%20Diel%20Pattern%20Analysis%0A%20%20%20%20%20%20%20%20marine_diel_patterns%20%3D%20df_marine.groupby('hour').agg(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'total_marine_activity'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'num_active_marine_species'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'dolphin_activity'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20**%7Bidx%3A%20'mean'%20for%20idx%20in%20index_cols_subset%7D%0A%20%20%20%20%20%20%20%20%7D).reset_index()%0A%0A%20%20%20%20%20%20%20%20%23%202.%20Marine%20Seasonal%20Pattern%20Analysis%0A%20%20%20%20%20%20%20%20marine_seasonal_patterns%20%3D%20df_marine.groupby('month').agg(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'total_marine_activity'%3A%20'mean'%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20'num_active_marine_species'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'dolphin_activity'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20**%7Bidx%3A%20'mean'%20for%20idx%20in%20index_cols_subset%7D%0A%20%20%20%20%20%20%20%20%7D).reset_index()%0A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20marine%20correlations%0A%20%20%20%20%20%20%20%20marine_diel_correlations%20%3D%20%7B%7D%0A%20%20%20%20%20%20%20%20marine_seasonal_correlations%20%3D%20%7B%7D%0A%0A%20%20%20%20%20%20%20%20for%20idx%20in%20index_cols_subset%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Diel%20correlations%0A%20%20%20%20%20%20%20%20%20%20%20%20diel_corr%2C%20diel_p%20%3D%20spearmanr(marine_diel_patterns%5B'total_marine_activity'%5D%2C%20marine_diel_patterns%5Bidx%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_diel_correlations%5Bidx%5D%20%3D%20%7B'correlation'%3A%20diel_corr%2C%20'p_value'%3A%20diel_p%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Seasonal%20correlations%0A%20%20%20%20%20%20%20%20%20%20%20%20seasonal_corr%2C%20seasonal_p%20%3D%20spearmanr(marine_seasonal_patterns%5B'total_marine_activity'%5D%2C%20marine_seasonal_patterns%5Bidx%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_seasonal_correlations%5Bidx%5D%20%3D%20%7B'correlation'%3A%20seasonal_corr%2C%20'p_value'%3A%20seasonal_p%7D%0A%0A%20%20%20%20%20%20%20%20%23%20Convert%20to%20dataframes%0A%20%20%20%20%20%20%20%20marine_diel_corr_df%20%3D%20pd.DataFrame(marine_diel_correlations).T.sort_values('correlation'%2C%20key%3Dabs%2C%20ascending%3DFalse)%0A%20%20%20%20%20%20%20%20marine_seasonal_corr_df%20%3D%20pd.DataFrame(marine_seasonal_correlations).T.sort_values('correlation'%2C%20key%3Dabs%2C%20ascending%3DFalse)%0A%0A%20%20%20%20%20%20%20%20print(%22%5CnTop%205%20indices%20for%20MARINE%20diel%20pattern%20concordance%3A%22)%0A%20%20%20%20%20%20%20%20print(marine_diel_corr_df.head().round(3))%0A%0A%20%20%20%20%20%20%20%20print(%22%5CnTop%205%20indices%20for%20MARINE%20seasonal%20pattern%20concordance%3A%22)%0A%20%20%20%20%20%20%20%20print(marine_seasonal_corr_df.head().round(3))%0A%0A%20%20%20%20%20%20%20%20all_concordance_results%5B'marine'%5D%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'diel_patterns'%3A%20marine_diel_patterns%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'seasonal_patterns'%3A%20marine_seasonal_patterns%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'diel_correlations'%3A%20marine_diel_corr_df%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'seasonal_correlations'%3A%20marine_seasonal_corr_df%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%20%20%20%20%20%20%20%20%23%20COMPARATIVE%20CONCORDANCE%20ANALYSIS%0A%20%20%20%20%20%20%20%20%23%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0A%20%20%20%20%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*60)%0A%20%20%20%20%20%20%20%20print(%22FISH%20vs%20MARINE%20TEMPORAL%20CONCORDANCE%20COMPARISON%22)%0A%20%20%20%20%20%20%20%20print(%22%3D%22*60)%0A%0A%20%20%20%20%20%20%20%20%23%20Compare%20which%20indices%20are%20most%20consistent%20between%20fish%20and%20marine%20patterns%0A%20%20%20%20%20%20%20%20common_diel_indices%20%3D%20set(fish_diel_corr_df.head(5).index).intersection(set(marine_diel_corr_df.head(5).index))%0A%20%20%20%20%20%20%20%20common_seasonal_indices%20%3D%20set(fish_seasonal_corr_df.head(5).index).intersection(set(marine_seasonal_corr_df.head(5).index))%0A%0A%20%20%20%20%20%20%20%20print(f%22%5CnCommon%20top-5%20diel%20pattern%20indices%3A%20%7Blist(common_diel_indices)%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22Common%20top-5%20seasonal%20pattern%20indices%3A%20%7Blist(common_seasonal_indices)%7D%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20concordance%20improvement%20with%20marine%20data%0A%20%20%20%20%20%20%20%20fish_diel_mean_concordance%20%3D%20abs(fish_diel_corr_df.head(5)%5B'correlation'%5D).mean()%0A%20%20%20%20%20%20%20%20marine_diel_mean_concordance%20%3D%20abs(marine_diel_corr_df.head(5)%5B'correlation'%5D).mean()%0A%0A%20%20%20%20%20%20%20%20diel_improvement%20%3D%20((marine_diel_mean_concordance%20-%20fish_diel_mean_concordance)%20%2F%20fish_diel_mean_concordance)%20*%20100%0A%0A%20%20%20%20%20%20%20%20print(f%22%5CnDiel%20pattern%20concordance%20comparison%3A%22)%0A%20%20%20%20%20%20%20%20print(f%22Fish-only%20mean%20%7Ccorrelation%7C%3A%20%7Bfish_diel_mean_concordance%3A.3f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22Marine%20mean%20%7Ccorrelation%7C%3A%20%7Bmarine_diel_mean_concordance%3A.3f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22Improvement%20with%20dolphins%3A%20%7Bdiel_improvement%3A%2B.1f%7D%25%22)%0A%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print(%22%5CnMarine%20community%20temporal%20analysis%20not%20available%20-%20marine%20data%20not%20loaded%22)%0A%20%20%20%20return%20(all_concordance_results%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Final%20Analysis%20Summary%20and%20Recommendations%0A%0A%20%20%20%20Synthesizing%20findings%20from%20the%20comparative%20fish-only%20vs.%20marine%20community%20analysis%20to%20provide%20actionable%20insights%20for%20biological%20screening%20and%20monitoring.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20all_concordance_results%2C%0A%20%20%20%20all_feature_importance_results%2C%0A%20%20%20%20all_model_results%2C%0A%20%20%20%20performance_df%2C%0A)%3A%0A%20%20%20%20%23%20Final%20analysis%20summary%20and%20recommendations%0A%20%20%20%20print(%22FINAL%20ANALYSIS%20SUMMARY%20AND%20RECOMMENDATIONS%22)%0A%20%20%20%20print(%22%3D%22*80)%0A%0A%20%20%20%20recommendations%20%3D%20%5B%5D%0A%0A%20%20%20%20%23%201.%20Model%20Performance%20Assessment%0A%20%20%20%20if%20len(performance_df)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20print(%22%5Cn1.%20MODEL%20PERFORMANCE%20ASSESSMENT%22)%0A%20%20%20%20%20%20%20%20print(%22%3D%22*40)%0A%0A%20%20%20%20%20%20%20%20%23%20Overall%20best%20performers%0A%20%20%20%20%20%20%20%20best_models%20%3D%20performance_df.loc%5Bperformance_df.groupby(%5B'community_type'%5D)%5B'f1'%5D.idxmax()%5D%0A%0A%20%20%20%20%20%20%20%20for%20_%2C%20row%20in%20best_models.iterrows()%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Best%20%7Brow%5B'community_type'%5D%7D%20model%3A%20%7Brow%5B'model'%5D%7D%20for%20%7Brow%5B'target'%5D%7D%20(F1%3D%7Brow%5B'f1'%5D%3A.3f%7D)%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Marine%20vs%20Fish%20comparison%0A%20%20%20%20%20%20%20%20if%20'fish'%20in%20all_model_results%20and%20'marine'%20in%20all_model_results%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20fish_results%20%3D%20performance_df%5Bperformance_df%5B'community_type'%5D%20%3D%3D%20'fish'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_results%20%3D%20performance_df%5Bperformance_df%5B'community_type'%5D%20%3D%3D%20'marine'%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20fish_mean_f1%20%3D%20fish_results%5B'f1'%5D.mean()%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_mean_f1%20%3D%20marine_results%5B'f1'%5D.mean()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20marine_mean_f1%20%3E%20fish_mean_f1%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20improvement%20%3D%20((marine_mean_f1%20-%20fish_mean_f1)%20%2F%20fish_mean_f1)%20*%20100%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recommendations.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%E2%9C%85%20Marine%20community%20models%20show%20%7Bimprovement%3A.1f%7D%25%20average%20improvement%20over%20fish-only%20models%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recommendations.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Recommendation%3A%20Include%20dolphin%20data%20in%20biological%20screening%20models%20for%20enhanced%20performance%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20decline%20%3D%20((fish_mean_f1%20-%20marine_mean_f1)%20%2F%20fish_mean_f1)%20*%20100%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recommendations.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%E2%9A%A0%EF%B8%8F%20Marine%20community%20models%20show%20%7Bdecline%3A.1f%7D%25%20average%20decline%20vs%20fish-only%20models%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recommendations.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Recommendation%3A%20Evaluate%20if%20dolphin%20integration%20method%20needs%20refinement%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%23%202.%20Feature%20Importance%20Insights%0A%20%20%20%20print(%22%5Cn2.%20FEATURE%20IMPORTANCE%20INSIGHTS%22)%0A%20%20%20%20print(%22%3D%22*40)%0A%0A%20%20%20%20if%20'fish'%20in%20all_feature_importance_results%20and%20'marine'%20in%20all_feature_importance_results%3A%0A%20%20%20%20%20%20%20%20%23%20Find%20most%20stable%20features%20across%20both%20community%20types%0A%20%20%20%20%20%20%20%20fish_features%20%3D%20all_feature_importance_results%5B'fish'%5D%0A%20%20%20%20%20%20%20%20marine_features%20%3D%20all_feature_importance_results%5B'marine'%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Get%20high%20activity%20features%20as%20representative%0A%20%20%20%20%20%20%20%20if%20'high_activity_75th'%20in%20fish_features%20and%20'high_marine_activity_75th'%20in%20marine_features%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20fish_top_features%20%3D%20set(fish_features%5B'high_activity_75th'%5D.head(5)%5B'feature'%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_top_features%20%3D%20set(marine_features%5B'high_marine_activity_75th'%5D.head(5)%5B'feature'%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20stable_features%20%3D%20fish_top_features.intersection(marine_top_features)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20len(stable_features)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Most%20stable%20acoustic%20indices%20across%20both%20communities%3A%20%7Blist(stable_features)%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recommendations.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22Recommendation%3A%20Prioritize%20these%20%7Blen(stable_features)%7D%20acoustic%20indices%20for%20robust%20biological%20screening%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20marine_unique%20%3D%20marine_top_features%20-%20fish_top_features%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20len(marine_unique)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Indices%20uniquely%20important%20for%20marine%20community%3A%20%7Blist(marine_unique)%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recommendations.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Recommendation%3A%20Consider%20marine-specific%20indices%20when%20dolphin%20activity%20is%20suspected%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%23%203.%20Temporal%20Pattern%20Insights%0A%20%20%20%20print(%22%5Cn3.%20TEMPORAL%20PATTERN%20INSIGHTS%22)%0A%20%20%20%20print(%22%3D%22*40)%0A%0A%20%20%20%20if%20'fish'%20in%20all_concordance_results%20and%20'marine'%20in%20all_concordance_results%3A%0A%20%20%20%20%20%20%20%20fish_concordance%20%3D%20all_concordance_results%5B'fish'%5D%0A%20%20%20%20%20%20%20%20marine_concordance%20%3D%20all_concordance_results%5B'marine'%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Compare%20mean%20concordance%20strengths%0A%20%20%20%20%20%20%20%20fish_diel_strength%20%3D%20abs(fish_concordance%5B'diel_correlations'%5D.head(3)%5B'correlation'%5D).mean()%0A%20%20%20%20%20%20%20%20marine_diel_strength%20%3D%20abs(marine_concordance%5B'diel_correlations'%5D.head(3)%5B'correlation'%5D).mean()%0A%0A%20%20%20%20%20%20%20%20print(f%22Fish%20community%20diel%20pattern%20strength%3A%20%7Bfish_diel_strength%3A.3f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22Marine%20community%20diel%20pattern%20strength%3A%20%7Bmarine_diel_strength%3A.3f%7D%22)%0A%0A%20%20%20%20%20%20%20%20if%20marine_diel_strength%20%3E%20fish_diel_strength%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20recommendations.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%E2%9C%85%20Marine%20community%20shows%20stronger%20temporal%20pattern%20concordance%20-%20dolphins%20enhance%20signal%20detectability%22%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%20Get%20best%20temporal%20indices%0A%20%20%20%20%20%20%20%20best_diel_index%20%3D%20marine_concordance%5B'diel_correlations'%5D.index%5B0%5D%0A%20%20%20%20%20%20%20%20best_seasonal_index%20%3D%20marine_concordance%5B'seasonal_correlations'%5D.index%5B0%5D%0A%0A%20%20%20%20%20%20%20%20recommendations.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20f%22Recommendation%3A%20Use%20%7Bbest_diel_index%7D%20for%20diel%20pattern%20detection%20and%20%7Bbest_seasonal_index%7D%20for%20seasonal%20monitoring%22%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%23%204.%20Practical%20Implementation%20Recommendations%0A%20%20%20%20print(%22%5Cn4.%20PRACTICAL%20IMPLEMENTATION%20RECOMMENDATIONS%22)%0A%20%20%20%20print(%22%3D%22*50)%0A%0A%20%20%20%20if%20len(recommendations)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20for%20i%2C%20rec%20in%20enumerate(recommendations%2C%201)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%7Bi%7D.%20%7Brec%7D%22)%0A%0A%20%20%20%20%23%205.%20Next%20Steps%0A%20%20%20%20print(%22%5Cn5.%20RECOMMENDED%20NEXT%20STEPS%22)%0A%20%20%20%20print(%22%3D%22*30)%0A%0A%20%20%20%20next_steps%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%22Deploy%20best-performing%20models%20on%20new%20acoustic%20data%20for%20validation%22%2C%0A%20%20%20%20%20%20%20%20%22Implement%20real-time%20biological%20activity%20screening%20using%20identified%20key%20indices%22%2C%0A%20%20%20%20%20%20%20%20%22Develop%20automated%20alerting%20system%20for%20high%20marine%20activity%20periods%22%2C%0A%20%20%20%20%20%20%20%20%22Create%20dashboard%20visualization%20of%20temporal%20patterns%20for%20monitoring%20staff%22%2C%0A%20%20%20%20%20%20%20%20%22Plan%20targeted%20manual%20validation%20during%20predicted%20high-activity%20periods%22%2C%0A%20%20%20%20%5D%0A%0A%20%20%20%20if%20'marine'%20in%20all_model_results%3A%0A%20%20%20%20%20%20%20%20next_steps.append(%22Evaluate%20dolphin%20detection%20performance%20in%20different%20environmental%20conditions%22)%0A%20%20%20%20%20%20%20%20next_steps.append(%22Investigate%20seasonal%20patterns%20in%20marine%20community%20interactions%22)%0A%0A%20%20%20%20for%20i%2C%20step%20in%20enumerate(next_steps%2C%201)%3A%0A%20%20%20%20%20%20%20%20print(f%22%7Bi%7D.%20%7Bstep%7D%22)%0A%0A%20%20%20%20print(f%22%5Cn%22%20%2B%20%22%3D%22*80)%0A%20%20%20%20print(%22COMPARATIVE%20ANALYSIS%20COMPLETE%20%E2%9C%85%22)%0A%20%20%20%20print(f%22Marine%20community%20integration%20%7B'successful'%20if%20'marine'%20in%20all_model_results%20else%20'pending'%7D%22)%0A%20%20%20%20print(f%22Ready%20for%20biological%20screening%20deployment%22)%0A%20%20%20%20print(%22%3D%22*80)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Temporal%20Pattern%20Concordance%20Analysis%0A%0A%20%20%20%20Comparing%20how%20well%20acoustic%20indices%20capture%20the%20same%20temporal%20patterns%20(diel%20and%20seasonal)%20as%20manual%20detections.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(df_community%2C%20index_cols%2C%20pd%2C%20spearmanr)%3A%0A%20%20%20%20%23%20Temporal%20pattern%20concordance%20analysis%0A%20%20%20%20print(%22Analyzing%20temporal%20pattern%20concordance...%22)%0A%0A%20%20%20%20%23%201.%20Diel%20Pattern%20Analysis%0A%20%20%20%20diel_patterns%20%3D%20df_community.groupby('hour').agg(%7B%0A%20%20%20%20%20%20%20%20'total_fish_activity'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20'num_active_species'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20**%7Bidx%3A%20'mean'%20for%20idx%20in%20index_cols%5B%3A10%5D%7D%20%20%23%20Top%2010%20indices%20for%20manageable%20analysis%0A%20%20%20%20%7D).reset_index()%0A%0A%20%20%20%20%23%202.%20Seasonal%20Pattern%20Analysis%0A%20%20%20%20seasonal_patterns%20%3D%20df_community.groupby('month').agg(%7B%0A%20%20%20%20%20%20%20%20'total_fish_activity'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20'num_active_species'%3A%20'mean'%2C%0A%20%20%20%20%20%20%20%20**%7Bidx%3A%20'mean'%20for%20idx%20in%20index_cols%5B%3A10%5D%7D%0A%20%20%20%20%7D).reset_index()%0A%0A%20%20%20%20%23%203.%20Calculate%20correlations%20between%20fish%20activity%20and%20indices%20across%20time%0A%20%20%20%20diel_correlations%20%3D%20%7B%7D%0A%20%20%20%20seasonal_correlations%20%3D%20%7B%7D%0A%0A%20%20%20%20%23%20Diel%20correlations%0A%20%20%20%20for%20idx%20in%20index_cols%5B%3A10%5D%3A%0A%20%20%20%20%20%20%20%20diel_corr%2C%20diel_p%20%3D%20spearmanr(diel_patterns%5B'total_fish_activity'%5D%2C%20diel_patterns%5Bidx%5D)%0A%20%20%20%20%20%20%20%20diel_correlations%5Bidx%5D%20%3D%20%7B'correlation'%3A%20diel_corr%2C%20'p_value'%3A%20diel_p%7D%0A%0A%20%20%20%20%23%20Seasonal%20correlations%0A%20%20%20%20for%20idx%20in%20index_cols%5B%3A10%5D%3A%0A%20%20%20%20%20%20%20%20seasonal_corr%2C%20seasonal_p%20%3D%20spearmanr(seasonal_patterns%5B'total_fish_activity'%5D%2C%20seasonal_patterns%5Bidx%5D)%0A%20%20%20%20%20%20%20%20seasonal_correlations%5Bidx%5D%20%3D%20%7B'correlation'%3A%20seasonal_corr%2C%20'p_value'%3A%20seasonal_p%7D%0A%0A%20%20%20%20%23%20Convert%20to%20dataframes%0A%20%20%20%20diel_corr_df%20%3D%20pd.DataFrame(diel_correlations).T%0A%20%20%20%20seasonal_corr_df%20%3D%20pd.DataFrame(seasonal_correlations).T%0A%0A%20%20%20%20%23%20Sort%20by%20correlation%20strength%0A%20%20%20%20diel_corr_df%20%3D%20diel_corr_df.reindex(diel_corr_df%5B'correlation'%5D.abs().sort_values(ascending%3DFalse).index)%0A%20%20%20%20seasonal_corr_df%20%3D%20seasonal_corr_df.reindex(seasonal_corr_df%5B'correlation'%5D.abs().sort_values(ascending%3DFalse).index)%0A%0A%20%20%20%20print(%22Top%20diel%20pattern%20correlations%20(indices%20vs%20fish%20activity)%3A%22)%0A%20%20%20%20print(diel_corr_df.head())%0A%0A%20%20%20%20print(%22%5CnTop%20seasonal%20pattern%20correlations%20(indices%20vs%20fish%20activity)%3A%22)%0A%20%20%20%20print(seasonal_corr_df.head())%0A%0A%20%20%20%20%23%204.%20Cross-station%20pattern%20consistency%0A%20%20%20%20station_consistency%20%3D%20%7B%7D%0A%20%20%20%20for%20station%20in%20df_community%5B'station'%5D.unique()%3A%0A%20%20%20%20%20%20%20%20station_data%20%3D%20df_community%5Bdf_community%5B'station'%5D%20%3D%3D%20station%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20hourly%20patterns%20for%20this%20station%0A%20%20%20%20%20%20%20%20station_diel%20%3D%20station_data.groupby('hour')%5B'total_fish_activity'%5D.mean()%0A%20%20%20%20%20%20%20%20station_seasonal%20%3D%20station_data.groupby('month')%5B'total_fish_activity'%5D.mean()%0A%0A%20%20%20%20%20%20%20%20station_consistency%5Bstation%5D%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'diel_pattern'%3A%20station_diel%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'seasonal_pattern'%3A%20station_seasonal%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20print(f%22%5CnCross-station%20analysis%20complete%20for%20%7Blen(station_consistency)%7D%20stations%22)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20diel_corr_df%2C%0A%20%20%20%20%20%20%20%20diel_patterns%2C%0A%20%20%20%20%20%20%20%20seasonal_corr_df%2C%0A%20%20%20%20%20%20%20%20seasonal_patterns%2C%0A%20%20%20%20%20%20%20%20station_consistency%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Biological%20Screening%20Performance%20Evaluation%0A%0A%20%20%20%20Evaluating%20how%20effectively%20acoustic%20indices%20can%20screen%20for%20periods%20of%20biological%20interest.%0A%0A%20%20%20%20%23%23%20Screening%20Performance%20Metrics%20Explained%0A%0A%20%20%20%20Traditional%20machine%20learning%20focuses%20on%20accuracy%2C%20but%20biological%20screening%20requires%20different%20metrics%3A%0A%0A%20%20%20%20%23%23%23%20Key%20Metrics%20for%20Biological%20Applications%0A%0A%20%20%20%20**1.%20Detection%20Rate%20(Recall)**%0A%0A%20%20%20%20-%20**Definition**%3A%20Percentage%20of%20actual%20biological%20activity%20periods%20that%20the%20model%20correctly%20identifies%0A%20%20%20%20-%20**Why%20it%20matters**%3A%20Missing%20biological%20activity%20%3D%20lost%20scientific%20data%0A%20%20%20%20-%20**Target**%3A%20%3E80%25%20for%20practical%20screening%20applications%0A%0A%20%20%20%20**2.%20Screening%20Precision**%0A%0A%20%20%20%20-%20**Definition**%3A%20When%20the%20model%20flags%20a%20period%20as%20%22high%20activity%2C%22%20how%20often%20is%20it%20actually%20active%3F%0A%20%20%20%20-%20**Why%20it%20matters**%3A%20False%20alarms%20waste%20manual%20effort%0A%20%20%20%20-%20**Target**%3A%20%3E70%25%20to%20maintain%20efficiency%20gains%0A%0A%20%20%20%20**3.%20Effort%20Reduction**%0A%0A%20%20%20%20-%20**Definition**%3A%20Percentage%20of%20data%20that%20can%20be%20skipped%20without%20manual%20analysis%0A%20%20%20%20-%20**Why%20it%20matters**%3A%20This%20is%20the%20primary%20value%20proposition%20-%20saving%20time%20and%20money%0A%20%20%20%20-%20**Target**%3A%20%3E50%25%20reduction%20to%20justify%20deployment%20costs%0A%0A%20%20%20%20**4.%20F1%20Score**%0A%0A%20%20%20%20-%20**Definition**%3A%20Harmonic%20mean%20of%20precision%20and%20recall%20(balances%20both)%0A%20%20%20%20-%20**Why%20it%20matters**%3A%20Single%20metric%20for%20comparing%20models%0A%20%20%20%20-%20**Target**%3A%20%3E0.7%20for%20good%20performance%2C%20%3E0.8%20for%20excellent%0A%0A%20%20%20%20%23%23%20Real-World%20Translation%0A%0A%20%20%20%20A%20screening%20system%20with%2080%25%20detection%20rate%2C%2075%25%20precision%2C%20and%2060%25%20effort%20reduction%20means%3A%0A%0A%20%20%20%20-%20Analyze%20only%2040%25%20of%20your%20data%20manually%0A%20%20%20%20-%20Catch%2080%25%20of%20all%20biological%20activity%0A%20%20%20%20-%20When%20you%20do%20analyze%20a%20flagged%20period%2C%20it's%20biologically%20interesting%2075%25%20of%20the%20time%0A%20%20%20%20-%20Save%20~60%25%20of%20analysis%20time%20while%20maintaining%20most%20scientific%20value%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(model_results%2C%20np)%3A%0A%20%20%20%20%23%20Biological%20screening%20performance%20evaluation%0A%20%20%20%20print(%22Evaluating%20biological%20screening%20performance...%22)%0A%0A%20%20%20%20screening_results%20%3D%20%7B%7D%0A%0A%20%20%20%20for%20target_name_screen%2C%20target_models%20in%20model_results.items()%3A%0A%20%20%20%20%20%20%20%20print(f%22%5CnScreening%20evaluation%20for%3A%20%7Btarget_name_screen%7D%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Get%20best%20performing%20model%20(highest%20F1%20score)%0A%20%20%20%20%20%20%20%20best_model_name%20%3D%20max(target_models.keys()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key%3Dlambda%20x%3A%20target_models%5Bx%5D%5B'f1'%5D)%0A%20%20%20%20%20%20%20%20best_model_results%20%3D%20target_models%5Bbest_model_name%5D%0A%0A%20%20%20%20%20%20%20%20print(f%22Best%20model%3A%20%7Bbest_model_name%7D%20(F1%3A%20%7Bbest_model_results%5B'f1'%5D%3A.3f%7D)%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Screening%20efficiency%20analysis%0A%20%20%20%20%20%20%20%20y_true_screen%20%3D%20best_model_results%5B'y_test'%5D%0A%20%20%20%20%20%20%20%20y_pred_screen%20%3D%20best_model_results%5B'y_pred'%5D%0A%20%20%20%20%20%20%20%20y_prob_screen%20%3D%20best_model_results%5B'y_prob'%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20efficiency%20metrics%0A%20%20%20%20%20%20%20%20true_positives%20%3D%20np.sum((y_true_screen%20%3D%3D%201)%20%26%20(y_pred_screen%20%3D%3D%201))%0A%20%20%20%20%20%20%20%20false_positives%20%3D%20np.sum((y_true_screen%20%3D%3D%200)%20%26%20(y_pred_screen%20%3D%3D%201))%0A%20%20%20%20%20%20%20%20true_negatives%20%3D%20np.sum((y_true_screen%20%3D%3D%200)%20%26%20(y_pred_screen%20%3D%3D%200))%0A%20%20%20%20%20%20%20%20false_negatives%20%3D%20np.sum((y_true_screen%20%3D%3D%201)%20%26%20(y_pred_screen%20%3D%3D%200))%0A%0A%20%20%20%20%20%20%20%20%23%20Screening%20efficiency%3A%20how%20much%20effort%20could%20be%20saved%3F%0A%20%20%20%20%20%20%20%20total_periods%20%3D%20len(y_true_screen)%0A%20%20%20%20%20%20%20%20flagged_periods%20%3D%20np.sum(y_pred_screen%20%3D%3D%201)%0A%20%20%20%20%20%20%20%20actual_active_periods%20%3D%20np.sum(y_true_screen%20%3D%3D%201)%0A%0A%20%20%20%20%20%20%20%20%23%20If%20we%20only%20manually%20check%20flagged%20periods%2C%20what's%20the%20efficiency%3F%0A%20%20%20%20%20%20%20%20effort_reduction%20%3D%20(total_periods%20-%20flagged_periods)%20%2F%20total_periods%0A%20%20%20%20%20%20%20%20detection_rate%20%3D%20true_positives%20%2F%20actual_active_periods%20if%20actual_active_periods%20%3E%200%20else%200%0A%0A%20%20%20%20%20%20%20%20%23%20Precision%20in%20screening%20context%3A%20of%20flagged%20periods%2C%20how%20many%20are%20actually%20active%3F%0A%20%20%20%20%20%20%20%20screening_precision%20%3D%20true_positives%20%2F%20flagged_periods%20if%20flagged_periods%20%3E%200%20else%200%0A%0A%20%20%20%20%20%20%20%20screening_results%5Btarget_name_screen%5D%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'best_model'%3A%20best_model_name%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'f1_score'%3A%20best_model_results%5B'f1'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'precision'%3A%20best_model_results%5B'precision'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'recall'%3A%20best_model_results%5B'recall'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'effort_reduction'%3A%20effort_reduction%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'detection_rate'%3A%20detection_rate%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'screening_precision'%3A%20screening_precision%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'total_periods'%3A%20total_periods%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'flagged_periods'%3A%20flagged_periods%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'actual_active_periods'%3A%20actual_active_periods%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'true_positives'%3A%20true_positives%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'false_positives'%3A%20false_positives%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'false_negatives'%3A%20false_negatives%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20print(f%22%20%20Effort%20reduction%3A%20%7Beffort_reduction%3A.1%25%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20Detection%20rate%3A%20%7Bdetection_rate%3A.1%25%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20Screening%20precision%3A%20%7Bscreening_precision%3A.1%25%7D%22)%0A%0A%20%20%20%20%23%20Overall%20screening%20assessment%0A%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*60)%0A%20%20%20%20print(%22BIOLOGICAL%20SCREENING%20ASSESSMENT%20SUMMARY%22)%0A%20%20%20%20print(%22%3D%22*60)%0A%0A%20%20%20%20for%20target_name_summary%2C%20results%20in%20screening_results.items()%3A%0A%20%20%20%20%20%20%20%20print(f%22%5Cn%7Btarget_name_summary.upper()%7D%3A%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20Best%20Model%3A%20%7Bresults%5B'best_model'%5D%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20F1%20Score%3A%20%7Bresults%5B'f1_score'%5D%3A.3f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20Manual%20Effort%20Reduction%3A%20%7Bresults%5B'effort_reduction'%5D%3A.1%25%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20Biological%20Detection%20Rate%3A%20%7Bresults%5B'detection_rate'%5D%3A.1%25%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20Screening%20Precision%3A%20%7Bresults%5B'screening_precision'%5D%3A.1%25%7D%22)%0A%20%20%20%20return%20(screening_results%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Visualization%3A%20Community%20Patterns%20and%20Screening%20Performance%0A%0A%20%20%20%20Creating%20comprehensive%20visualizations%20to%20show%20community%20pattern%20detection%20and%20screening%20tool%20performance.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20diel_corr_df%2C%0A%20%20%20%20diel_patterns%2C%0A%20%20%20%20feature_importance_results%2C%0A%20%20%20%20np%2C%0A%20%20%20%20plot_dir%2C%0A%20%20%20%20plt%2C%0A%20%20%20%20screening_results%2C%0A%20%20%20%20seasonal_patterns%2C%0A%20%20%20%20station_consistency%2C%0A)%3A%0A%20%20%20%20%23%20Create%20comprehensive%20visualizations%0A%20%20%20%20print(%22Creating%20community%20pattern%20and%20screening%20visualizations...%22)%0A%0A%20%20%20%20%23%201.%20Diel%20Pattern%20Concordance%0A%20%20%20%20plt.figure(figsize%3D(12%2C%208))%0A%0A%20%20%20%20%23%20Main%20fish%20activity%20pattern%0A%20%20%20%20plt.subplot(2%2C%202%2C%201)%0A%20%20%20%20plt.plot(diel_patterns%5B'hour'%5D%2C%20diel_patterns%5B'total_fish_activity'%5D%2C%20'bo-'%2C%20linewidth%3D2%2C%20label%3D'Fish%20Activity')%0A%20%20%20%20plt.xlabel('Hour%20of%20Day')%0A%20%20%20%20plt.ylabel('Mean%20Total%20Fish%20Activity')%0A%20%20%20%20plt.title('Diel%20Pattern%3A%20Community%20Fish%20Activity')%0A%20%20%20%20plt.grid(True%2C%20alpha%3D0.3)%0A%20%20%20%20plt.xticks(range(0%2C%2024%2C%204))%0A%0A%20%20%20%20%23%20Top%20correlated%20index%0A%20%20%20%20plt.subplot(2%2C%202%2C%202)%0A%20%20%20%20if%20len(diel_corr_df)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20top_index%20%3D%20diel_corr_df.index%5B0%5D%0A%20%20%20%20%20%20%20%20plt.plot(diel_patterns%5B'hour'%5D%2C%20diel_patterns%5Btop_index%5D%2C%20'ro-'%2C%20linewidth%3D2%2C%20label%3Df'%7Btop_index%7D')%0A%20%20%20%20%20%20%20%20plt.xlabel('Hour%20of%20Day')%0A%20%20%20%20%20%20%20%20plt.ylabel(f'Mean%20%7Btop_index%7D')%0A%20%20%20%20%20%20%20%20plt.title(f'Diel%20Pattern%3A%20Best%20Index%20(%7Btop_index%7D)%5CnCorrelation%3A%20%7Bdiel_corr_df.iloc%5B0%5D%5B%22correlation%22%5D%3A.3f%7D')%0A%20%20%20%20%20%20%20%20plt.grid(True%2C%20alpha%3D0.3)%0A%20%20%20%20%20%20%20%20plt.xticks(range(0%2C%2024%2C%204))%0A%0A%20%20%20%20%23%20Seasonal%20patterns%0A%20%20%20%20plt.subplot(2%2C%202%2C%203)%0A%20%20%20%20plt.plot(seasonal_patterns%5B'month'%5D%2C%20seasonal_patterns%5B'total_fish_activity'%5D%2C%20'go-'%2C%20linewidth%3D2)%0A%20%20%20%20plt.xlabel('Month')%0A%20%20%20%20plt.ylabel('Mean%20Total%20Fish%20Activity')%0A%20%20%20%20plt.title('Seasonal%20Pattern%3A%20Community%20Fish%20Activity')%0A%20%20%20%20plt.grid(True%2C%20alpha%3D0.3)%0A%20%20%20%20plt.xticks(range(1%2C%2013))%0A%0A%20%20%20%20%23%20Cross-station%20comparison%0A%20%20%20%20plt.subplot(2%2C%202%2C%204)%0A%20%20%20%20for%20station_viz%2C%20patterns%20in%20station_consistency.items()%3A%0A%20%20%20%20%20%20%20%20plt.plot(patterns%5B'diel_pattern'%5D.index%2C%20patterns%5B'diel_pattern'%5D.values%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'o-'%2C%20alpha%3D0.7%2C%20label%3Df'Station%20%7Bstation_viz%7D')%0A%20%20%20%20plt.xlabel('Hour%20of%20Day')%0A%20%20%20%20plt.ylabel('Mean%20Fish%20Activity')%0A%20%20%20%20plt.title('Cross-Station%20Diel%20Patterns')%0A%20%20%20%20plt.legend()%0A%20%20%20%20plt.grid(True%2C%20alpha%3D0.3)%0A%20%20%20%20plt.xticks(range(0%2C%2024%2C%204))%0A%0A%20%20%20%20plt.tight_layout()%0A%20%20%20%20plt.savefig(plot_dir%20%2F%20'06_temporal_pattern_concordance.png'%2C%20dpi%3D150%2C%20bbox_inches%3D'tight')%0A%20%20%20%20plt.show()%0A%0A%20%20%20%20%23%202.%20Feature%20Importance%20Comparison%0A%20%20%20%20if%20len(feature_importance_results)%20%3E%200%3A%0A%20%20%20%20%20%20%20%20fig%2C%20axes%20%3D%20plt.subplots(2%2C%202%2C%20figsize%3D(14%2C%2010))%0A%20%20%20%20%20%20%20%20axes%20%3D%20axes.ravel()%0A%0A%20%20%20%20%20%20%20%20for%20i%2C%20(target_name_viz%2C%20importance_df_viz)%20in%20enumerate(feature_importance_results.items())%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20i%20%3E%3D%204%3A%20%20%23%20Max%204%20subplots%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20ax%20%3D%20axes%5Bi%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20top_features%20%3D%20importance_df_viz.head(8)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20y_pos%20%3D%20range(len(top_features))%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.barh(y_pos%2C%20top_features%5B'mutual_info'%5D%2C%20alpha%3D0.7%2C%20color%3D'steelblue')%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.set_yticks(y_pos)%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.set_yticklabels(top_features%5B'feature'%5D%2C%20fontsize%3D8)%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.set_xlabel('Mutual%20Information%20Score')%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.set_title(f'Feature%20Importance%3A%20%7Btarget_name_viz%7D')%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.grid(True%2C%20alpha%3D0.3%2C%20axis%3D'x')%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.invert_yaxis()%0A%0A%20%20%20%20%20%20%20%20plt.tight_layout()%0A%20%20%20%20%20%20%20%20plt.savefig(plot_dir%20%2F%20'06_feature_importance.png'%2C%20dpi%3D150%2C%20bbox_inches%3D'tight')%0A%20%20%20%20%20%20%20%20plt.show()%0A%0A%20%20%20%20%23%203.%20Screening%20Performance%20Summary%0A%20%20%20%20plt.figure(figsize%3D(12%2C%206))%0A%0A%20%20%20%20%23%20Performance%20metrics%0A%20%20%20%20plt.subplot(1%2C%202%2C%201)%0A%20%20%20%20metrics%20%3D%20%5B'f1_score'%2C%20'precision'%2C%20'recall'%5D%0A%20%20%20%20target_names%20%3D%20list(screening_results.keys())%0A%0A%20%20%20%20x_pos%20%3D%20np.arange(len(target_names))%0A%20%20%20%20width%20%3D%200.25%0A%0A%20%20%20%20for%20i%2C%20metric%20in%20enumerate(metrics)%3A%0A%20%20%20%20%20%20%20%20values%20%3D%20%5Bscreening_results%5Btarget%5D%5Bmetric%5D%20for%20target%20in%20target_names%5D%0A%20%20%20%20%20%20%20%20plt.bar(x_pos%20%2B%20i*width%2C%20values%2C%20width%2C%20alpha%3D0.7%2C%20label%3Dmetric.replace('_'%2C%20'%20').title())%0A%0A%20%20%20%20plt.xlabel('Target%20Classification')%0A%20%20%20%20plt.ylabel('Score')%0A%20%20%20%20plt.title('Model%20Performance%20by%20Target')%0A%20%20%20%20plt.xticks(x_pos%20%2B%20width%2C%20%5Bname.replace('_'%2C%20'%20').title()%20for%20name%20in%20target_names%5D%2C%20rotation%3D45%2C%20ha%3D'right')%0A%20%20%20%20plt.legend()%0A%20%20%20%20plt.grid(True%2C%20alpha%3D0.3%2C%20axis%3D'y')%0A%20%20%20%20plt.ylim(0%2C%201)%0A%0A%20%20%20%20%23%20Efficiency%20metrics%0A%20%20%20%20plt.subplot(1%2C%202%2C%202)%0A%20%20%20%20efficiency_metrics%20%3D%20%5B'effort_reduction'%2C%20'detection_rate'%2C%20'screening_precision'%5D%0A%0A%20%20%20%20for%20i%2C%20metric%20in%20enumerate(efficiency_metrics)%3A%0A%20%20%20%20%20%20%20%20values%20%3D%20%5Bscreening_results%5Btarget%5D%5Bmetric%5D%20for%20target%20in%20target_names%5D%0A%20%20%20%20%20%20%20%20plt.bar(x_pos%20%2B%20i*width%2C%20values%2C%20width%2C%20alpha%3D0.7%2C%20label%3Dmetric.replace('_'%2C%20'%20').title())%0A%0A%20%20%20%20plt.xlabel('Target%20Classification')%0A%20%20%20%20plt.ylabel('Rate')%0A%20%20%20%20plt.title('Screening%20Efficiency%20by%20Target')%0A%20%20%20%20plt.xticks(x_pos%20%2B%20width%2C%20%5Bname.replace('_'%2C%20'%20').title()%20for%20name%20in%20target_names%5D%2C%20rotation%3D45%2C%20ha%3D'right')%0A%20%20%20%20plt.legend()%0A%20%20%20%20plt.grid(True%2C%20alpha%3D0.3%2C%20axis%3D'y')%0A%20%20%20%20plt.ylim(0%2C%201)%0A%0A%20%20%20%20plt.tight_layout()%0A%20%20%20%20plt.savefig(plot_dir%20%2F%20'06_screening_performance.png'%2C%20dpi%3D150%2C%20bbox_inches%3D'tight')%0A%20%20%20%20plt.show()%0A%0A%20%20%20%20print(f%22Community%20pattern%20visualizations%20saved%20to%20%7Bplot_dir%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Results%20Summary%20and%20Interpretation%0A%0A%20%20%20%20Synthesizing%20findings%20on%20community%20pattern%20detection%20and%20biological%20screening%20effectiveness.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20Progress%20tracking%20cell%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(%0A%20%20%20%20DATA_ROOT%2C%0A%20%20%20%20df_community%2C%0A%20%20%20%20diel_corr_df%2C%0A%20%20%20%20feature_importance_results%2C%0A%20%20%20%20json%2C%0A%20%20%20%20model_results%2C%0A%20%20%20%20pickle%2C%0A%20%20%20%20screening_results%2C%0A%20%20%20%20seasonal_corr_df%2C%0A)%3A%0A%20%20%20%20%23%20Save%20all%20results%20and%20create%20comprehensive%20summary%0A%20%20%20%20print(%22Saving%20results%20and%20creating%20comprehensive%20summary...%22)%0A%0A%20%20%20%20%23%20Save%20processed%20data%0A%20%20%20%20df_community.to_parquet(DATA_ROOT%20%2F%20%22processed%2F06_community_activity_data.parquet%22)%0A%0A%20%20%20%20%23%20Save%20model%20results%0A%20%20%20%20with%20open(DATA_ROOT%20%2F%20%22processed%2F06_community_models.pkl%22%2C%20'wb')%20as%20f%3A%0A%20%20%20%20%20%20%20%20pickle.dump(model_results%2C%20f)%0A%0A%20%20%20%20%23%20Save%20feature%20importance%0A%20%20%20%20for%20target_name_save%2C%20importance_df_save%20in%20feature_importance_results.items()%3A%0A%20%20%20%20%20%20%20%20filename%20%3D%20f%2206_feature_importance_%7Btarget_name_save%7D.parquet%22%0A%20%20%20%20%20%20%20%20importance_df_save.to_parquet(DATA_ROOT%20%2F%20%22processed%22%20%2F%20filename)%0A%0A%20%20%20%20%23%20Save%20temporal%20concordance%20results%0A%20%20%20%20diel_corr_df.to_parquet(DATA_ROOT%20%2F%20%22processed%2F06_diel_correlations.parquet%22)%0A%20%20%20%20seasonal_corr_df.to_parquet(DATA_ROOT%20%2F%20%22processed%2F06_seasonal_correlations.parquet%22)%0A%0A%20%20%20%20%23%20Create%20comprehensive%20summary%0A%20%20%20%20summary_results%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'community_metrics'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'total_samples'%3A%20len(df_community)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'mean_total_activity'%3A%20float(df_community%5B'total_fish_activity'%5D.mean())%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'mean_active_species'%3A%20float(df_community%5B'num_active_species'%5D.mean())%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'any_activity_rate'%3A%20float(df_community%5B'any_activity'%5D.mean())%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'high_activity_75th_rate'%3A%20float(df_community%5B'high_activity_75th'%5D.mean())%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'high_activity_90th_rate'%3A%20float(df_community%5B'high_activity_90th'%5D.mean())%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20'model_performance'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20target%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'best_model'%3A%20results%5B'best_model'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'f1_score'%3A%20float(results%5B'f1_score'%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'precision'%3A%20float(results%5B'precision'%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'recall'%3A%20float(results%5B'recall'%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20target%2C%20results%20in%20screening_results.items()%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20'screening_efficiency'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20target%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'effort_reduction'%3A%20float(results%5B'effort_reduction'%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'detection_rate'%3A%20float(results%5B'detection_rate'%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'screening_precision'%3A%20float(results%5B'screening_precision'%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20target%2C%20results%20in%20screening_results.items()%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20'temporal_concordance'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'best_diel_correlation'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'index'%3A%20diel_corr_df.index%5B0%5D%20if%20len(diel_corr_df)%20%3E%200%20else%20None%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'correlation'%3A%20float(diel_corr_df.iloc%5B0%5D%5B'correlation'%5D)%20if%20len(diel_corr_df)%20%3E%200%20else%20None%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'best_seasonal_correlation'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'index'%3A%20seasonal_corr_df.index%5B0%5D%20if%20len(seasonal_corr_df)%20%3E%200%20else%20None%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'correlation'%3A%20float(seasonal_corr_df.iloc%5B0%5D%5B'correlation'%5D)%20if%20len(seasonal_corr_df)%20%3E%200%20else%20None%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20%23%20Save%20summary%0A%20%20%20%20with%20open(DATA_ROOT%20%2F%20%22processed%2F06_community_analysis_summary.json%22%2C%20'w')%20as%20f%3A%0A%20%20%20%20%20%20%20%20json.dump(summary_results%2C%20f%2C%20indent%3D2)%0A%0A%20%20%20%20print(%22%3D%22*70)%0A%20%20%20%20print(%22COMMUNITY%20PATTERN%20DETECTION%20AND%20BIOLOGICAL%20SCREENING%20SUMMARY%22)%0A%20%20%20%20print(%22%3D%22*70)%0A%0A%20%20%20%20print(f%22%5CnDATASET%20OVERVIEW%3A%22)%0A%20%20%20%20print(f%22%20%20-%20Total%20samples%20analyzed%3A%20%7Bsummary_results%5B'community_metrics'%5D%5B'total_samples'%5D%3A%2C%7D%22)%0A%20%20%20%20print(f%22%20%20-%20Mean%20total%20fish%20activity%3A%20%7Bsummary_results%5B'community_metrics'%5D%5B'mean_total_activity'%5D%3A.2f%7D%22)%0A%20%20%20%20print(f%22%20%20-%20Mean%20active%20species%20per%20period%3A%20%7Bsummary_results%5B'community_metrics'%5D%5B'mean_active_species'%5D%3A.2f%7D%22)%0A%20%20%20%20print(f%22%20%20-%20Periods%20with%20any%20activity%3A%20%7Bsummary_results%5B'community_metrics'%5D%5B'any_activity_rate'%5D%3A.1%25%7D%22)%0A%0A%20%20%20%20print(f%22%5CnMODEL%20PERFORMANCE%20(COMMUNITY%20ACTIVITY%20DETECTION)%3A%22)%0A%20%20%20%20for%20target%2C%20performance%20in%20summary_results%5B'model_performance'%5D.items()%3A%0A%20%20%20%20%20%20%20%20print(f%22%20%20%7Btarget.replace('_'%2C%20'%20').title()%7D%3A%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20%20%20-%20Best%20Model%3A%20%7Bperformance%5B'best_model'%5D%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20%20%20-%20F1%20Score%3A%20%7Bperformance%5B'f1_score'%5D%3A.3f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20%20%20-%20Precision%3A%20%7Bperformance%5B'precision'%5D%3A.3f%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20%20%20-%20Recall%3A%20%7Bperformance%5B'recall'%5D%3A.3f%7D%22)%0A%0A%20%20%20%20print(f%22%5CnBIOLOGICAL%20SCREENING%20EFFICIENCY%3A%22)%0A%20%20%20%20for%20target%2C%20efficiency%20in%20summary_results%5B'screening_efficiency'%5D.items()%3A%0A%20%20%20%20%20%20%20%20print(f%22%20%20%7Btarget.replace('_'%2C%20'%20').title()%7D%3A%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20%20%20-%20Manual%20Effort%20Reduction%3A%20%7Befficiency%5B'effort_reduction'%5D%3A.1%25%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20%20%20-%20Biological%20Detection%20Rate%3A%20%7Befficiency%5B'detection_rate'%5D%3A.1%25%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20%20%20-%20Screening%20Precision%3A%20%7Befficiency%5B'screening_precision'%5D%3A.1%25%7D%22)%0A%0A%20%20%20%20print(f%22%5CnTEMPORAL%20PATTERN%20CONCORDANCE%3A%22)%0A%20%20%20%20if%20summary_results%5B'temporal_concordance'%5D%5B'best_diel_correlation'%5D%5B'index'%5D%3A%0A%20%20%20%20%20%20%20%20print(f%22%20%20-%20Best%20Diel%20Pattern%20Match%3A%20%7Bsummary_results%5B'temporal_concordance'%5D%5B'best_diel_correlation'%5D%5B'index'%5D%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20%20%20Correlation%3A%20%7Bsummary_results%5B'temporal_concordance'%5D%5B'best_diel_correlation'%5D%5B'correlation'%5D%3A.3f%7D%22)%0A%20%20%20%20if%20summary_results%5B'temporal_concordance'%5D%5B'best_seasonal_correlation'%5D%5B'index'%5D%3A%0A%20%20%20%20%20%20%20%20print(f%22%20%20-%20Best%20Seasonal%20Pattern%20Match%3A%20%7Bsummary_results%5B'temporal_concordance'%5D%5B'best_seasonal_correlation'%5D%5B'index'%5D%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22%20%20%20%20Correlation%3A%20%7Bsummary_results%5B'temporal_concordance'%5D%5B'best_seasonal_correlation'%5D%5B'correlation'%5D%3A.3f%7D%22)%0A%0A%20%20%20%20print(%22%5Cn%22%20%2B%20%22%3D%22*70)%0A%20%20%20%20print(%22COMPREHENSIVE%20SCIENTIFIC%20INTERPRETATION%22)%0A%20%20%20%20print(%22%3D%22*70)%0A%0A%20%20%20%20%23%20Determine%20key%20findings%20based%20on%20results%0A%20%20%20%20best_screening_target%20%3D%20max(summary_results%5B'screening_efficiency'%5D.items()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key%3Dlambda%20x%3A%20x%5B1%5D%5B'detection_rate'%5D)%0A%0A%20%20%20%20best_f1_target%20%3D%20max(summary_results%5B'model_performance'%5D.items()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key%3Dlambda%20x%3A%20x%5B1%5D%5B'f1_score'%5D)%0A%0A%20%20%20%20print(f%22%22%22%0A%20%20%20%20%23%23%201.%20COMMUNITY%20ACTIVITY%20DETECTION%20PERFORMANCE%0A%0A%20%20%20%20**Primary%20Finding**%3A%20Within%20this%20study%20system%2C%20acoustic%20indices%20show%20promising%20ability%20to%20detect%20community-level%20biological%20activity%0A%0A%20%20%20%20**Best%20Overall%20Performance**%3A%20%7Bbest_f1_target%5B0%5D.replace('_'%2C%20'%20').title()%7D%0A%20%20%20%20-%20F1%20Score%3A%20%7Bbest_f1_target%5B1%5D%5B'f1_score'%5D%3A.3f%7D%20(Good%20performance%20-%20above%200.8%20indicates%20strong%20model%20performance)%0A%20%20%20%20-%20Precision%3A%20%7Bbest_f1_target%5B1%5D%5B'precision'%5D%3A.3f%7D%20(When%20model%20predicts%20activity%2C%20it's%20correct%20%7Bbest_f1_target%5B1%5D%5B'precision'%5D%3A.1%25%7D%20of%20the%20time)%0A%20%20%20%20-%20Recall%3A%20%7Bbest_f1_target%5B1%5D%5B'recall'%5D%3A.3f%7D%20(Detects%20%7Bbest_f1_target%5B1%5D%5B'recall'%5D%3A.1%25%7D%20of%20actual%20biological%20activity%20periods)%0A%0A%20%20%20%20**Biological%20Interpretation**%3A%20In%20this%20dataset%2C%20the%20model%20shows%20ability%20to%20distinguish%20between%20periods%20when%20fish%20are%0A%20%20%20%20calling%20vs%20when%20they%20are%20not.%20This%20suggests%20potential%20for%20acoustic%20monitoring%20applications%2C%20though%20validation%20across%0A%20%20%20%20different%20systems%20and%20environments%20is%20needed.%0A%0A%20%20%20%20%23%23%202.%20BIOLOGICAL%20SCREENING%20TOOL%20POTENTIAL%0A%0A%20%20%20%20**Primary%20Finding**%3A%20Results%20suggest%20indices%20may%20serve%20as%20screening%20tools%20for%20manual%20effort%20guidance%20in%20this%20study%20system%0A%0A%20%20%20%20**Best%20Screening%20Performance**%3A%20%7Bbest_screening_target%5B0%5D.replace('_'%2C%20'%20').title()%7D%0A%20%20%20%20-%20Detection%20Rate%3A%20%7Bbest_screening_target%5B1%5D%5B'detection_rate'%5D%3A.1%25%7D%20(Detects%20most%20biological%20activity%20in%20this%20dataset)%0A%20%20%20%20-%20Screening%20Precision%3A%20%7Bbest_screening_target%5B1%5D%5B'screening_precision'%5D%3A.1%25%7D%20(Relatively%20low%20false%20alarm%20rate)%0A%20%20%20%20-%20Effort%20Reduction%3A%20%7Bbest_screening_target%5B1%5D%5B'effort_reduction'%5D%3A.1%25%7D%20(Potential%20workload%20savings)%0A%0A%20%20%20%20**Potential%20Application**%3A%20Based%20on%20these%20results%2C%20a%20researcher%20might%3A%0A%20%20%20%201.%20Run%20acoustic%20indices%20on%20100%20hours%20of%20recordings%20from%20similar%20environments%0A%20%20%20%202.%20Model%20flags%20~%7B100%20-%20best_screening_target%5B1%5D%5B'effort_reduction'%5D*100%3A.0f%7D%20hours%20as%20%22high%20interest%22%0A%20%20%20%203.%20Manual%20analysis%20of%20only%20those%20%7B100%20-%20best_screening_target%5B1%5D%5B'effort_reduction'%5D*100%3A.0f%7D%20hours%20could%20potentially%20catch%20%7Bbest_screening_target%5B1%5D%5B'detection_rate'%5D%3A.0f%7D%25%20of%20biological%20activity%0A%20%20%20%204.%20This%20approach%20could%20save%20%7Bbest_screening_target%5B1%5D%5B'effort_reduction'%5D%3A.0f%7D%25%20of%20manual%20effort%20while%20missing%20%7B100-best_screening_target%5B1%5D%5B'detection_rate'%5D%3A.0f%7D%25%20of%20activity%0A%0A%20%20%20%20**Important%20caveat**%3A%20These%20projections%20are%20based%20on%20one%20study%20system%20and%20require%20validation%20across%20different%0A%20%20%20%20environments%2C%20acoustic%20setups%2C%20and%20fish%20communities%20before%20operational%20deployment.%0A%0A%20%20%20%20%23%23%203.%20TEMPORAL%20PATTERN%20CONCORDANCE%20ANALYSIS%0A%0A%20%20%20%20**Diel%20Pattern%20Matching**%3A%20%7Bsummary_results%5B'temporal_concordance'%5D%5B'best_diel_correlation'%5D%5B'index'%5D%7D%0A%20%20%20%20-%20Correlation%3A%20%7Bsummary_results%5B'temporal_concordance'%5D%5B'best_diel_correlation'%5D%5B'correlation'%5D%3A.3f%7D%0A%20%20%20%20-%20Interpretation%3A%20%7B%22Strong%20negative%20correlation%20-%20index%20decreases%20when%20fish%20activity%20increases%20during%20day%22%20if%20summary_results%5B'temporal_concordance'%5D%5B'best_diel_correlation'%5D%5B'correlation'%5D%20%3C%20-0.7%20else%20%22Strong%20positive%20correlation%20-%20index%20tracks%20fish%20activity%20patterns%22%7D%0A%0A%20%20%20%20**Seasonal%20Pattern%20Matching**%3A%20%7Bsummary_results%5B'temporal_concordance'%5D%5B'best_seasonal_correlation'%5D%5B'index'%5D%7D%0A%20%20%20%20-%20Correlation%3A%20%7Bsummary_results%5B'temporal_concordance'%5D%5B'best_seasonal_correlation'%5D%5B'correlation'%5D%3A.3f%7D%0A%20%20%20%20-%20Interpretation%3A%20%7B%22Very%20strong%20negative%20correlation%20-%20index%20shows%20opposite%20seasonal%20pattern%20to%20fish%22%20if%20summary_results%5B'temporal_concordance'%5D%5B'best_seasonal_correlation'%5D%5B'correlation'%5D%20%3C%20-0.8%20else%20%22Strong%20correlation%20with%20fish%20seasonal%20patterns%22%7D%0A%0A%20%20%20%20**Biological%20Significance**%3A%20Some%20acoustic%20indices%20show%20correlations%20with%20fish%20calling%20temporal%20patterns%20in%20this%20dataset.%0A%20%20%20%20This%20suggests%20they%20may%20be%20capturing%20biological%20phenomena%20rather%20than%20just%20acoustic%20noise%2C%20though%20this%20relationship%0A%20%20%20%20requires%20validation%20across%20different%20systems%20and%20temporal%20scales.%0A%0A%20%20%20%20%23%23%204.%20FEATURE%20IMPORTANCE%20INSIGHTS%0A%0A%20%20%20%20**Most%20Important%20Predictors**%20(across%20all%20models)%3A%0A%20%20%20%201.%20Month%20(seasonal%20patterns)%20-%20Captures%20spawning%20cycles%20and%20temperature-driven%20behavior%0A%20%20%20%202.%20Water%20temperature%20-%20Direct%20physiological%20driver%20of%20fish%20activity%0A%20%20%20%203.%20Acoustic%20indices%20(ENRf%2C%20VARf%2C%20NBPEAKS)%20-%20Capture%20acoustic%20characteristics%20of%20biological%20sounds%0A%0A%20%20%20%20**Scientific%20Interpretation**%3A%20The%20models%20rely%20on%20biologically%20sensible%20variables%20in%20this%20study%20system.%20The%20combination%20of%0A%20%20%20%20seasonal%20timing%2C%20environmental%20conditions%2C%20and%20acoustic%20features%20shows%20predictive%20potential%2C%20though%20the%20generalizability%0A%20%20%20%20of%20these%20relationships%20across%20different%20marine%20environments%20remains%20to%20be%20tested.%0A%0A%20%20%20%20%23%23%205.%20COMPARISON%20TO%20SPECIES-SPECIFIC%20APPROACHES%0A%0A%20%20%20%20**Why%20Community-Level%20May%20Work%20Better%20(in%20this%20system)**%3A%0A%20%20%20%20-%20Individual%20species%20showed%20weak%2C%20irregular%20calling%20patterns%20in%20this%20dataset%0A%20%20%20%20-%20Aggregating%20across%20species%20appears%20to%20amplify%20consistent%20biological%20signal%0A%20%20%20%20-%20May%20reduce%20noise%20from%20species-specific%20behavioral%20variation%0A%20%20%20%20-%20Could%20match%20practical%20monitoring%20needs%20(detect%20biological%20activity%2C%20then%20investigate%20specifics)%0A%0A%20%20%20%20**Working%20hypothesis**%3A%20Like%20using%20a%20motion%20detector%20vs%20identifying%20specific%20animals%20-%20the%20former%20may%20be%0A%20%20%20%20more%20reliable%20for%20knowing%20%22when%20something%20biological%20is%20happening%22%20in%20marine%20acoustic%20monitoring%0A%0A%20%20%20%20%23%23%206.%20PRACTICAL%20IMPLEMENTATION%20RECOMMENDATIONS%0A%0A%20%20%20%20**Potential%20Applications%20(requiring%20further%20validation)**%3A%0A%20%20%20%201.%20**Smart%20Sampling%20Protocols**%3A%20Indices%20might%20help%20identify%20optimal%20times%20for%20manual%20analysis%0A%20%20%20%202.%20**Background%20Monitoring**%3A%20Could%20enable%20more%20continuous%20biological%20activity%20tracking%0A%20%20%20%203.%20**Site%20Assessment**%3A%20May%20help%20characterize%20biological%20activity%20patterns%20at%20new%20locations%0A%20%20%20%204.%20**Quality%20Control**%3A%20Could%20flag%20unusual%20periods%20in%20long-term%20datasets%20for%20examination%0A%0A%20%20%20%20**Suggested%20Development%20Strategy**%3A%0A%20%20%20%20-%20Test%20Random%20Forest%20or%20similar%20ensemble%20methods%20for%20performance%0A%20%20%20%20-%20Focus%20initial%20validation%20on%20%22any%20activity%22%20detection%20for%20general%20screening%0A%20%20%20%20-%20Evaluate%20%22high%20activity%22%20thresholds%20for%20identifying%20exceptional%20biological%20events%0A%20%20%20%20-%20Calibrate%20thresholds%20based%20on%20acceptable%20false%20positive%2Fnegative%20rates%20for%20specific%20applications%0A%20%20%20%20-%20Validate%20approach%20across%20different%20study%20systems%20before%20operational%20deployment%0A%0A%20%20%20%20%23%23%207.%20STUDY%20SIGNIFICANCE%20AND%20LIMITATIONS%0A%0A%20%20%20%20**Study%20Contribution**%3A%20This%20analysis%20demonstrates%20that%20acoustic%20indices%20show%20potential%20for%20community-level%0A%20%20%20%20biological%20activity%20detection%20in%20this%20marine%20environment%2C%20suggesting%20possible%20applications%20as%20screening%20tools.%0A%0A%20%20%20%20**Potential%20Impact**%3A%20If%20validated%20across%20different%20systems%2C%20this%20approach%20might%20enable%20more%20efficient%0A%20%20%20%20acoustic%20monitoring%20by%20reducing%20manual%20analysis%20bottlenecks.%20However%2C%20broader%20application%20requires%0A%20%20%20%20extensive%20testing%20across%20different%20marine%20environments%2C%20fish%20communities%2C%20and%20acoustic%20setups.%0A%0A%20%20%20%20**Study%20Scope**%3A%20Results%20based%20on%20%7Bsummary_results%5B'community_metrics'%5D%5B'total_samples'%5D%3A%2C%7D%20samples%20from%0A%20%20%20%20one%20study%20system%20across%20a%20full%20annual%20cycle%20with%20multiple%20stations.%20While%20this%20provides%20a%20solid%20foundation%2C%0A%20%20%20%20generalizability%20to%20other%20marine%20environments%20requires%20further%20investigation.%0A%0A%20%20%20%20**Next%20Steps%20for%20Validation**%3A%0A%20%20%20%20-%20Literature%20review%20of%20existing%20acoustic%20monitoring%20approaches%0A%20%20%20%20-%20Cross-site%20validation%20with%20independent%20datasets%0A%20%20%20%20-%20Comparison%20with%20other%20automated%20detection%20methods%0A%20%20%20%20-%20Testing%20across%20different%20fish%20communities%20and%20acoustic%20environments%0A%20%20%20%20%22%22%22)%0A%0A%20%20%20%20print(f%22%5CnAnalysis%20complete!%20All%20results%20saved%20to%20%7BDATA_ROOT%7D%2Fprocessed%2F%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Conclusions%20and%20Recommendations%0A%0A%20%20%20%20%23%23%23%20What%20We%20Learned%0A%0A%20%20%20%20**Community-Level%20Detection%20Shows%20Promise**%3A%20In%20this%20study%20system%2C%20acoustic%20indices%20showed%20better%20success%20at%20detecting%20aggregate%20biological%20activity%20rather%20than%20species-specific%20patterns.%20This%20suggests%20their%20potential%20value%20may%20lie%20in%20**biological%20screening**%20rather%20than%20detailed%20species%20identification%2C%20though%20this%20requires%20validation%20across%20different%20environments.%0A%0A%20%20%20%20**Temporal%20Patterns%20Show%20Some%20Concordance**%3A%20Some%20indices%20capture%20diel%20and%20seasonal%20patterns%20that%20correlate%20with%20fish%20community%20activity%2C%20though%20not%20with%20the%20precision%20of%20manual%20detections.%20The%20correlation%20strengths%20vary%20by%20index%20and%20temporal%20scale%2C%20and%20the%20generalizability%20of%20these%20patterns%20is%20unknown.%0A%0A%20%20%20%20**Screening%20Tool%20Potential**%3A%20The%20most%20promising%20application%20appears%20to%20be%20using%20indices%20as%20**screening%20tools**%20that%20flag%20periods%20likely%20to%20contain%20biological%20activity%20for%20targeted%20manual%20analysis.%20This%20could%20potentially%20reduce%20manual%20effort%20while%20maintaining%20detection%20rates%2C%20but%20operational%20effectiveness%20requires%20validation%20in%20real-world%20deployment%20scenarios.%0A%0A%20%20%20%20%23%23%23%20Potential%20Applications%20(Requiring%20Validation)%0A%0A%20%20%20%201.%20**Smart%20Sampling%20Protocols**%3A%20Indices%20might%20help%20identify%20optimal%20times%20for%20detailed%20manual%20analysis%0A%20%20%20%202.%20**Background%20Monitoring**%3A%20Could%20enable%20more%20continuous%20monitoring%20with%20periodic%20manual%20validation%0A%20%20%20%203.%20**Effort%20Optimization**%3A%20May%20help%20focus%20limited%20manual%20resources%20on%20periods%20flagged%20by%20models%0A%20%20%20%204.%20**Pattern%20Detection**%3A%20Could%20help%20detect%20unusual%20biological%20activity%20patterns%20warranting%20investigation%0A%0A%20%20%20%20%23%23%23%20Next%20Steps%20for%20Notebook%207%0A%0A%20%20%20%20The%20validation%20analysis%20should%20focus%20on%3A%0A%0A%20%20%20%20-%20**Temporal%20transferability**%3A%20Do%20these%20patterns%20hold%20across%20different%20time%20periods%3F%0A%20%20%20%20-%20**Cross-site%20validation**%3A%20How%20well%20do%20models%20trained%20at%20one%20site%20perform%20at%20others%3F%0A%20%20%20%20-%20**Continuous%20monitoring%20simulation**%3A%20What%20would%20real-world%20deployment%20look%20like%3F%0A%20%20%20%20-%20**Cost-benefit%20quantification**%3A%20Actual%20effort%20savings%20vs%20information%20loss%0A%0A%20%20%20%20%23%23%23%20The%20Bottom%20Line%0A%0A%20%20%20%20In%20this%20study%20system%2C%20acoustic%20indices%20show%20**promising%20potential**%20as%20biological%20screening%20tools.%20While%20they%20cannot%20replace%20manual%20detection%2C%20they%20may%20be%20able%20to%20**help%20guide%20when%20and%20where%20to%20apply%20manual%20effort**.%20However%2C%20this%20potential%20must%20be%20validated%20across%20different%20marine%20environments%2C%20fish%20communities%2C%20and%20operational%20contexts%20before%20concluding%20that%20they%20can%20improve%20the%20efficiency%20of%20acoustic%20monitoring%20programs%20more%20broadly.%0A%0A%20%20%20%20**Critical%20next%20steps**%3A%20Cross-system%20validation%2C%20comparison%20with%20existing%20methods%2C%20and%20operational%20testing%20are%20essential%20before%20broader%20implementation.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">6e1d3deb8ed6ece1f98d8db8de6c824901f9f4c96e5e4a099074a8350a65255f</marimo-code-hash>
</body>
</html>
